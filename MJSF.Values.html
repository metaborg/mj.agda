<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>MJSF.Values</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="22" class="Keyword">open</a> <a id="27" class="Keyword">import</a> <a id="34" href="Data.List.Most.html" class="Module">Data.List.Most</a>
<a id="49" class="Keyword">open</a> <a id="54" class="Keyword">import</a> <a id="61" href="Data.Integer.html" class="Module">Data.Integer</a>
<a id="74" class="Keyword">open</a> <a id="79" class="Keyword">import</a> <a id="86" href="Data.Product.html" class="Module">Data.Product</a>

<a id="100" class="Comment">-- This file contains the definition of values for the definitional</a>
<a id="168" class="Comment">-- interpreter for MJ using scopes and frames, described in Section 5</a>
<a id="238" class="Comment">-- of the paper.</a>

<a id="256" class="Keyword">module</a> <a id="263" href="MJSF.Values.html" class="Module">MJSF.Values</a> <a id="275" class="Symbol">(</a><a id="276" href="MJSF.Values.html#276" class="Bound">k</a> <a id="278" class="Symbol">:</a> <a id="280" href="Agda.Builtin.Nat.html#%E2%84%95" class="Datatype">ℕ</a><a id="281" class="Symbol">)</a> <a id="283" class="Keyword">where</a>

<a id="290" class="Keyword">open</a> <a id="295" class="Keyword">import</a> <a id="302" href="MJSF.Syntax.html" class="Module">MJSF.Syntax</a> <a id="314" href="MJSF.Values.html#276" class="Bound">k</a>
<a id="316" class="Keyword">open</a> <a id="321" class="Keyword">import</a> <a id="328" href="ScopesFrames.ScopesFrames.html" class="Module">ScopesFrames.ScopesFrames</a> <a id="354" href="MJSF.Values.html#276" class="Bound">k</a> <a id="356" href="MJSF.Syntax.html#1183" class="Datatype">Ty</a>

<a id="360" class="Keyword">module</a> <a id="ValuesG" href="MJSF.Values.html#ValuesG" class="Module">ValuesG</a> <a id="375" class="Symbol">(</a><a id="376" href="MJSF.Values.html#376" class="Bound">g</a> <a id="378" class="Symbol">:</a> <a id="380" href="ScopesFrames.ScopesFrames.html#1611" class="Function">Graph</a><a id="385" class="Symbol">)</a> <a id="387" class="Keyword">where</a>

  <a id="396" class="Keyword">open</a> <a id="401" href="MJSF.Syntax.html#SyntaxG" class="Module">SyntaxG</a> <a id="409" href="MJSF.Values.html#376" class="Bound">g</a>
  <a id="413" class="Keyword">open</a> <a id="418" href="ScopesFrames.ScopesFrames.html#UsesGraph" class="Module">UsesGraph</a> <a id="428" href="MJSF.Values.html#376" class="Bound">g</a> <a id="430" class="Keyword">public</a>
  <a id="439" class="Keyword">open</a> <a id="444" class="Keyword">import</a> <a id="451" href="Common.Weakening.html" class="Module">Common.Weakening</a>

  <a id="471" class="Comment">------------</a>
  <a id="486" class="Comment">-- VALUES --</a>
  <a id="501" class="Comment">------------</a>

  <a id="517" class="Comment">-- The values used in our interpreter at run time are either:</a>
  <a id="581" class="Comment">--</a>
  <a id="586" class="Comment">-- * object references `ref`, represented in terms of a frame scoped</a>
  <a id="657" class="Comment">--   by a class scope;</a>
  <a id="682" class="Comment">--</a>
  <a id="687" class="Comment">-- * null values (`ref` typed);</a>
  <a id="721" class="Comment">--</a>
  <a id="726" class="Comment">-- * an integer number literal (`int` typed); or</a>
  <a id="777" class="Comment">--</a>
  <a id="782" class="Comment">-- * `void` (`void typed -- note that there is no expression syntax</a>
  <a id="852" class="Comment">--   for producing a `void` value directly, but method bodies still</a>
  <a id="922" class="Comment">--   return `void`; we regard `void` as a unit type)</a>

  <a id="978" class="Keyword">data</a> <a id="ValuesG.Val" href="MJSF.Values.html#ValuesG.Val" class="Datatype">Val</a> <a id="987" class="Symbol">:</a> <a id="989" href="MJSF.Syntax.html#731" class="Datatype">VTy</a> <a id="993" class="Symbol">→</a> <a id="995" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1000" href="ScopesFrames.ScopesFrames.html#1597" class="Function">Scope</a> <a id="1006" class="Symbol">→</a> <a id="1008" class="PrimitiveType">Set</a> <a id="1012" class="Keyword">where</a>
    <a id="ValuesG.Val.ref" href="MJSF.Values.html#ValuesG.Val.ref" class="InductiveConstructor">ref</a>    <a id="1029" class="Symbol">:</a>  <a id="1032" class="Symbol">∀</a> <a id="1034" class="Symbol">{</a><a id="1035" href="MJSF.Values.html#1035" class="Bound">s</a> <a id="1037" href="MJSF.Values.html#1037" class="Bound">Σ</a><a id="1038" class="Symbol">}</a> <a id="1040" class="Symbol">→</a> <a id="1042" href="ScopesFrames.ScopesFrames.html#2761" class="Function">Frame</a> <a id="1048" href="MJSF.Values.html#1035" class="Bound">s</a> <a id="1050" href="MJSF.Values.html#1037" class="Bound">Σ</a> <a id="1052" class="Symbol">→</a> <a id="1054" href="MJSF.Values.html#ValuesG.Val" class="Datatype">Val</a> <a id="1058" class="Symbol">(</a><a id="1059" href="MJSF.Syntax.html#774" class="InductiveConstructor">ref</a> <a id="1063" href="MJSF.Values.html#1035" class="Bound">s</a><a id="1064" class="Symbol">)</a> <a id="1066" href="MJSF.Values.html#1037" class="Bound">Σ</a>
    <a id="ValuesG.Val.null" href="MJSF.Values.html#ValuesG.Val.null" class="InductiveConstructor">null</a>   <a id="1079" class="Symbol">:</a>  <a id="1082" class="Symbol">∀</a> <a id="1084" class="Symbol">{</a><a id="1085" href="MJSF.Values.html#1085" class="Bound">s</a> <a id="1087" href="MJSF.Values.html#1087" class="Bound">Σ</a><a id="1088" class="Symbol">}</a> <a id="1090" class="Symbol">→</a> <a id="1092" href="MJSF.Values.html#ValuesG.Val" class="Datatype">Val</a> <a id="1096" class="Symbol">(</a><a id="1097" href="MJSF.Syntax.html#774" class="InductiveConstructor">ref</a> <a id="1101" href="MJSF.Values.html#1085" class="Bound">s</a><a id="1102" class="Symbol">)</a> <a id="1104" href="MJSF.Values.html#1087" class="Bound">Σ</a>
    <a id="ValuesG.Val.num" href="MJSF.Values.html#ValuesG.Val.num" class="InductiveConstructor">num</a>    <a id="1117" class="Symbol">:</a>  <a id="1120" class="Symbol">∀</a> <a id="1122" class="Symbol">{</a><a id="1123" href="MJSF.Values.html#1123" class="Bound">Σ</a><a id="1124" class="Symbol">}</a> <a id="1126" class="Symbol">→</a> <a id="1128" href="Agda.Builtin.Int.html#%E2%84%A4" class="Datatype">ℤ</a> <a id="1130" class="Symbol">→</a> <a id="1132" href="MJSF.Values.html#ValuesG.Val" class="Datatype">Val</a> <a id="1136" href="MJSF.Syntax.html#762" class="InductiveConstructor">int</a> <a id="1140" href="MJSF.Values.html#1123" class="Bound">Σ</a>
    <a id="ValuesG.Val.void" href="MJSF.Values.html#ValuesG.Val.void" class="InductiveConstructor">void</a>   <a id="1153" class="Symbol">:</a>  <a id="1156" class="Symbol">∀</a> <a id="1158" class="Symbol">{</a><a id="1159" href="MJSF.Values.html#1159" class="Bound">Σ</a><a id="1160" class="Symbol">}</a> <a id="1162" class="Symbol">→</a> <a id="1164" href="MJSF.Values.html#ValuesG.Val" class="Datatype">Val</a> <a id="1168" href="MJSF.Syntax.html#749" class="InductiveConstructor">void</a> <a id="1173" href="MJSF.Values.html#1159" class="Bound">Σ</a>

  <a id="1178" class="Comment">-- There are three kinds of values stored in frame slots at run</a>
  <a id="1244" class="Comment">-- time, corresponding to each of the three kinds of declarations</a>
  <a id="1312" class="Comment">-- defined in `MJSF.Syntax`:</a>
  <a id="1343" class="Comment">--</a>
  <a id="1348" class="Comment">-- * values, as defined above;</a>
  <a id="1381" class="Comment">--</a>
  <a id="1386" class="Comment">-- * methods, where a method records a &quot;self&quot; frame `Frame s Σ` and</a>
  <a id="1456" class="Comment">--   a well-typed method definition `Meth s ts rt`, such that the</a>
  <a id="1524" class="Comment">--   scope of the method corresponds to the &quot;self&quot;; and</a>
  <a id="1582" class="Comment">--</a>
  <a id="1587" class="Comment">-- * classes which record a well-typed class definition and a</a>
  <a id="1651" class="Comment">--   witness that the class has a finite inheritance chain, both</a>
  <a id="1718" class="Comment">--   used for initializing new object instances, as well as a frame</a>
  <a id="1788" class="Comment">--   pointer to the root frame (class table).</a>

  <a id="1837" class="Keyword">data</a> <a id="ValuesG.Valᵗ" href="MJSF.Values.html#ValuesG.Val%E1%B5%97" class="Datatype">Valᵗ</a> <a id="1847" class="Symbol">:</a> <a id="1849" href="MJSF.Syntax.html#1183" class="Datatype">Ty</a> <a id="1852" class="Symbol">→</a> <a id="1854" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1859" href="ScopesFrames.ScopesFrames.html#1597" class="Function">Scope</a> <a id="1865" class="Symbol">→</a> <a id="1867" class="PrimitiveType">Set</a> <a id="1871" class="Keyword">where</a>
    <a id="ValuesG.Valᵗ.vᵗ" href="MJSF.Values.html#ValuesG.Val%E1%B5%97.v%E1%B5%97" class="InductiveConstructor">vᵗ</a> <a id="1884" class="Symbol">:</a> <a id="1886" class="Symbol">∀</a> <a id="1888" class="Symbol">{</a><a id="1889" href="MJSF.Values.html#1889" class="Bound">t</a> <a id="1891" href="MJSF.Values.html#1891" class="Bound">Σ</a><a id="1892" class="Symbol">}</a> <a id="1894" class="Symbol">→</a> <a id="1896" href="MJSF.Values.html#ValuesG.Val" class="Datatype">Val</a> <a id="1900" href="MJSF.Values.html#1889" class="Bound">t</a> <a id="1902" href="MJSF.Values.html#1891" class="Bound">Σ</a> <a id="1904" class="Symbol">→</a> <a id="1906" href="MJSF.Values.html#ValuesG.Val%E1%B5%97" class="Datatype">Valᵗ</a> <a id="1911" class="Symbol">(</a><a id="1912" href="MJSF.Syntax.html#1200" class="InductiveConstructor">vᵗ</a> <a id="1915" href="MJSF.Values.html#1889" class="Bound">t</a><a id="1916" class="Symbol">)</a> <a id="1918" href="MJSF.Values.html#1891" class="Bound">Σ</a>
    <a id="ValuesG.Valᵗ.mᵗ" href="MJSF.Values.html#ValuesG.Val%E1%B5%97.m%E1%B5%97" class="InductiveConstructor">mᵗ</a> <a id="1927" class="Symbol">:</a> <a id="1929" class="Symbol">∀</a> <a id="1931" class="Symbol">{</a><a id="1932" href="MJSF.Values.html#1932" class="Bound">s</a> <a id="1934" href="MJSF.Values.html#1934" class="Bound">ts</a> <a id="1937" href="MJSF.Values.html#1937" class="Bound">rt</a> <a id="1940" href="MJSF.Values.html#1940" class="Bound">Σ</a><a id="1941" class="Symbol">}</a> <a id="1943" class="Symbol">→</a> <a id="1945" class="Symbol">(</a><a id="1946" href="MJSF.Values.html#1946" class="Bound">self</a> <a id="1951" class="Symbol">:</a> <a id="1953" href="ScopesFrames.ScopesFrames.html#2761" class="Function">Frame</a> <a id="1959" href="MJSF.Values.html#1932" class="Bound">s</a> <a id="1961" href="MJSF.Values.html#1940" class="Bound">Σ</a><a id="1962" class="Symbol">)</a> <a id="1964" class="Symbol">→</a> <a id="1966" class="Symbol">(</a><a id="1967" href="MJSF.Values.html#1967" class="Bound">body</a> <a id="1972" class="Symbol">:</a> <a id="1974" href="MJSF.Syntax.html#6008" class="Datatype">Meth</a> <a id="1979" href="MJSF.Values.html#1932" class="Bound">s</a> <a id="1981" href="MJSF.Values.html#1934" class="Bound">ts</a> <a id="1984" href="MJSF.Values.html#1937" class="Bound">rt</a><a id="1986" class="Symbol">)</a> <a id="1988" class="Symbol">→</a> <a id="1990" href="MJSF.Values.html#ValuesG.Val%E1%B5%97" class="Datatype">Valᵗ</a> <a id="1995" class="Symbol">(</a><a id="1996" href="MJSF.Syntax.html#1216" class="InductiveConstructor">mᵗ</a> <a id="1999" href="MJSF.Values.html#1934" class="Bound">ts</a> <a id="2002" href="MJSF.Values.html#1937" class="Bound">rt</a><a id="2004" class="Symbol">)</a> <a id="2006" href="MJSF.Values.html#1940" class="Bound">Σ</a>
    <a id="ValuesG.Valᵗ.cᵗ" href="MJSF.Values.html#ValuesG.Val%E1%B5%97.c%E1%B5%97" class="InductiveConstructor">cᵗ</a> <a id="2015" class="Symbol">:</a> <a id="2017" class="Symbol">∀</a> <a id="2019" class="Symbol">{</a><a id="2020" href="MJSF.Values.html#2020" class="Bound">sʳ</a> <a id="2023" href="MJSF.Values.html#2023" class="Bound">s</a> <a id="2025" href="MJSF.Values.html#2025" class="Bound">s&#39;</a> <a id="2028" href="MJSF.Values.html#2028" class="Bound">Σ</a><a id="2029" class="Symbol">}</a> <a id="2031" class="Symbol">→</a> <a id="2033" class="Symbol">(</a><a id="2034" href="MJSF.Values.html#2034" class="Bound">class-def</a> <a id="2044" class="Symbol">:</a> <a id="2046" href="MJSF.Syntax.html#7145" class="Datatype">Class</a> <a id="2052" href="MJSF.Values.html#2020" class="Bound">sʳ</a> <a id="2055" href="MJSF.Values.html#2023" class="Bound">s</a><a id="2056" class="Symbol">)</a> <a id="2058" class="Symbol">→</a> <a id="2060" class="Symbol">(</a><a id="2061" href="MJSF.Values.html#2061" class="Bound">ic</a> <a id="2064" class="Symbol">:</a> <a id="2066" href="MJSF.Syntax.html#3215" class="Datatype">Inherits</a> <a id="2075" href="MJSF.Values.html#2023" class="Bound">s</a> <a id="2077" href="MJSF.Values.html#2025" class="Bound">s&#39;</a><a id="2079" class="Symbol">)</a> <a id="2081" class="Symbol">→</a> <a id="2083" class="Symbol">(</a><a id="2084" href="MJSF.Values.html#2084" class="Bound">root</a> <a id="2089" class="Symbol">:</a> <a id="2091" href="ScopesFrames.ScopesFrames.html#2761" class="Function">Frame</a> <a id="2097" href="MJSF.Values.html#2020" class="Bound">sʳ</a> <a id="2100" href="MJSF.Values.html#2028" class="Bound">Σ</a><a id="2101" class="Symbol">)</a> <a id="2103" class="Symbol">→</a> <a id="2105" href="MJSF.Values.html#ValuesG.Val%E1%B5%97" class="Datatype">Valᵗ</a> <a id="2110" class="Symbol">(</a><a id="2111" href="MJSF.Syntax.html#1243" class="InductiveConstructor">cᵗ</a> <a id="2114" href="MJSF.Values.html#2020" class="Bound">sʳ</a> <a id="2117" href="MJSF.Values.html#2023" class="Bound">s</a><a id="2118" class="Symbol">)</a> <a id="2120" href="MJSF.Values.html#2028" class="Bound">Σ</a>


  <a id="2126" class="Comment">---------------</a>
  <a id="2144" class="Comment">-- WEAKENING --</a>
  <a id="2162" class="Comment">---------------</a>

  <a id="2181" class="Comment">-- We define notions of weakening for each of the values summarized above:</a>

  <a id="ValuesG.val-weaken" href="MJSF.Values.html#ValuesG.val-weaken" class="Function">val-weaken</a>    <a id="2273" class="Symbol">:</a>  <a id="2276" class="Symbol">∀</a> <a id="2278" class="Symbol">{</a><a id="2279" href="MJSF.Values.html#2279" class="Bound">t</a> <a id="2281" href="MJSF.Values.html#2281" class="Bound">Σ</a> <a id="2283" href="MJSF.Values.html#2283" class="Bound">Σ&#39;</a><a id="2285" class="Symbol">}</a> <a id="2287" class="Symbol">→</a> <a id="2289" href="MJSF.Values.html#2281" class="Bound">Σ</a> <a id="2291" href="Data.List.Prefix.html#_%E2%8A%91_" class="Datatype Operator">⊑</a> <a id="2293" href="MJSF.Values.html#2283" class="Bound">Σ&#39;</a> <a id="2296" class="Symbol">→</a> <a id="2298" href="MJSF.Values.html#ValuesG.Val" class="Datatype">Val</a> <a id="2302" href="MJSF.Values.html#2279" class="Bound">t</a> <a id="2304" href="MJSF.Values.html#2281" class="Bound">Σ</a> <a id="2306" class="Symbol">→</a> <a id="2308" href="MJSF.Values.html#ValuesG.Val" class="Datatype">Val</a> <a id="2312" href="MJSF.Values.html#2279" class="Bound">t</a> <a id="2314" href="MJSF.Values.html#2283" class="Bound">Σ&#39;</a>
  <a id="2319" href="MJSF.Values.html#ValuesG.val-weaken" class="Function">val-weaken</a> <a id="2330" href="MJSF.Values.html#2330" class="Bound">ext</a> <a id="2334" class="Symbol">(</a><a id="2335" href="MJSF.Values.html#ValuesG.Val.num" class="InductiveConstructor">num</a> <a id="2339" href="MJSF.Values.html#2339" class="Bound">i</a><a id="2340" class="Symbol">)</a>  <a id="2343" class="Symbol">=</a>  <a id="2346" href="MJSF.Values.html#ValuesG.Val.num" class="InductiveConstructor">num</a> <a id="2350" href="MJSF.Values.html#2339" class="Bound">i</a>
  <a id="2354" href="MJSF.Values.html#ValuesG.val-weaken" class="Function">val-weaken</a> <a id="2365" href="MJSF.Values.html#2365" class="Bound">ext</a> <a id="2369" class="Symbol">(</a><a id="2370" href="MJSF.Values.html#ValuesG.Val.ref" class="InductiveConstructor">ref</a> <a id="2374" href="MJSF.Values.html#2374" class="Bound">f</a><a id="2375" class="Symbol">)</a>  <a id="2378" class="Symbol">=</a>  <a id="2381" href="MJSF.Values.html#ValuesG.Val.ref" class="InductiveConstructor">ref</a> <a id="2385" class="Symbol">(</a><a id="2386" href="Common.Weakening.html#721" class="Field">wk</a> <a id="2389" href="MJSF.Values.html#2365" class="Bound">ext</a> <a id="2393" href="MJSF.Values.html#2374" class="Bound">f</a><a id="2394" class="Symbol">)</a>
  <a id="2398" href="MJSF.Values.html#ValuesG.val-weaken" class="Function">val-weaken</a> <a id="2409" href="MJSF.Values.html#2409" class="Bound">ext</a> <a id="2413" href="MJSF.Values.html#ValuesG.Val.null" class="InductiveConstructor">null</a>     <a id="2422" class="Symbol">=</a>  <a id="2425" href="MJSF.Values.html#ValuesG.Val.null" class="InductiveConstructor">null</a>
  <a id="2432" href="MJSF.Values.html#ValuesG.val-weaken" class="Function">val-weaken</a> <a id="2443" href="MJSF.Values.html#2443" class="Bound">ext</a> <a id="2447" href="MJSF.Values.html#ValuesG.Val.void" class="InductiveConstructor">void</a>     <a id="2456" class="Symbol">=</a>  <a id="2459" href="MJSF.Values.html#ValuesG.Val.void" class="InductiveConstructor">void</a>

  <a id="2467" class="Keyword">instance</a>
    <a id="ValuesG.val-weakenable" href="MJSF.Values.html#ValuesG.val-weakenable" class="Function">val-weakenable</a> <a id="2495" class="Symbol">:</a> <a id="2497" class="Symbol">∀</a> <a id="2499" class="Symbol">{</a><a id="2500" href="MJSF.Values.html#2500" class="Bound">t</a><a id="2501" class="Symbol">}</a> <a id="2503" class="Symbol">→</a> <a id="2505" href="Common.Weakening.html#Weakenable" class="Record">Weakenable</a> <a id="2516" class="Symbol">(</a><a id="2517" href="MJSF.Values.html#ValuesG.Val" class="Datatype">Val</a> <a id="2521" href="MJSF.Values.html#2500" class="Bound">t</a><a id="2522" class="Symbol">)</a>
    <a id="2528" href="MJSF.Values.html#ValuesG.val-weakenable" class="Function">val-weakenable</a> <a id="2543" class="Symbol">=</a> <a id="2545" class="Keyword">record</a> <a id="2552" class="Symbol">{</a> <a id="2554" class="Field">wk</a> <a id="2557" class="Symbol">=</a> <a id="2559" href="MJSF.Values.html#ValuesG.val-weaken" class="Function">val-weaken</a> <a id="2570" class="Symbol">}</a>

  <a id="ValuesG.valᵗ-weaken" href="MJSF.Values.html#ValuesG.val%E1%B5%97-weaken" class="Function">valᵗ-weaken</a> <a id="2587" class="Symbol">:</a> <a id="2589" class="Symbol">∀</a> <a id="2591" class="Symbol">{</a><a id="2592" href="MJSF.Values.html#2592" class="Bound">t</a> <a id="2594" href="MJSF.Values.html#2594" class="Bound">Σ</a> <a id="2596" href="MJSF.Values.html#2596" class="Bound">Σ&#39;</a><a id="2598" class="Symbol">}</a> <a id="2600" class="Symbol">→</a> <a id="2602" href="MJSF.Values.html#2594" class="Bound">Σ</a> <a id="2604" href="Data.List.Prefix.html#_%E2%8A%91_" class="Datatype Operator">⊑</a> <a id="2606" href="MJSF.Values.html#2596" class="Bound">Σ&#39;</a> <a id="2609" class="Symbol">→</a> <a id="2611" href="MJSF.Values.html#ValuesG.Val%E1%B5%97" class="Datatype">Valᵗ</a> <a id="2616" href="MJSF.Values.html#2592" class="Bound">t</a> <a id="2618" href="MJSF.Values.html#2594" class="Bound">Σ</a> <a id="2620" class="Symbol">→</a> <a id="2622" href="MJSF.Values.html#ValuesG.Val%E1%B5%97" class="Datatype">Valᵗ</a> <a id="2627" href="MJSF.Values.html#2592" class="Bound">t</a> <a id="2629" href="MJSF.Values.html#2596" class="Bound">Σ&#39;</a>
  <a id="2634" href="MJSF.Values.html#ValuesG.val%E1%B5%97-weaken" class="Function">valᵗ-weaken</a> <a id="2646" href="MJSF.Values.html#2646" class="Bound">ext</a> <a id="2650" class="Symbol">(</a><a id="2651" href="MJSF.Values.html#ValuesG.Val%E1%B5%97.v%E1%B5%97" class="InductiveConstructor">vᵗ</a> <a id="2654" href="MJSF.Values.html#2654" class="Bound">v</a><a id="2655" class="Symbol">)</a>      <a id="2662" class="Symbol">=</a> <a id="2664" href="MJSF.Values.html#ValuesG.Val%E1%B5%97.v%E1%B5%97" class="InductiveConstructor">vᵗ</a> <a id="2667" class="Symbol">(</a><a id="2668" href="MJSF.Values.html#ValuesG.val-weaken" class="Function">val-weaken</a> <a id="2679" href="MJSF.Values.html#2646" class="Bound">ext</a> <a id="2683" href="MJSF.Values.html#2654" class="Bound">v</a><a id="2684" class="Symbol">)</a>
  <a id="2688" href="MJSF.Values.html#ValuesG.val%E1%B5%97-weaken" class="Function">valᵗ-weaken</a> <a id="2700" href="MJSF.Values.html#2700" class="Bound">ext</a> <a id="2704" class="Symbol">(</a><a id="2705" href="MJSF.Values.html#ValuesG.Val%E1%B5%97.m%E1%B5%97" class="InductiveConstructor">mᵗ</a> <a id="2708" href="MJSF.Values.html#2708" class="Bound">f</a> <a id="2710" href="MJSF.Values.html#2710" class="Bound">m</a><a id="2711" class="Symbol">)</a>    <a id="2716" class="Symbol">=</a> <a id="2718" href="MJSF.Values.html#ValuesG.Val%E1%B5%97.m%E1%B5%97" class="InductiveConstructor">mᵗ</a> <a id="2721" class="Symbol">(</a><a id="2722" href="Common.Weakening.html#721" class="Field">wk</a> <a id="2725" href="MJSF.Values.html#2700" class="Bound">ext</a> <a id="2729" href="MJSF.Values.html#2708" class="Bound">f</a><a id="2730" class="Symbol">)</a> <a id="2732" href="MJSF.Values.html#2710" class="Bound">m</a>
  <a id="2736" href="MJSF.Values.html#ValuesG.val%E1%B5%97-weaken" class="Function">valᵗ-weaken</a> <a id="2748" href="MJSF.Values.html#2748" class="Bound">ext</a> <a id="2752" class="Symbol">(</a><a id="2753" href="MJSF.Values.html#ValuesG.Val%E1%B5%97.c%E1%B5%97" class="InductiveConstructor">cᵗ</a> <a id="2756" href="MJSF.Values.html#2756" class="Bound">c</a> <a id="2758" href="MJSF.Values.html#2758" class="Bound">ic</a> <a id="2761" href="MJSF.Values.html#2761" class="Bound">f</a><a id="2762" class="Symbol">)</a> <a id="2764" class="Symbol">=</a> <a id="2766" href="MJSF.Values.html#ValuesG.Val%E1%B5%97.c%E1%B5%97" class="InductiveConstructor">cᵗ</a> <a id="2769" href="MJSF.Values.html#2756" class="Bound">c</a> <a id="2771" href="MJSF.Values.html#2758" class="Bound">ic</a> <a id="2774" class="Symbol">(</a><a id="2775" href="Common.Weakening.html#721" class="Field">wk</a> <a id="2778" href="MJSF.Values.html#2748" class="Bound">ext</a> <a id="2782" href="MJSF.Values.html#2761" class="Bound">f</a><a id="2783" class="Symbol">)</a>

  <a id="2788" class="Comment">-- And pass these to the scope graph definition:</a>

  <a id="2840" class="Keyword">open</a> <a id="2845" href="ScopesFrames.ScopesFrames.html#UsesVal" class="Module">UsesVal</a> <a id="2853" href="MJSF.Values.html#ValuesG.Val%E1%B5%97" class="Datatype">Valᵗ</a> <a id="2858" href="MJSF.Values.html#ValuesG.val%E1%B5%97-weaken" class="Function">valᵗ-weaken</a> <a id="2870" class="Keyword">renaming</a> <a id="2879" class="Symbol">(</a>getFrame <a id="2889" class="Symbol">to</a> getFrame&#39;<a id="2901" class="Symbol">)</a>

  
  <a id="2909" class="Comment">--------------</a>
  <a id="2926" class="Comment">-- COERCION --</a>
  <a id="2943" class="Comment">--------------</a>

  <a id="2961" class="Comment">-- Our definition of sub-typing gives rise to a notion of sub-type</a>
  <a id="3030" class="Comment">-- coercion, defined below.  Coercions essentially traverse the</a>
  <a id="3096" class="Comment">-- inheritance links of the frame hierarchy for an object instance,</a>
  <a id="3166" class="Comment">-- as described in the paper.</a>

  <a id="ValuesG.coerce&lt;:" href="MJSF.Values.html#ValuesG.coerce%3C%3A" class="Function">coerce&lt;:</a> <a id="3208" class="Symbol">:</a> <a id="3210" class="Symbol">∀</a> <a id="3212" class="Symbol">{</a><a id="3213" href="MJSF.Values.html#3213" class="Bound">t</a> <a id="3215" href="MJSF.Values.html#3215" class="Bound">t&#39;</a> <a id="3218" href="MJSF.Values.html#3218" class="Bound">Σ</a><a id="3219" class="Symbol">}</a> <a id="3221" class="Symbol">→</a> <a id="3223" href="MJSF.Values.html#3213" class="Bound">t</a> <a id="3225" href="MJSF.Syntax.html#2593" class="Datatype Operator">&lt;:</a> <a id="3228" href="MJSF.Values.html#3215" class="Bound">t&#39;</a> <a id="3231" class="Symbol">→</a> <a id="3233" href="MJSF.Values.html#ValuesG.Val" class="Datatype">Val</a> <a id="3237" href="MJSF.Values.html#3213" class="Bound">t</a> <a id="3239" href="MJSF.Values.html#3218" class="Bound">Σ</a> <a id="3241" class="Symbol">→</a> <a id="3243" href="ScopesFrames.ScopesFrames.html#4025" class="Function">Heap</a> <a id="3248" href="MJSF.Values.html#3218" class="Bound">Σ</a> <a id="3250" class="Symbol">→</a> <a id="3252" href="MJSF.Values.html#ValuesG.Val" class="Datatype">Val</a> <a id="3256" href="MJSF.Values.html#3215" class="Bound">t&#39;</a> <a id="3259" href="MJSF.Values.html#3218" class="Bound">Σ</a>
  <a id="3263" href="MJSF.Values.html#ValuesG.coerce%3C%3A" class="Function">coerce&lt;:</a> <a id="3272" href="MJSF.Syntax.html#2626" class="InductiveConstructor">refl</a> <a id="3277" href="MJSF.Values.html#3277" class="Bound">v</a> <a id="3279" href="MJSF.Values.html#3279" class="Bound">h</a> <a id="3281" class="Symbol">=</a> <a id="3283" href="MJSF.Values.html#3277" class="Bound">v</a>
  <a id="3287" href="MJSF.Values.html#ValuesG.coerce%3C%3A" class="Function">coerce&lt;:</a> <a id="3296" class="Symbol">(</a><a id="3297" href="MJSF.Syntax.html#2655" class="InductiveConstructor">super</a> <a id="3303" href="MJSF.Values.html#3303" class="Bound">edge</a> <a id="3308" href="MJSF.Values.html#3308" class="Bound">σ</a><a id="3309" class="Symbol">)</a> <a id="3311" href="MJSF.Values.html#ValuesG.Val.null" class="InductiveConstructor">null</a> <a id="3316" href="MJSF.Values.html#3316" class="Bound">h</a> <a id="3318" class="Symbol">=</a> <a id="3320" href="MJSF.Values.html#ValuesG.coerce%3C%3A" class="Function">coerce&lt;:</a> <a id="3329" href="MJSF.Values.html#3308" class="Bound">σ</a> <a id="3331" href="MJSF.Values.html#ValuesG.Val.null" class="InductiveConstructor">null</a> <a id="3336" href="MJSF.Values.html#3316" class="Bound">h</a>
  <a id="3340" href="MJSF.Values.html#ValuesG.coerce%3C%3A" class="Function">coerce&lt;:</a> <a id="3349" class="Symbol">(</a><a id="3350" href="MJSF.Syntax.html#2655" class="InductiveConstructor">super</a> <a id="3356" href="MJSF.Values.html#3356" class="Bound">edge</a> <a id="3361" href="MJSF.Values.html#3361" class="Bound">σ</a><a id="3362" class="Symbol">)</a> <a id="3364" class="Symbol">(</a><a id="3365" href="MJSF.Values.html#ValuesG.Val.ref" class="InductiveConstructor">ref</a> <a id="3369" href="MJSF.Values.html#3369" class="Bound">f</a><a id="3370" class="Symbol">)</a> <a id="3372" href="MJSF.Values.html#3372" class="Bound">h</a>
    <a id="3378" class="Keyword">with</a> <a id="3383" class="Symbol">(</a><a id="3384" href="Data.List.All.html#lookup" class="Function">lookup</a> <a id="3391" href="MJSF.Values.html#3372" class="Bound">h</a> <a id="3393" href="MJSF.Values.html#3369" class="Bound">f</a><a id="3394" class="Symbol">)</a>
  <a id="3398" class="Symbol">...</a>  <a id="3403" class="Symbol">|</a> <a id="3405" class="Symbol">(_</a> <a id="3408" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="3410" href="MJSF.Values.html#3410" class="Bound">links</a><a id="3415" class="Symbol">)</a>  <a id="3418" class="Symbol">=</a>  <a id="3421" href="MJSF.Values.html#ValuesG.coerce%3C%3A" class="Function">coerce&lt;:</a> <a id="3430" class="Bound">σ</a> <a id="3432" class="Symbol">(</a><a id="3433" href="MJSF.Values.html#ValuesG.Val.ref" class="InductiveConstructor">ref</a> <a id="3437" class="Symbol">(</a><a id="3438" href="Data.List.All.html#lookup" class="Function">lookup</a> <a id="3445" href="MJSF.Values.html#3410" class="Bound">links</a> <a id="3451" class="Bound">edge</a><a id="3455" class="Symbol">))</a> <a id="3458" class="Bound">h</a>

</pre></body></html>