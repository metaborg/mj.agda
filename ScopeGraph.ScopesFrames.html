<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ScopeGraph.ScopesFrames</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="22" class="Keyword">open</a> <a id="27" class="Keyword">import</a> <a id="34" href="Data.Fin.html" class="Module">Data.Fin</a>
<a id="43" class="Keyword">open</a> <a id="48" class="Keyword">import</a> <a id="55" href="Data.List.Most.html" class="Module">Data.List.Most</a>
<a id="70" class="Keyword">open</a> <a id="75" class="Keyword">import</a> <a id="82" href="Data.List.All.html" class="Module">Data.List.All</a> <a id="96" class="Keyword">renaming</a> <a id="105" class="Symbol">(</a><a id="106" href="Data.List.All.html#lookup" class="Function">lookup</a> <a id="113" class="Symbol">to</a> <a id="116" href="Data.List.All.html#lookup" class="Function">lookup∀</a><a id="123" class="Symbol">)</a>
<a id="125" class="Keyword">open</a> <a id="130" class="Keyword">import</a> <a id="137" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="146" class="Keyword">hiding</a> <a id="153" class="Symbol">(</a><a id="154" href="Data.Vec.html#_%E2%88%88_" class="Datatype Operator">_∈_</a> <a id="158" class="Symbol">;</a> <a id="160" href="Data.Vec.html#_%E2%88%B7%CA%B3_" class="Function Operator">_∷ʳ_</a> <a id="165" class="Symbol">;</a> <a id="167" href="Data.Vec.html#_%3E%3E%3D_" class="Function Operator">_&gt;&gt;=_</a> <a id="173" class="Symbol">;</a> <a id="175" href="Data.Vec.html#init" class="Function">init</a><a id="179" class="Symbol">)</a>
<a id="181" class="Keyword">open</a> <a id="186" class="Keyword">import</a> <a id="193" href="Data.Product.html" class="Module">Data.Product</a>
<a id="206" class="Keyword">open</a> <a id="211" class="Keyword">import</a> <a id="218" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="256" class="Keyword">hiding</a> <a id="263" class="Symbol">(</a><a id="264" href="Relation.Binary.PropositionalEquality.html#Reveal_%C2%B7_is_.%5B_%5D" class="InductiveConstructor Operator">[_]</a><a id="267" class="Symbol">)</a>
<a id="269" class="Keyword">open</a> <a id="274" href="Relation.Binary.PropositionalEquality.html#%E2%89%A1-Reasoning" class="Module">≡-Reasoning</a>
<a id="286" class="Keyword">open</a> <a id="291" class="Keyword">import</a> <a id="298" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="308" class="Keyword">open</a> <a id="313" class="Keyword">import</a> <a id="320" href="Data.List.Prefix.html" class="Module">Data.List.Prefix</a>
<a id="337" class="Keyword">open</a> <a id="342" class="Keyword">import</a> <a id="349" href="Data.List.Properties.Extra.html" class="Module">Data.List.Properties.Extra</a>
<a id="376" class="Keyword">open</a> <a id="381" class="Keyword">import</a> <a id="388" href="Data.List.All.Properties.Extra.html" class="Module">Data.List.All.Properties.Extra</a>
<a id="419" class="Keyword">open</a> <a id="424" class="Keyword">import</a> <a id="431" href="Data.List.All.html" class="Module">Data.List.All</a> <a id="445" class="Symbol">as</a> <a id="448" class="Module">List∀</a> <a id="454" class="Keyword">hiding</a> <a id="461" class="Symbol">(</a><a id="462" href="Data.List.All.html#lookup" class="Function">lookup</a><a id="468" class="Symbol">)</a>
<a id="470" class="Keyword">open</a> <a id="475" class="Keyword">import</a> <a id="482" href="Coinduction.html" class="Module">Coinduction</a>
<a id="494" class="Keyword">open</a> <a id="499" class="Keyword">import</a> <a id="506" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="517" class="Keyword">hiding</a> <a id="524" class="Symbol">(</a><a id="525" href="Data.Maybe.Base.html#All" class="Datatype">All</a><a id="528" class="Symbol">)</a>
<a id="530" class="Keyword">open</a> <a id="535" class="Keyword">import</a> <a id="542" href="Common.Weakening.html" class="Module">Common.Weakening</a>
<a id="559" class="Keyword">open</a> <a id="564" class="Keyword">import</a> <a id="571" href="Common.Strength.html" class="Module">Common.Strength</a>

<a id="588" class="Comment">-- This file contains the Agda Scope Graph Library described in</a>
<a id="652" class="Comment">-- Section 4 of the paper.</a>

<a id="680" class="Comment">-- The definitions are parameterized by a scope graph, where a scope</a>
<a id="749" class="Comment">-- graph is a finite map from scope identifiers to scope shape</a>
<a id="812" class="Comment">-- descriptors.</a>
<a id="828" class="Comment">--</a>
<a id="831" class="Comment">-- The scope graph library is also parametric in what the notion of</a>
<a id="899" class="Comment">-- type is for declarations in the scope graph.</a>
<a id="947" class="Comment">--</a>
<a id="950" class="Comment">-- We use modules for this library parameterization.  The `k`</a>
<a id="1012" class="Comment">-- parameter of the `ScopesFrames` module represents the number of</a>
<a id="1079" class="Comment">-- scope identifiers in the scope graph that all definitions are</a>
<a id="1144" class="Comment">-- parameterized over; and the `Ty` parameter is a language-specific</a>
<a id="1213" class="Comment">-- notion of type.</a>

<a id="1233" class="Keyword">module</a> <a id="1240" href="ScopeGraph.ScopesFrames.html" class="Module">ScopeGraph.ScopesFrames</a> <a id="1264" class="Symbol">(</a><a id="1265" href="ScopeGraph.ScopesFrames.html#1265" class="Bound">k</a> <a id="1267" class="Symbol">:</a> <a id="1269" href="Agda.Builtin.Nat.html#%E2%84%95" class="Datatype">ℕ</a><a id="1270" class="Symbol">)</a> <a id="1272" class="Symbol">(</a><a id="1273" href="ScopeGraph.ScopesFrames.html#1273" class="Bound">Ty</a> <a id="1276" class="Symbol">:</a> <a id="1278" class="PrimitiveType">Set</a><a id="1281" class="Symbol">)</a> <a id="1283" class="Keyword">where</a>


<a id="1291" class="Comment">------------------</a>
<a id="1310" class="Comment">-- SCOPE GRAPHS --</a>
<a id="1329" class="Comment">------------------</a>

<a id="1349" class="Comment">-- Type aliases for scope identifiers (`Scope`s) and scope graphs</a>
<a id="1415" class="Comment">-- (`Graph`s).</a>
<a id="1430" class="Comment">--</a>
<a id="1433" class="Comment">-- As described in the paper, scope shapes are given by a list of</a>
<a id="1499" class="Comment">-- types corresponding to the declarations of the scope, and a list of</a>
<a id="1570" class="Comment">-- scopes, corresponding to the edges of the scope.</a>

<a id="Scope" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1629" class="Symbol">=</a> <a id="1631" href="Data.Fin.html#Fin" class="Datatype">Fin</a> <a id="1635" href="ScopeGraph.ScopesFrames.html#1265" class="Bound">k</a>
<a id="Graph" href="ScopeGraph.ScopesFrames.html#Graph" class="Function">Graph</a> <a id="1643" class="Symbol">=</a> <a id="1645" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1651" class="Symbol">→</a> <a id="1653" class="Symbol">(</a><a id="1654" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1659" href="ScopeGraph.ScopesFrames.html#1273" class="Bound">Ty</a> <a id="1662" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="1664" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1669" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a><a id="1674" class="Symbol">)</a>

<a id="1677" class="Comment">-- All the following definitions are parameterized by a scope graph</a>
<a id="1745" class="Comment">-- `g`.</a>

<a id="1754" class="Keyword">module</a> <a id="UsesGraph" href="ScopeGraph.ScopesFrames.html#UsesGraph" class="Module">UsesGraph</a> <a id="1771" class="Symbol">(</a><a id="1772" href="ScopeGraph.ScopesFrames.html#1772" class="Bound">g</a> <a id="1774" class="Symbol">:</a> <a id="1776" href="ScopeGraph.ScopesFrames.html#Graph" class="Function">Graph</a><a id="1781" class="Symbol">)</a> <a id="1783" class="Keyword">where</a>

  <a id="1792" class="Comment">-- Some projection functions:</a>
  <a id="UsesGraph.declsOf" href="ScopeGraph.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="1832" class="Symbol">:</a> <a id="1834" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1840" class="Symbol">→</a> <a id="1842" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1847" href="ScopeGraph.ScopesFrames.html#1273" class="Bound">Ty</a>     <a id="1854" class="Symbol">;</a>  <a id="1857" href="ScopeGraph.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="1865" href="ScopeGraph.ScopesFrames.html#1865" class="Bound">s</a>  <a id="1868" class="Symbol">=</a> <a id="1870" href="Data.Product.html#%CE%A3.proj%E2%82%81" class="Field">proj₁</a> <a id="1876" class="Symbol">(</a><a id="1877" href="ScopeGraph.ScopesFrames.html#1772" class="Bound">g</a> <a id="1879" href="ScopeGraph.ScopesFrames.html#1865" class="Bound">s</a><a id="1880" class="Symbol">)</a>
  <a id="UsesGraph.edgesOf" href="ScopeGraph.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="1892" class="Symbol">:</a> <a id="1894" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1900" class="Symbol">→</a> <a id="1902" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1907" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a>  <a id="1914" class="Symbol">;</a>  <a id="1917" href="ScopeGraph.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="1925" href="ScopeGraph.ScopesFrames.html#1925" class="Bound">s</a>  <a id="1928" class="Symbol">=</a> <a id="1930" href="Data.Product.html#%CE%A3.proj%E2%82%82" class="Field">proj₂</a> <a id="1936" class="Symbol">(</a><a id="1937" href="ScopeGraph.ScopesFrames.html#1772" class="Bound">g</a> <a id="1939" href="ScopeGraph.ScopesFrames.html#1925" class="Bound">s</a><a id="1940" class="Symbol">)</a>

  <a id="1945" class="Comment">-- A resolution path is a witness that we can traverse a sequence of</a>
  <a id="2016" class="Comment">-- scope edges (`_⟶_`) in `g` to arrive at a declaration of type</a>
  <a id="2083" class="Comment">-- `t`:</a>
  
  <a id="2096" class="Keyword">data</a> <a id="UsesGraph._⟶_" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">_⟶_</a> <a id="2105" class="Symbol">:</a> <a id="2107" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="2113" class="Symbol">→</a> <a id="2115" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="2121" class="Symbol">→</a> <a id="2123" class="PrimitiveType">Set</a> <a id="2127" class="Keyword">where</a>
    <a id="UsesGraph._⟶_.[]" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%9F%B6_.%5B%5D" class="InductiveConstructor">[]</a>   <a id="2142" class="Symbol">:</a>  <a id="2145" class="Symbol">∀</a> <a id="2147" class="Symbol">{</a><a id="2148" href="ScopeGraph.ScopesFrames.html#2148" class="Bound">s</a><a id="2149" class="Symbol">}</a> <a id="2151" class="Symbol">→</a> <a id="2153" href="ScopeGraph.ScopesFrames.html#2148" class="Bound">s</a> <a id="2155" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2157" href="ScopeGraph.ScopesFrames.html#2148" class="Bound">s</a>
    <a id="UsesGraph._⟶_._∷_" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%9F%B6_._%E2%88%B7_" class="InductiveConstructor Operator">_∷_</a>  <a id="2168" class="Symbol">:</a>  <a id="2171" class="Symbol">∀</a> <a id="2173" class="Symbol">{</a><a id="2174" href="ScopeGraph.ScopesFrames.html#2174" class="Bound">s</a> <a id="2176" href="ScopeGraph.ScopesFrames.html#2176" class="Bound">s&#39;</a> <a id="2179" href="ScopeGraph.ScopesFrames.html#2179" class="Bound">s&#39;&#39;</a><a id="2182" class="Symbol">}</a> <a id="2184" class="Symbol">→</a> <a id="2186" href="ScopeGraph.ScopesFrames.html#2176" class="Bound">s&#39;</a> <a id="2189" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="2191" href="ScopeGraph.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="2199" href="ScopeGraph.ScopesFrames.html#2174" class="Bound">s</a> <a id="2201" class="Symbol">→</a> <a id="2203" href="ScopeGraph.ScopesFrames.html#2176" class="Bound">s&#39;</a> <a id="2206" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2208" href="ScopeGraph.ScopesFrames.html#2179" class="Bound">s&#39;&#39;</a> <a id="2212" class="Symbol">→</a> <a id="2214" href="ScopeGraph.ScopesFrames.html#2174" class="Bound">s</a> <a id="2216" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2218" href="ScopeGraph.ScopesFrames.html#2179" class="Bound">s&#39;&#39;</a>

  <a id="2225" class="Keyword">data</a> <a id="UsesGraph._↦_" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">_↦_</a> <a id="2234" class="Symbol">(</a><a id="2235" href="ScopeGraph.ScopesFrames.html#2235" class="Bound">s</a> <a id="2237" class="Symbol">:</a> <a id="2239" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a><a id="2244" class="Symbol">)</a> <a id="2246" class="Symbol">(</a><a id="2247" href="ScopeGraph.ScopesFrames.html#2247" class="Bound">t</a> <a id="2249" class="Symbol">:</a> <a id="2251" href="ScopeGraph.ScopesFrames.html#1273" class="Bound">Ty</a><a id="2253" class="Symbol">)</a> <a id="2255" class="Symbol">:</a> <a id="2257" class="PrimitiveType">Set</a> <a id="2261" class="Keyword">where</a>
    <a id="UsesGraph._↦_.path" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%86%A6_.path" class="InductiveConstructor">path</a> <a id="2276" class="Symbol">:</a> <a id="2278" class="Symbol">∀{</a><a id="2280" href="ScopeGraph.ScopesFrames.html#2280" class="Bound">s&#39;</a><a id="2282" class="Symbol">}</a> <a id="2284" class="Symbol">→</a> <a id="2286" href="ScopeGraph.ScopesFrames.html#2235" class="Bound">s</a> <a id="2288" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2290" href="ScopeGraph.ScopesFrames.html#2280" class="Bound">s&#39;</a> <a id="2293" class="Symbol">→</a> <a id="2295" href="ScopeGraph.ScopesFrames.html#2247" class="Bound">t</a> <a id="2297" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="2299" href="ScopeGraph.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="2307" href="ScopeGraph.ScopesFrames.html#2280" class="Bound">s&#39;</a> <a id="2310" class="Symbol">→</a> <a id="2312" href="ScopeGraph.ScopesFrames.html#2235" class="Bound">s</a> <a id="2314" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">↦</a> <a id="2316" href="ScopeGraph.ScopesFrames.html#2247" class="Bound">t</a>

  <a id="2321" class="Comment">-- The definitions above fully define scope graphs.  The remaining</a>
  <a id="2390" class="Comment">-- definitions in this file are intrinsically-typed by this notion</a>
  <a id="2459" class="Comment">-- of scope graph.</a>


  <a id="2482" class="Comment">----------------------</a>
  <a id="2507" class="Comment">-- FRAMES AND HEAPS --</a>
  <a id="2532" class="Comment">----------------------</a>

  <a id="2558" class="Comment">-- Heap types summarize what the scope is for each frame location in</a>
  <a id="2629" class="Comment">-- the heap:</a>

  <a id="UsesGraph.HeapTy" href="ScopeGraph.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a> <a id="2652" class="Symbol">=</a> <a id="2654" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="2659" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a>

  <a id="2668" class="Comment">-- A frame pointer `Frame s Σ` is a witness that there is a frame</a>
  <a id="2736" class="Comment">-- location scoped by `s` in a heap typed by `Σ`:</a>

  <a id="UsesGraph.Frame" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="2795" class="Symbol">:</a> <a id="2797" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="2803" class="Symbol">→</a> <a id="2805" class="Symbol">(</a><a id="2806" href="ScopeGraph.ScopesFrames.html#2806" class="Bound">Σ</a> <a id="2808" class="Symbol">:</a> <a id="2810" href="ScopeGraph.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="2816" class="Symbol">)</a> <a id="2818" class="Symbol">→</a> <a id="2820" class="PrimitiveType">Set</a>
  <a id="2826" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="2832" href="ScopeGraph.ScopesFrames.html#2832" class="Bound">s</a> <a id="2834" href="ScopeGraph.ScopesFrames.html#2834" class="Bound">Σ</a> <a id="2836" class="Symbol">=</a> <a id="2838" href="ScopeGraph.ScopesFrames.html#2832" class="Bound">s</a> <a id="2840" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="2842" href="ScopeGraph.ScopesFrames.html#2834" class="Bound">Σ</a>

  <a id="2847" class="Comment">-- Concrete frames and heaps store values that are weakened when the</a>
  <a id="2918" class="Comment">-- heap is extended.  The following definitions are parameterized by</a>
  <a id="2989" class="Comment">-- a language-specific notion of weakenable value.</a>

  <a id="3043" class="Keyword">module</a> <a id="UsesVal" href="ScopeGraph.ScopesFrames.html#UsesVal" class="Module">UsesVal</a> <a id="3058" class="Symbol">(</a><a id="3059" href="ScopeGraph.ScopesFrames.html#3059" class="Bound">Val</a> <a id="3063" class="Symbol">:</a> <a id="3065" href="ScopeGraph.ScopesFrames.html#1273" class="Bound">Ty</a> <a id="3068" class="Symbol">→</a> <a id="3070" href="ScopeGraph.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a> <a id="3077" class="Symbol">→</a> <a id="3079" class="PrimitiveType">Set</a><a id="3082" class="Symbol">)</a>
                 <a id="3101" class="Symbol">(</a><a id="3102" href="ScopeGraph.ScopesFrames.html#3102" class="Bound">weaken-val</a> <a id="3113" class="Symbol">:</a> <a id="3115" class="Symbol">∀</a> <a id="3117" class="Symbol">{</a><a id="3118" href="ScopeGraph.ScopesFrames.html#3118" class="Bound">t</a> <a id="3120" href="ScopeGraph.ScopesFrames.html#3120" class="Bound">Σ</a> <a id="3122" href="ScopeGraph.ScopesFrames.html#3122" class="Bound">Σ&#39;</a><a id="3124" class="Symbol">}</a> <a id="3126" class="Symbol">→</a> <a id="3128" href="ScopeGraph.ScopesFrames.html#3120" class="Bound">Σ</a> <a id="3130" href="Data.List.Prefix.html#_%E2%8A%91_" class="Datatype Operator">⊑</a> <a id="3132" href="ScopeGraph.ScopesFrames.html#3122" class="Bound">Σ&#39;</a> <a id="3135" class="Symbol">→</a> <a id="3137" href="ScopeGraph.ScopesFrames.html#3059" class="Bound">Val</a> <a id="3141" href="ScopeGraph.ScopesFrames.html#3118" class="Bound">t</a> <a id="3143" href="ScopeGraph.ScopesFrames.html#3120" class="Bound">Σ</a> <a id="3145" class="Symbol">→</a> <a id="3147" href="ScopeGraph.ScopesFrames.html#3059" class="Bound">Val</a> <a id="3151" href="ScopeGraph.ScopesFrames.html#3118" class="Bound">t</a> <a id="3153" href="ScopeGraph.ScopesFrames.html#3122" class="Bound">Σ&#39;</a><a id="3155" class="Symbol">)</a> <a id="3157" class="Keyword">where</a>

    <a id="3168" class="Comment">-- Slots are given by a list of values that are in one-to-one</a>
    <a id="3234" class="Comment">-- correspondence with a list of declarations (types):</a>
  
    <a id="UsesGraph.UsesVal.Slots" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="3302" class="Symbol">:</a> <a id="3304" class="Symbol">(</a><a id="3305" href="ScopeGraph.ScopesFrames.html#3305" class="Bound">ds</a> <a id="3308" class="Symbol">:</a> <a id="3310" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="3315" href="ScopeGraph.ScopesFrames.html#1273" class="Bound">Ty</a><a id="3317" class="Symbol">)</a> <a id="3319" class="Symbol">→</a> <a id="3321" class="Symbol">(</a><a id="3322" href="ScopeGraph.ScopesFrames.html#3322" class="Bound">Σ</a> <a id="3324" class="Symbol">:</a> <a id="3326" href="ScopeGraph.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="3332" class="Symbol">)</a> <a id="3334" class="Symbol">→</a> <a id="3336" class="PrimitiveType">Set</a>
    <a id="3344" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="3350" href="ScopeGraph.ScopesFrames.html#3350" class="Bound">ds</a> <a id="3353" href="ScopeGraph.ScopesFrames.html#3353" class="Bound">Σ</a> <a id="3355" class="Symbol">=</a> <a id="3357" href="Data.List.All.html#All" class="Datatype">All</a> <a id="3361" class="Symbol">(λ</a> <a id="3364" href="ScopeGraph.ScopesFrames.html#3364" class="Bound">t</a> <a id="3366" class="Symbol">→</a> <a id="3368" href="ScopeGraph.ScopesFrames.html#3059" class="Bound">Val</a> <a id="3372" href="ScopeGraph.ScopesFrames.html#3364" class="Bound">t</a> <a id="3374" href="ScopeGraph.ScopesFrames.html#3353" class="Bound">Σ</a><a id="3375" class="Symbol">)</a> <a id="3377" href="ScopeGraph.ScopesFrames.html#3350" class="Bound">ds</a>

    <a id="3385" class="Comment">-- Links are given by a list of frame pointers (links) that are in</a>
    <a id="3456" class="Comment">-- one-to-one correspondence with a list of edges (scopes):</a>

    <a id="UsesGraph.UsesVal.Links" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="3527" class="Symbol">:</a> <a id="3529" class="Symbol">(</a><a id="3530" href="ScopeGraph.ScopesFrames.html#3530" class="Bound">es</a> <a id="3533" class="Symbol">:</a> <a id="3535" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="3540" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a><a id="3545" class="Symbol">)</a> <a id="3547" class="Symbol">→</a> <a id="3549" class="Symbol">(</a><a id="3550" href="ScopeGraph.ScopesFrames.html#3550" class="Bound">Σ</a> <a id="3552" class="Symbol">:</a> <a id="3554" href="ScopeGraph.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="3560" class="Symbol">)</a> <a id="3562" class="Symbol">→</a> <a id="3564" class="PrimitiveType">Set</a>
    <a id="3572" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="3578" href="ScopeGraph.ScopesFrames.html#3578" class="Bound">es</a> <a id="3581" href="ScopeGraph.ScopesFrames.html#3581" class="Bound">Σ</a> <a id="3583" class="Symbol">=</a> <a id="3585" href="Data.List.All.html#All" class="Datatype">All</a> <a id="3589" class="Symbol">(λ</a> <a id="3592" href="ScopeGraph.ScopesFrames.html#3592" class="Bound">s</a> <a id="3594" class="Symbol">→</a> <a id="3596" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="3602" href="ScopeGraph.ScopesFrames.html#3592" class="Bound">s</a> <a id="3604" href="ScopeGraph.ScopesFrames.html#3581" class="Bound">Σ</a><a id="3605" class="Symbol">)</a> <a id="3607" href="ScopeGraph.ScopesFrames.html#3578" class="Bound">es</a>

    <a id="3615" class="Comment">-- A heap frame for a scope `s` is given by a set of slots and</a>
    <a id="3682" class="Comment">-- links that are in one-to-one correspondence with the</a>
    <a id="3742" class="Comment">-- declarations and edges of the scope:</a>

    <a id="UsesGraph.UsesVal.HeapFrame" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="3797" class="Symbol">:</a> <a id="3799" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="3805" class="Symbol">→</a> <a id="3807" href="ScopeGraph.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a> <a id="3814" class="Symbol">→</a> <a id="3816" class="PrimitiveType">Set</a>
    <a id="3824" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="3834" href="ScopeGraph.ScopesFrames.html#3834" class="Bound">s</a> <a id="3836" href="ScopeGraph.ScopesFrames.html#3836" class="Bound">Σ</a> <a id="3838" class="Symbol">=</a> <a id="3840" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="3846" class="Symbol">(</a><a id="3847" href="ScopeGraph.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="3855" href="ScopeGraph.ScopesFrames.html#3834" class="Bound">s</a><a id="3856" class="Symbol">)</a> <a id="3858" href="ScopeGraph.ScopesFrames.html#3836" class="Bound">Σ</a> <a id="3860" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="3862" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="3868" class="Symbol">(</a><a id="3869" href="ScopeGraph.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="3877" href="ScopeGraph.ScopesFrames.html#3834" class="Bound">s</a><a id="3878" class="Symbol">)</a> <a id="3880" href="ScopeGraph.ScopesFrames.html#3836" class="Bound">Σ</a>

    <a id="3887" class="Comment">-- A heap typed by `Σ` is given by a list of heap frames such that</a>
    <a id="3958" class="Comment">-- each frame location is in the heap is typed by the</a>
    <a id="4016" class="Comment">-- corresponding location in `Σ`.</a>

    <a id="UsesGraph.UsesVal.Heap" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="4060" class="Symbol">:</a> <a id="4062" class="Symbol">(</a><a id="4063" href="ScopeGraph.ScopesFrames.html#4063" class="Bound">Σ</a> <a id="4065" class="Symbol">:</a> <a id="4067" href="ScopeGraph.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="4073" class="Symbol">)</a> <a id="4075" class="Symbol">→</a> <a id="4077" class="PrimitiveType">Set</a>
    <a id="4085" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="4090" href="ScopeGraph.ScopesFrames.html#4090" class="Bound">Σ</a> <a id="4092" class="Symbol">=</a> <a id="4094" href="Data.List.All.html#All" class="Datatype">All</a> <a id="4098" class="Symbol">(λ</a> <a id="4101" href="ScopeGraph.ScopesFrames.html#4101" class="Bound">s</a> <a id="4103" class="Symbol">→</a> <a id="4105" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="4115" href="ScopeGraph.ScopesFrames.html#4101" class="Bound">s</a> <a id="4117" href="ScopeGraph.ScopesFrames.html#4090" class="Bound">Σ</a><a id="4118" class="Symbol">)</a> <a id="4120" href="ScopeGraph.ScopesFrames.html#4090" class="Bound">Σ</a>


    <a id="4128" class="Comment">----------------------</a>
    <a id="4155" class="Comment">-- FRAME OPERATIONS --</a>
    <a id="4182" class="Comment">----------------------</a>

    <a id="4210" class="Comment">-- Frame initialization extends the heap, requiring heap type</a>
    <a id="4276" class="Comment">-- weakening.  The `Common.Weakening` module defines a generic</a>
    <a id="4343" class="Comment">-- `Weakenable` record, which we instantiate for each entity that</a>
    <a id="4413" class="Comment">-- is required to be weakenable.  We use Agda&#39;s instance arguments</a>
    <a id="4484" class="Comment">-- to automatically resolve the right notion of weakening where</a>
    <a id="4552" class="Comment">-- possible.</a>
    <a id="4569" class="Comment">--</a>
    <a id="4576" class="Comment">-- The following brings a `wk` function into scope, corresponding</a>
    <a id="4646" class="Comment">-- to the `wk` field of the `Weakenable` record type, which is</a>
    <a id="4713" class="Comment">-- parameterized by an `⦃ _ : Weakenable p ⦄` argument which is</a>
    <a id="4781" class="Comment">-- automatically resolved when possible (see</a>
    <a id="4830" class="Comment">-- http://agda.readthedocs.io/en/v2.5.3/language/instance-arguments.html).</a>

    <a id="4910" class="Keyword">open</a> <a id="4915" href="Common.Weakening.html#Weakenable" class="Module">Weakenable</a> <a id="4926" class="Symbol">⦃...⦄</a>

    <a id="4937" class="Comment">-- We add some instances to the instance argument scope:</a>

    <a id="4999" class="Keyword">instance</a>
      <a id="UsesGraph.UsesVal.weaken-val&#39;" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.weaken-val%27" class="Function">weaken-val&#39;</a> <a id="5026" class="Symbol">:</a> <a id="5028" class="Symbol">∀</a> <a id="5030" class="Symbol">{</a><a id="5031" href="ScopeGraph.ScopesFrames.html#5031" class="Bound">t</a><a id="5032" class="Symbol">}</a> <a id="5034" class="Symbol">→</a> <a id="5036" href="Common.Weakening.html#Weakenable" class="Record">Weakenable</a> <a id="5047" class="Symbol">(λ</a> <a id="5050" href="ScopeGraph.ScopesFrames.html#5050" class="Bound">Σ</a> <a id="5052" class="Symbol">→</a> <a id="5054" href="ScopeGraph.ScopesFrames.html#3059" class="Bound">Val</a> <a id="5058" href="ScopeGraph.ScopesFrames.html#5031" class="Bound">t</a> <a id="5060" href="ScopeGraph.ScopesFrames.html#5050" class="Bound">Σ</a><a id="5061" class="Symbol">)</a>
      <a id="5069" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.weaken-val%27" class="Function">weaken-val&#39;</a> <a id="5081" class="Symbol">=</a> <a id="5083" class="Keyword">record</a> <a id="5090" class="Symbol">{</a> <a id="5092" class="Field">wk</a> <a id="5095" class="Symbol">=</a> <a id="5097" href="ScopeGraph.ScopesFrames.html#3102" class="Bound">weaken-val</a> <a id="5108" class="Symbol">}</a>

      <a id="UsesGraph.UsesVal.weaken-heapframe" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.weaken-heapframe" class="Function">weaken-heapframe</a> <a id="5134" class="Symbol">:</a> <a id="5136" class="Symbol">∀</a> <a id="5138" class="Symbol">{</a><a id="5139" href="ScopeGraph.ScopesFrames.html#5139" class="Bound">s</a><a id="5140" class="Symbol">}</a> <a id="5142" class="Symbol">→</a> <a id="5144" href="Common.Weakening.html#Weakenable" class="Record">Weakenable</a> <a id="5155" class="Symbol">(</a><a id="5156" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="5166" href="ScopeGraph.ScopesFrames.html#5139" class="Bound">s</a><a id="5167" class="Symbol">)</a>
      <a id="5175" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.weaken-heapframe" class="Function">weaken-heapframe</a> <a id="5192" class="Symbol">=</a> <a id="5194" class="Keyword">record</a> <a id="5201" class="Symbol">{</a> <a id="5203" class="Field">wk</a> <a id="5206" class="Symbol">=</a> <a id="5208" class="Symbol">λ{</a> <a id="5211" href="ScopeGraph.ScopesFrames.html#5211" class="Bound">ext</a> <a id="5215" class="Symbol">(</a><a id="5216" href="ScopeGraph.ScopesFrames.html#5216" class="Bound">slots</a> <a id="5222" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="5224" href="ScopeGraph.ScopesFrames.html#5224" class="Bound">links</a><a id="5229" class="Symbol">)</a> <a id="5231" class="Symbol">→</a> <a id="5233" class="Symbol">(</a><a id="5234" href="Common.Weakening.html#228" class="Field">wk</a> <a id="5237" href="ScopeGraph.ScopesFrames.html#5211" class="Bound">ext</a> <a id="5241" href="ScopeGraph.ScopesFrames.html#5216" class="Bound">slots</a> <a id="5247" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="5249" href="Common.Weakening.html#228" class="Field">wk</a> <a id="5252" href="ScopeGraph.ScopesFrames.html#5211" class="Bound">ext</a> <a id="5256" href="ScopeGraph.ScopesFrames.html#5224" class="Bound">links</a><a id="5261" class="Symbol">)</a> <a id="5263" class="Symbol">}</a> <a id="5265" class="Symbol">}</a>

      <a id="UsesGraph.UsesVal.weaken-frame" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.weaken-frame" class="Function">weaken-frame</a> <a id="5287" class="Symbol">:</a> <a id="5289" class="Symbol">∀</a> <a id="5291" class="Symbol">{</a><a id="5292" href="ScopeGraph.ScopesFrames.html#5292" class="Bound">s</a><a id="5293" class="Symbol">}</a> <a id="5295" class="Symbol">→</a> <a id="5297" href="Common.Weakening.html#Weakenable" class="Record">Weakenable</a> <a id="5308" class="Symbol">(</a><a id="5309" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="5315" href="ScopeGraph.ScopesFrames.html#5292" class="Bound">s</a><a id="5316" class="Symbol">)</a>
      <a id="5324" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.weaken-frame" class="Function">weaken-frame</a> <a id="5337" class="Symbol">=</a> <a id="5339" class="Keyword">record</a> <a id="5346" class="Symbol">{</a> <a id="5348" class="Field">wk</a> <a id="5351" class="Symbol">=</a> <a id="5353" href="Common.Weakening.html#Weakenable.wk" class="Field">Weakenable.wk</a> <a id="5367" href="Common.Weakening.html#any-weakenable" class="Function">any-weakenable</a> <a id="5382" class="Symbol">}</a>

    <a id="5389" class="Comment">-- Frame initialization takes as argument:</a>
    <a id="5436" class="Comment">--</a>
    <a id="5443" class="Comment">-- * a scope `s`;</a>
    <a id="5465" class="Comment">--</a>
    <a id="5472" class="Comment">-- * a scope shape witness which asserts that looking up `s` in</a>
    <a id="5540" class="Comment">--   the current scope graph `g` yields a scope shape where the</a>
    <a id="5608" class="Comment">--   declarations are given by a list of types `ds`, and scope</a>
    <a id="5675" class="Comment">--   edges are given by a list of scopes `es`;</a>
    <a id="5726" class="Comment">--</a>
    <a id="5733" class="Comment">-- * a set of slots typed by `ds`;</a>
    <a id="5772" class="Comment">--</a>
    <a id="5779" class="Comment">-- * a set of links typed by `es`; and</a>
    <a id="5822" class="Comment">--</a>
    <a id="5829" class="Comment">-- * a heap typed by the heap type `Σ` which also types the slots</a>
    <a id="5899" class="Comment">--   and links.</a>
    <a id="5919" class="Comment">--</a>
    <a id="5926" class="Comment">-- The operation returns an extended heap (`∷ʳ` appends a single</a>
    <a id="5995" class="Comment">-- element to a list, and is defined in `Data.List.Base` in the</a>
    <a id="6063" class="Comment">-- Agda Standard Library) and a frame pointer into the extended</a>
    <a id="6131" class="Comment">-- heap, i.e., the newly allocated and initialized frame.</a>

    <a id="UsesGraph.UsesVal.initFrame" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.initFrame" class="Function">initFrame</a>   <a id="6206" class="Symbol">:</a>  <a id="6209" class="Symbol">(</a><a id="6210" href="ScopeGraph.ScopesFrames.html#6210" class="Bound">s</a> <a id="6212" class="Symbol">:</a> <a id="6214" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a><a id="6219" class="Symbol">)</a> <a id="6221" class="Symbol">→</a> <a id="6223" class="Symbol">∀</a> <a id="6225" class="Symbol">{</a><a id="6226" href="ScopeGraph.ScopesFrames.html#6226" class="Bound">Σ</a> <a id="6228" href="ScopeGraph.ScopesFrames.html#6228" class="Bound">ds</a> <a id="6231" href="ScopeGraph.ScopesFrames.html#6231" class="Bound">es</a><a id="6233" class="Symbol">}⦃</a> <a id="6236" href="ScopeGraph.ScopesFrames.html#6236" class="Bound">shape</a> <a id="6242" class="Symbol">:</a> <a id="6244" href="ScopeGraph.ScopesFrames.html#1772" class="Bound">g</a> <a id="6246" href="ScopeGraph.ScopesFrames.html#6210" class="Bound">s</a> <a id="6248" href="Agda.Builtin.Equality.html#_%E2%89%A1_" class="Datatype Operator">≡</a> <a id="6250" class="Symbol">(</a><a id="6251" href="ScopeGraph.ScopesFrames.html#6228" class="Bound">ds</a> <a id="6254" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="6256" href="ScopeGraph.ScopesFrames.html#6231" class="Bound">es</a><a id="6258" class="Symbol">)</a> <a id="6260" class="Symbol">⦄</a> <a id="6262" class="Symbol">→</a>
                   <a id="6283" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="6289" href="ScopeGraph.ScopesFrames.html#6228" class="Bound">ds</a> <a id="6292" href="ScopeGraph.ScopesFrames.html#6226" class="Bound">Σ</a> <a id="6294" class="Symbol">→</a> <a id="6296" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="6302" href="ScopeGraph.ScopesFrames.html#6231" class="Bound">es</a> <a id="6305" href="ScopeGraph.ScopesFrames.html#6226" class="Bound">Σ</a> <a id="6307" class="Symbol">→</a> <a id="6309" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="6314" href="ScopeGraph.ScopesFrames.html#6226" class="Bound">Σ</a> <a id="6316" class="Symbol">→</a> <a id="6318" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="6324" href="ScopeGraph.ScopesFrames.html#6210" class="Bound">s</a> <a id="6326" class="Symbol">(</a><a id="6327" href="ScopeGraph.ScopesFrames.html#6226" class="Bound">Σ</a> <a id="6329" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="6332" href="ScopeGraph.ScopesFrames.html#6210" class="Bound">s</a><a id="6333" class="Symbol">)</a> <a id="6335" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="6337" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="6342" class="Symbol">(</a><a id="6343" href="ScopeGraph.ScopesFrames.html#6226" class="Bound">Σ</a> <a id="6345" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="6348" href="ScopeGraph.ScopesFrames.html#6210" class="Bound">s</a><a id="6349" class="Symbol">)</a>
    <a id="6355" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.initFrame" class="Function">initFrame</a> <a id="6365" href="ScopeGraph.ScopesFrames.html#6365" class="Bound">s</a> <a id="6367" class="Symbol">{</a><a id="6368" href="ScopeGraph.ScopesFrames.html#6368" class="Bound">Σ</a><a id="6369" class="Symbol">}</a> <a id="6371" class="Symbol">⦃</a> <a id="6373" href="Agda.Builtin.Equality.html#_%E2%89%A1_.refl" class="InductiveConstructor">refl</a> <a id="6378" class="Symbol">⦄</a> <a id="6380" href="ScopeGraph.ScopesFrames.html#6380" class="Bound">slots</a> <a id="6386" href="ScopeGraph.ScopesFrames.html#6386" class="Bound">links</a> <a id="6392" href="ScopeGraph.ScopesFrames.html#6392" class="Bound">h</a> <a id="6394" class="Symbol">=</a>
      <a id="6402" class="Keyword">let</a> <a id="6406" href="ScopeGraph.ScopesFrames.html#6406" class="Bound">ext</a> <a id="6410" class="Symbol">=</a> <a id="6412" href="Data.List.Prefix.html#%E2%88%B7%CA%B3-%E2%8A%92" class="Function">∷ʳ-⊒</a> <a id="6417" href="ScopeGraph.ScopesFrames.html#6365" class="Bound">s</a> <a id="6419" href="ScopeGraph.ScopesFrames.html#6368" class="Bound">Σ</a> <a id="6421" class="Comment">-- heap extension fact</a>
          <a id="6454" href="ScopeGraph.ScopesFrames.html#6454" class="Bound">f&#39;</a>  <a id="6458" class="Symbol">=</a> <a id="6460" href="Data.List.Properties.Extra.html#%E2%88%88-%E2%88%B7%CA%B3" class="Function">∈-∷ʳ</a> <a id="6465" href="ScopeGraph.ScopesFrames.html#6368" class="Bound">Σ</a> <a id="6467" href="ScopeGraph.ScopesFrames.html#6365" class="Bound">s</a> <a id="6469" class="Comment">-- updated frame pointer witness</a>
          <a id="6512" href="ScopeGraph.ScopesFrames.html#6512" class="Bound">h&#39;</a>  <a id="6516" class="Symbol">=</a> <a id="6518" class="Symbol">(</a><a id="6519" href="Common.Weakening.html#228" class="Field">wk</a> <a id="6522" href="ScopeGraph.ScopesFrames.html#6406" class="Bound">ext</a> <a id="6526" href="ScopeGraph.ScopesFrames.html#6392" class="Bound">h</a><a id="6527" class="Symbol">)</a> <a id="6529" href="Data.List.All.Properties.Extra.html#_all-%E2%88%B7%CA%B3_" class="Function Operator">all-∷ʳ</a> <a id="6536" class="Symbol">(</a><a id="6537" href="Common.Weakening.html#228" class="Field">wk</a> <a id="6540" href="ScopeGraph.ScopesFrames.html#6406" class="Bound">ext</a> <a id="6544" href="ScopeGraph.ScopesFrames.html#6380" class="Bound">slots</a> <a id="6550" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="6552" href="Common.Weakening.html#228" class="Field">wk</a> <a id="6555" href="ScopeGraph.ScopesFrames.html#6406" class="Bound">ext</a> <a id="6559" href="ScopeGraph.ScopesFrames.html#6386" class="Bound">links</a><a id="6564" class="Symbol">)</a> <a id="6566" class="Comment">-- extended heap</a>
      <a id="6589" class="Keyword">in</a> <a id="6592" class="Symbol">(</a><a id="6593" href="ScopeGraph.ScopesFrames.html#6454" class="Bound">f&#39;</a> <a id="6596" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="6598" href="ScopeGraph.ScopesFrames.html#6512" class="Bound">h&#39;</a><a id="6600" class="Symbol">)</a>

    <a id="6607" class="Comment">-- Frames may be self-referential.  For example, the values stored</a>
    <a id="6678" class="Comment">-- in the slots of a frame may contain pointers to the frame</a>
    <a id="6743" class="Comment">-- itself.  The `initFrame` function above does not support</a>
    <a id="6807" class="Comment">-- initializing such self-referential slots, since the slots are</a>
    <a id="6876" class="Comment">-- assumed to be typed under the unextended heap.</a>
    <a id="6930" class="Comment">--</a>
    <a id="6937" class="Comment">-- The `initFrameι` function we now define takes as argument a</a>
    <a id="7004" class="Comment">-- function to be used to initialize possibly-self-referential</a>
    <a id="7071" class="Comment">-- frame slots.  The function takes as argument a frame pointer</a>
    <a id="7139" class="Comment">-- into a heap extended by the scope that we are currently</a>
    <a id="7202" class="Comment">-- initializing, and slots are typed under this extended heap;</a>
    <a id="7269" class="Comment">-- hence the slots can have self-references to the frame currently</a>
    <a id="7340" class="Comment">-- being initialized.</a>

    <a id="UsesGraph.UsesVal.initFrameι" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.initFrame%CE%B9" class="Function">initFrameι</a> <a id="7378" class="Symbol">:</a> <a id="7380" class="Symbol">(</a><a id="7381" href="ScopeGraph.ScopesFrames.html#7381" class="Bound">s</a> <a id="7383" class="Symbol">:</a> <a id="7385" href="ScopeGraph.ScopesFrames.html#Scope" class="Function">Scope</a><a id="7390" class="Symbol">)</a> <a id="7392" class="Symbol">→</a> <a id="7394" class="Symbol">∀</a> <a id="7396" class="Symbol">{</a><a id="7397" href="ScopeGraph.ScopesFrames.html#7397" class="Bound">Σ</a> <a id="7399" href="ScopeGraph.ScopesFrames.html#7399" class="Bound">ds</a> <a id="7402" href="ScopeGraph.ScopesFrames.html#7402" class="Bound">es</a><a id="7404" class="Symbol">}⦃</a> <a id="7407" href="ScopeGraph.ScopesFrames.html#7407" class="Bound">shape</a> <a id="7413" class="Symbol">:</a> <a id="7415" href="ScopeGraph.ScopesFrames.html#1772" class="Bound">g</a> <a id="7417" href="ScopeGraph.ScopesFrames.html#7381" class="Bound">s</a> <a id="7419" href="Agda.Builtin.Equality.html#_%E2%89%A1_" class="Datatype Operator">≡</a> <a id="7421" class="Symbol">(</a><a id="7422" href="ScopeGraph.ScopesFrames.html#7399" class="Bound">ds</a> <a id="7425" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="7427" href="ScopeGraph.ScopesFrames.html#7402" class="Bound">es</a><a id="7429" class="Symbol">)</a> <a id="7431" class="Symbol">⦄</a> <a id="7433" class="Symbol">→</a>
                 <a id="7452" class="Symbol">(</a><a id="7453" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="7459" href="ScopeGraph.ScopesFrames.html#7381" class="Bound">s</a> <a id="7461" class="Symbol">(</a><a id="7462" href="ScopeGraph.ScopesFrames.html#7397" class="Bound">Σ</a> <a id="7464" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7467" href="ScopeGraph.ScopesFrames.html#7381" class="Bound">s</a><a id="7468" class="Symbol">)</a> <a id="7470" class="Symbol">→</a> <a id="7472" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="7478" href="ScopeGraph.ScopesFrames.html#7399" class="Bound">ds</a> <a id="7481" class="Symbol">(</a><a id="7482" href="ScopeGraph.ScopesFrames.html#7397" class="Bound">Σ</a> <a id="7484" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7487" href="ScopeGraph.ScopesFrames.html#7381" class="Bound">s</a><a id="7488" class="Symbol">))</a> <a id="7491" class="Symbol">→</a> <a id="7493" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="7499" href="ScopeGraph.ScopesFrames.html#7402" class="Bound">es</a> <a id="7502" href="ScopeGraph.ScopesFrames.html#7397" class="Bound">Σ</a> <a id="7504" class="Symbol">→</a> <a id="7506" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="7511" href="ScopeGraph.ScopesFrames.html#7397" class="Bound">Σ</a> <a id="7513" class="Symbol">→</a>
                 <a id="7532" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="7538" href="ScopeGraph.ScopesFrames.html#7381" class="Bound">s</a> <a id="7540" class="Symbol">(</a><a id="7541" href="ScopeGraph.ScopesFrames.html#7397" class="Bound">Σ</a> <a id="7543" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7546" href="ScopeGraph.ScopesFrames.html#7381" class="Bound">s</a><a id="7547" class="Symbol">)</a> <a id="7549" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="7551" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="7556" class="Symbol">(</a><a id="7557" href="ScopeGraph.ScopesFrames.html#7397" class="Bound">Σ</a> <a id="7559" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7562" href="ScopeGraph.ScopesFrames.html#7381" class="Bound">s</a><a id="7563" class="Symbol">)</a>
    <a id="7569" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.initFrame%CE%B9" class="Function">initFrameι</a> <a id="7580" href="ScopeGraph.ScopesFrames.html#7580" class="Bound">s</a> <a id="7582" class="Symbol">{</a><a id="7583" href="ScopeGraph.ScopesFrames.html#7583" class="Bound">Σ</a><a id="7584" class="Symbol">}</a> <a id="7586" class="Symbol">⦃</a> <a id="7588" href="Agda.Builtin.Equality.html#_%E2%89%A1_.refl" class="InductiveConstructor">refl</a> <a id="7593" class="Symbol">⦄</a> <a id="7595" href="ScopeGraph.ScopesFrames.html#7595" class="Bound">slots</a> <a id="7601" href="ScopeGraph.ScopesFrames.html#7601" class="Bound">links</a> <a id="7607" href="ScopeGraph.ScopesFrames.html#7607" class="Bound">h</a> <a id="7609" class="Symbol">=</a>
      <a id="7617" class="Keyword">let</a> <a id="7621" href="ScopeGraph.ScopesFrames.html#7621" class="Bound">ext</a> <a id="7625" class="Symbol">=</a> <a id="7627" href="Data.List.Prefix.html#%E2%88%B7%CA%B3-%E2%8A%92" class="Function">∷ʳ-⊒</a> <a id="7632" href="ScopeGraph.ScopesFrames.html#7580" class="Bound">s</a> <a id="7634" href="ScopeGraph.ScopesFrames.html#7583" class="Bound">Σ</a> <a id="7636" class="Comment">-- heap extension fact</a>
          <a id="7669" href="ScopeGraph.ScopesFrames.html#7669" class="Bound">f&#39;</a>  <a id="7673" class="Symbol">=</a> <a id="7675" href="Data.List.Properties.Extra.html#%E2%88%88-%E2%88%B7%CA%B3" class="Function">∈-∷ʳ</a> <a id="7680" href="ScopeGraph.ScopesFrames.html#7583" class="Bound">Σ</a> <a id="7682" href="ScopeGraph.ScopesFrames.html#7580" class="Bound">s</a> <a id="7684" class="Comment">-- updated frame pointer witness</a>
          <a id="7727" href="ScopeGraph.ScopesFrames.html#7727" class="Bound">h&#39;</a>  <a id="7731" class="Symbol">=</a> <a id="7733" class="Symbol">(</a><a id="7734" href="Common.Weakening.html#228" class="Field">wk</a> <a id="7737" href="ScopeGraph.ScopesFrames.html#7621" class="Bound">ext</a> <a id="7741" href="ScopeGraph.ScopesFrames.html#7607" class="Bound">h</a><a id="7742" class="Symbol">)</a> <a id="7744" href="Data.List.All.Properties.Extra.html#_all-%E2%88%B7%CA%B3_" class="Function Operator">all-∷ʳ</a> <a id="7751" class="Symbol">(</a><a id="7752" href="ScopeGraph.ScopesFrames.html#7595" class="Bound">slots</a> <a id="7758" href="ScopeGraph.ScopesFrames.html#7669" class="Bound">f&#39;</a> <a id="7761" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="7763" href="Common.Weakening.html#228" class="Field">wk</a> <a id="7766" href="ScopeGraph.ScopesFrames.html#7621" class="Bound">ext</a> <a id="7770" href="ScopeGraph.ScopesFrames.html#7601" class="Bound">links</a><a id="7775" class="Symbol">)</a> <a id="7777" class="Comment">-- extended heap</a>
      <a id="7800" class="Keyword">in</a> <a id="7803" class="Symbol">(</a><a id="7804" href="ScopeGraph.ScopesFrames.html#7669" class="Bound">f&#39;</a> <a id="7807" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="7809" href="ScopeGraph.ScopesFrames.html#7727" class="Bound">h&#39;</a><a id="7811" class="Symbol">)</a>


    <a id="7819" class="Comment">-- Given a witness that a declaration typed by `t` is in a scope,</a>
    <a id="7889" class="Comment">-- and a frame pointer, we can fetch the well-typed value stored</a>
    <a id="7958" class="Comment">-- in the corresponding frame slot:</a>

    <a id="UsesGraph.UsesVal.getSlot" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getSlot" class="Function">getSlot</a> <a id="8007" class="Symbol">:</a> <a id="8009" class="Symbol">∀</a> <a id="8011" class="Symbol">{</a><a id="8012" href="ScopeGraph.ScopesFrames.html#8012" class="Bound">s</a> <a id="8014" href="ScopeGraph.ScopesFrames.html#8014" class="Bound">t</a> <a id="8016" href="ScopeGraph.ScopesFrames.html#8016" class="Bound">Σ</a><a id="8017" class="Symbol">}</a> <a id="8019" class="Symbol">→</a> <a id="8021" href="ScopeGraph.ScopesFrames.html#8014" class="Bound">t</a> <a id="8023" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="8025" href="ScopeGraph.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="8033" href="ScopeGraph.ScopesFrames.html#8012" class="Bound">s</a> <a id="8035" class="Symbol">→</a> <a id="8037" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8043" href="ScopeGraph.ScopesFrames.html#8012" class="Bound">s</a> <a id="8045" href="ScopeGraph.ScopesFrames.html#8016" class="Bound">Σ</a> <a id="8047" class="Symbol">→</a> <a id="8049" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8054" href="ScopeGraph.ScopesFrames.html#8016" class="Bound">Σ</a> <a id="8056" class="Symbol">→</a> <a id="8058" href="ScopeGraph.ScopesFrames.html#3059" class="Bound">Val</a> <a id="8062" href="ScopeGraph.ScopesFrames.html#8014" class="Bound">t</a> <a id="8064" href="ScopeGraph.ScopesFrames.html#8016" class="Bound">Σ</a>
    <a id="8070" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getSlot" class="Function">getSlot</a> <a id="8078" href="ScopeGraph.ScopesFrames.html#8078" class="Bound">d</a> <a id="8080" href="ScopeGraph.ScopesFrames.html#8080" class="Bound">f</a> <a id="8082" href="ScopeGraph.ScopesFrames.html#8082" class="Bound">h</a>
      <a id="8090" class="Keyword">with</a> <a id="8095" class="Symbol">(</a><a id="8096" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8109" href="ScopeGraph.ScopesFrames.html#8082" class="Bound">h</a> <a id="8111" href="ScopeGraph.ScopesFrames.html#8080" class="Bound">f</a><a id="8112" class="Symbol">)</a>
    <a id="8118" class="Symbol">...</a>  <a id="8123" class="Symbol">|</a> <a id="8125" class="Symbol">(</a><a id="8126" href="ScopeGraph.ScopesFrames.html#8126" class="Bound">slots</a> <a id="8132" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8134" href="ScopeGraph.ScopesFrames.html#8134" class="Bound">links</a><a id="8139" class="Symbol">)</a> <a id="8141" class="Symbol">=</a> <a id="8143" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8156" href="ScopeGraph.ScopesFrames.html#8126" class="Bound">slots</a> <a id="8162" class="Bound">d</a>

    <a id="8169" class="Comment">-- Given a witness that a declaration typed by `t` is in a scope,</a>
    <a id="8239" class="Comment">-- and a frame pointer, we can mutate the corresponding slot in a</a>
    <a id="8309" class="Comment">-- type preserving manner:</a>

    <a id="UsesGraph.UsesVal.setSlot" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.setSlot" class="Function">setSlot</a> <a id="8349" class="Symbol">:</a> <a id="8351" class="Symbol">∀</a> <a id="8353" class="Symbol">{</a><a id="8354" href="ScopeGraph.ScopesFrames.html#8354" class="Bound">s</a> <a id="8356" href="ScopeGraph.ScopesFrames.html#8356" class="Bound">t</a> <a id="8358" href="ScopeGraph.ScopesFrames.html#8358" class="Bound">Σ</a><a id="8359" class="Symbol">}</a> <a id="8361" class="Symbol">→</a> <a id="8363" href="ScopeGraph.ScopesFrames.html#8356" class="Bound">t</a> <a id="8365" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="8367" href="ScopeGraph.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="8375" href="ScopeGraph.ScopesFrames.html#8354" class="Bound">s</a> <a id="8377" class="Symbol">→</a> <a id="8379" href="ScopeGraph.ScopesFrames.html#3059" class="Bound">Val</a> <a id="8383" href="ScopeGraph.ScopesFrames.html#8356" class="Bound">t</a> <a id="8385" href="ScopeGraph.ScopesFrames.html#8358" class="Bound">Σ</a> <a id="8387" class="Symbol">→</a> <a id="8389" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8395" href="ScopeGraph.ScopesFrames.html#8354" class="Bound">s</a> <a id="8397" href="ScopeGraph.ScopesFrames.html#8358" class="Bound">Σ</a> <a id="8399" class="Symbol">→</a> <a id="8401" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8406" href="ScopeGraph.ScopesFrames.html#8358" class="Bound">Σ</a> <a id="8408" class="Symbol">→</a> <a id="8410" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8415" href="ScopeGraph.ScopesFrames.html#8358" class="Bound">Σ</a>
    <a id="8421" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.setSlot" class="Function">setSlot</a> <a id="8429" href="ScopeGraph.ScopesFrames.html#8429" class="Bound">d</a> <a id="8431" href="ScopeGraph.ScopesFrames.html#8431" class="Bound">v</a> <a id="8433" href="ScopeGraph.ScopesFrames.html#8433" class="Bound">f</a> <a id="8435" href="ScopeGraph.ScopesFrames.html#8435" class="Bound">h</a>
      <a id="8443" class="Keyword">with</a> <a id="8448" class="Symbol">(</a><a id="8449" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8462" href="ScopeGraph.ScopesFrames.html#8435" class="Bound">h</a> <a id="8464" href="ScopeGraph.ScopesFrames.html#8433" class="Bound">f</a><a id="8465" class="Symbol">)</a>
    <a id="8471" class="Symbol">...</a>  <a id="8476" class="Symbol">|</a> <a id="8478" class="Symbol">(</a><a id="8479" href="ScopeGraph.ScopesFrames.html#8479" class="Bound">slots</a> <a id="8485" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8487" href="ScopeGraph.ScopesFrames.html#8487" class="Bound">links</a><a id="8492" class="Symbol">)</a> <a id="8494" class="Symbol">=</a> <a id="8496" class="Bound">h</a> <a id="8498" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8503" class="Bound">f</a> <a id="8505" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8509" class="Symbol">(</a><a id="8510" href="ScopeGraph.ScopesFrames.html#8479" class="Bound">slots</a> <a id="8516" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8521" class="Bound">d</a> <a id="8523" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8527" class="Bound">v</a> <a id="8529" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8531" href="ScopeGraph.ScopesFrames.html#8487" class="Bound">links</a><a id="8536" class="Symbol">)</a>

    <a id="8543" class="Comment">-- ... and similarly for edges:</a>

    <a id="UsesGraph.UsesVal.getLink" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getLink" class="Function">getLink</a> <a id="8588" class="Symbol">:</a> <a id="8590" class="Symbol">∀</a> <a id="8592" class="Symbol">{</a><a id="8593" href="ScopeGraph.ScopesFrames.html#8593" class="Bound">s</a> <a id="8595" href="ScopeGraph.ScopesFrames.html#8595" class="Bound">s&#39;</a> <a id="8598" href="ScopeGraph.ScopesFrames.html#8598" class="Bound">Σ</a><a id="8599" class="Symbol">}</a> <a id="8601" class="Symbol">→</a> <a id="8603" href="ScopeGraph.ScopesFrames.html#8595" class="Bound">s&#39;</a> <a id="8606" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="8608" href="ScopeGraph.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="8616" href="ScopeGraph.ScopesFrames.html#8593" class="Bound">s</a> <a id="8618" class="Symbol">→</a> <a id="8620" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8626" href="ScopeGraph.ScopesFrames.html#8593" class="Bound">s</a> <a id="8628" href="ScopeGraph.ScopesFrames.html#8598" class="Bound">Σ</a> <a id="8630" class="Symbol">→</a> <a id="8632" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8637" href="ScopeGraph.ScopesFrames.html#8598" class="Bound">Σ</a> <a id="8639" class="Symbol">→</a> <a id="8641" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8647" href="ScopeGraph.ScopesFrames.html#8595" class="Bound">s&#39;</a> <a id="8650" href="ScopeGraph.ScopesFrames.html#8598" class="Bound">Σ</a>
    <a id="8656" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getLink" class="Function">getLink</a> <a id="8664" href="ScopeGraph.ScopesFrames.html#8664" class="Bound">e</a> <a id="8666" href="ScopeGraph.ScopesFrames.html#8666" class="Bound">f</a> <a id="8668" href="ScopeGraph.ScopesFrames.html#8668" class="Bound">h</a>
      <a id="8676" class="Keyword">with</a> <a id="8681" class="Symbol">(</a><a id="8682" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8695" href="ScopeGraph.ScopesFrames.html#8668" class="Bound">h</a> <a id="8697" href="ScopeGraph.ScopesFrames.html#8666" class="Bound">f</a><a id="8698" class="Symbol">)</a>
    <a id="8704" class="Symbol">...</a>  <a id="8709" class="Symbol">|</a> <a id="8711" class="Symbol">(</a><a id="8712" href="ScopeGraph.ScopesFrames.html#8712" class="Bound">slots</a> <a id="8718" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8720" href="ScopeGraph.ScopesFrames.html#8720" class="Bound">links</a><a id="8725" class="Symbol">)</a> <a id="8727" class="Symbol">=</a> <a id="8729" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8742" href="ScopeGraph.ScopesFrames.html#8720" class="Bound">links</a> <a id="8748" class="Bound">e</a>

    <a id="UsesGraph.UsesVal.setLink" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.setLink" class="Function">setLink</a> <a id="8763" class="Symbol">:</a> <a id="8765" class="Symbol">∀</a> <a id="8767" class="Symbol">{</a><a id="8768" href="ScopeGraph.ScopesFrames.html#8768" class="Bound">s</a> <a id="8770" href="ScopeGraph.ScopesFrames.html#8770" class="Bound">s&#39;</a> <a id="8773" href="ScopeGraph.ScopesFrames.html#8773" class="Bound">Σ</a><a id="8774" class="Symbol">}</a> <a id="8776" class="Symbol">→</a> <a id="8778" href="ScopeGraph.ScopesFrames.html#8770" class="Bound">s&#39;</a> <a id="8781" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="8783" href="ScopeGraph.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="8791" href="ScopeGraph.ScopesFrames.html#8768" class="Bound">s</a> <a id="8793" class="Symbol">→</a> <a id="8795" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8801" href="ScopeGraph.ScopesFrames.html#8770" class="Bound">s&#39;</a> <a id="8804" href="ScopeGraph.ScopesFrames.html#8773" class="Bound">Σ</a> <a id="8806" class="Symbol">→</a> <a id="8808" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8814" href="ScopeGraph.ScopesFrames.html#8768" class="Bound">s</a> <a id="8816" href="ScopeGraph.ScopesFrames.html#8773" class="Bound">Σ</a> <a id="8818" class="Symbol">→</a> <a id="8820" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8825" href="ScopeGraph.ScopesFrames.html#8773" class="Bound">Σ</a> <a id="8827" class="Symbol">→</a> <a id="8829" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8834" href="ScopeGraph.ScopesFrames.html#8773" class="Bound">Σ</a>
    <a id="8840" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.setLink" class="Function">setLink</a> <a id="8848" href="ScopeGraph.ScopesFrames.html#8848" class="Bound">e</a> <a id="8850" href="ScopeGraph.ScopesFrames.html#8850" class="Bound">f&#39;</a> <a id="8853" href="ScopeGraph.ScopesFrames.html#8853" class="Bound">f</a> <a id="8855" href="ScopeGraph.ScopesFrames.html#8855" class="Bound">h</a>
      <a id="8863" class="Keyword">with</a> <a id="8868" class="Symbol">(</a><a id="8869" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8882" href="ScopeGraph.ScopesFrames.html#8855" class="Bound">h</a> <a id="8884" href="ScopeGraph.ScopesFrames.html#8853" class="Bound">f</a><a id="8885" class="Symbol">)</a>
    <a id="8891" class="Symbol">...</a>  <a id="8896" class="Symbol">|</a> <a id="8898" class="Symbol">(</a><a id="8899" href="ScopeGraph.ScopesFrames.html#8899" class="Bound">slots</a> <a id="8905" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8907" href="ScopeGraph.ScopesFrames.html#8907" class="Bound">links</a><a id="8912" class="Symbol">)</a> <a id="8914" class="Symbol">=</a> <a id="8916" class="Bound">h</a> <a id="8918" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8923" class="Bound">f</a> <a id="8925" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8929" class="Symbol">(</a><a id="8930" href="ScopeGraph.ScopesFrames.html#8899" class="Bound">slots</a> <a id="8936" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8938" href="ScopeGraph.ScopesFrames.html#8907" class="Bound">links</a> <a id="8944" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8949" class="Bound">e</a> <a id="8951" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8955" class="Bound">f&#39;</a><a id="8957" class="Symbol">)</a>

    <a id="8964" class="Comment">-- Given a witness that there is a path through the scope graph</a>
    <a id="9032" class="Comment">-- from scope `s` to scope `s&#39;`, a frame typed by `s`, and a</a>
    <a id="9097" class="Comment">-- well-typed heap, we can traverse the path by following the</a>
    <a id="9163" class="Comment">-- corresponding frame links in the heap to arrive at a frame</a>
    <a id="9229" class="Comment">-- scoped by `s&#39;`:</a>

    <a id="UsesGraph.UsesVal.getFrame" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9262" class="Symbol">:</a> <a id="9264" class="Symbol">∀</a> <a id="9266" class="Symbol">{</a><a id="9267" href="ScopeGraph.ScopesFrames.html#9267" class="Bound">s</a> <a id="9269" href="ScopeGraph.ScopesFrames.html#9269" class="Bound">s&#39;</a> <a id="9272" href="ScopeGraph.ScopesFrames.html#9272" class="Bound">Σ</a><a id="9273" class="Symbol">}</a> <a id="9275" class="Symbol">→</a> <a id="9277" class="Symbol">(</a><a id="9278" href="ScopeGraph.ScopesFrames.html#9267" class="Bound">s</a> <a id="9280" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="9282" href="ScopeGraph.ScopesFrames.html#9269" class="Bound">s&#39;</a><a id="9284" class="Symbol">)</a> <a id="9286" class="Symbol">→</a> <a id="9288" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="9294" href="ScopeGraph.ScopesFrames.html#9267" class="Bound">s</a> <a id="9296" href="ScopeGraph.ScopesFrames.html#9272" class="Bound">Σ</a> <a id="9298" class="Symbol">→</a> <a id="9300" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="9305" href="ScopeGraph.ScopesFrames.html#9272" class="Bound">Σ</a> <a id="9307" class="Symbol">→</a> <a id="9309" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="9315" href="ScopeGraph.ScopesFrames.html#9269" class="Bound">s&#39;</a> <a id="9318" href="ScopeGraph.ScopesFrames.html#9272" class="Bound">Σ</a>
    <a id="9324" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9333" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%9F%B6_.%5B%5D" class="InductiveConstructor">[]</a>      <a id="9341" href="ScopeGraph.ScopesFrames.html#9341" class="Bound">f</a> <a id="9343" href="ScopeGraph.ScopesFrames.html#9343" class="Bound">h</a> <a id="9345" class="Symbol">=</a> <a id="9347" href="ScopeGraph.ScopesFrames.html#9341" class="Bound">f</a>
    <a id="9353" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9362" class="Symbol">(</a><a id="9363" href="ScopeGraph.ScopesFrames.html#9363" class="Bound">e</a> <a id="9365" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%9F%B6_._%E2%88%B7_" class="InductiveConstructor Operator">∷</a> <a id="9367" href="ScopeGraph.ScopesFrames.html#9367" class="Bound">p</a><a id="9368" class="Symbol">)</a> <a id="9370" href="ScopeGraph.ScopesFrames.html#9370" class="Bound">f</a> <a id="9372" href="ScopeGraph.ScopesFrames.html#9372" class="Bound">h</a>
      <a id="9380" class="Keyword">with</a> <a id="9385" class="Symbol">(</a><a id="9386" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="9399" href="ScopeGraph.ScopesFrames.html#9372" class="Bound">h</a> <a id="9401" href="ScopeGraph.ScopesFrames.html#9370" class="Bound">f</a><a id="9402" class="Symbol">)</a>
    <a id="9408" class="Symbol">...</a>  <a id="9413" class="Symbol">|</a> <a id="9415" class="Symbol">(</a><a id="9416" href="ScopeGraph.ScopesFrames.html#9416" class="Bound">slots</a> <a id="9422" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="9424" href="ScopeGraph.ScopesFrames.html#9424" class="Bound">links</a><a id="9429" class="Symbol">)</a> <a id="9431" class="Symbol">=</a> <a id="9433" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9442" class="Bound">p</a> <a id="9444" class="Symbol">(</a><a id="9445" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="9458" href="ScopeGraph.ScopesFrames.html#9424" class="Bound">links</a> <a id="9464" class="Bound">e</a><a id="9465" class="Symbol">)</a> <a id="9467" class="Bound">h</a>

    <a id="9474" class="Comment">-- Given the definitions above, we can define some shorthand</a>
    <a id="9539" class="Comment">-- functions for getting and setting values:</a>

    <a id="UsesGraph.UsesVal.getVal" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getVal" class="Function">getVal</a>  <a id="9597" class="Symbol">:</a>  <a id="9600" class="Symbol">∀</a> <a id="9602" class="Symbol">{</a><a id="9603" href="ScopeGraph.ScopesFrames.html#9603" class="Bound">s</a> <a id="9605" href="ScopeGraph.ScopesFrames.html#9605" class="Bound">t</a><a id="9606" class="Symbol">}</a> <a id="9608" class="Symbol">→</a> <a id="9610" class="Symbol">(</a><a id="9611" href="ScopeGraph.ScopesFrames.html#9603" class="Bound">s</a> <a id="9613" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">↦</a> <a id="9615" href="ScopeGraph.ScopesFrames.html#9605" class="Bound">t</a><a id="9616" class="Symbol">)</a> <a id="9618" class="Symbol">→</a> <a id="9620" class="Symbol">∀</a> <a id="9622" class="Symbol">{</a><a id="9623" href="ScopeGraph.ScopesFrames.html#9623" class="Bound">Σ</a><a id="9624" class="Symbol">}</a> <a id="9626" class="Symbol">→</a> <a id="9628" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="9634" href="ScopeGraph.ScopesFrames.html#9603" class="Bound">s</a> <a id="9636" href="ScopeGraph.ScopesFrames.html#9623" class="Bound">Σ</a> <a id="9638" class="Symbol">→</a> <a id="9640" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="9645" href="ScopeGraph.ScopesFrames.html#9623" class="Bound">Σ</a> <a id="9647" class="Symbol">→</a> <a id="9649" href="ScopeGraph.ScopesFrames.html#3059" class="Bound">Val</a> <a id="9653" href="ScopeGraph.ScopesFrames.html#9605" class="Bound">t</a> <a id="9655" href="ScopeGraph.ScopesFrames.html#9623" class="Bound">Σ</a>
    <a id="9661" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getVal" class="Function">getVal</a> <a id="9668" class="Symbol">(</a><a id="9669" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%86%A6_.path" class="InductiveConstructor">path</a> <a id="9674" href="ScopeGraph.ScopesFrames.html#9674" class="Bound">p</a> <a id="9676" href="ScopeGraph.ScopesFrames.html#9676" class="Bound">d</a><a id="9677" class="Symbol">)</a> <a id="9679" href="ScopeGraph.ScopesFrames.html#9679" class="Bound">f</a> <a id="9681" href="ScopeGraph.ScopesFrames.html#9681" class="Bound">h</a> <a id="9683" class="Symbol">=</a> <a id="9685" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getSlot" class="Function">getSlot</a> <a id="9693" href="ScopeGraph.ScopesFrames.html#9676" class="Bound">d</a> <a id="9695" class="Symbol">(</a><a id="9696" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9705" href="ScopeGraph.ScopesFrames.html#9674" class="Bound">p</a> <a id="9707" href="ScopeGraph.ScopesFrames.html#9679" class="Bound">f</a> <a id="9709" href="ScopeGraph.ScopesFrames.html#9681" class="Bound">h</a><a id="9710" class="Symbol">)</a> <a id="9712" href="ScopeGraph.ScopesFrames.html#9681" class="Bound">h</a>

    <a id="UsesGraph.UsesVal.setVal" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.setVal" class="Function">setVal</a>  <a id="9727" class="Symbol">:</a>  <a id="9730" class="Symbol">∀</a> <a id="9732" class="Symbol">{</a><a id="9733" href="ScopeGraph.ScopesFrames.html#9733" class="Bound">s</a> <a id="9735" href="ScopeGraph.ScopesFrames.html#9735" class="Bound">t</a> <a id="9737" href="ScopeGraph.ScopesFrames.html#9737" class="Bound">Σ</a><a id="9738" class="Symbol">}</a> <a id="9740" class="Symbol">→</a> <a id="9742" class="Symbol">(</a><a id="9743" href="ScopeGraph.ScopesFrames.html#9733" class="Bound">s</a> <a id="9745" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">↦</a> <a id="9747" href="ScopeGraph.ScopesFrames.html#9735" class="Bound">t</a><a id="9748" class="Symbol">)</a> <a id="9750" class="Symbol">→</a> <a id="9752" href="ScopeGraph.ScopesFrames.html#3059" class="Bound">Val</a> <a id="9756" href="ScopeGraph.ScopesFrames.html#9735" class="Bound">t</a> <a id="9758" href="ScopeGraph.ScopesFrames.html#9737" class="Bound">Σ</a> <a id="9760" class="Symbol">→</a> <a id="9762" href="ScopeGraph.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="9768" href="ScopeGraph.ScopesFrames.html#9733" class="Bound">s</a> <a id="9770" href="ScopeGraph.ScopesFrames.html#9737" class="Bound">Σ</a> <a id="9772" class="Symbol">→</a> <a id="9774" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="9779" href="ScopeGraph.ScopesFrames.html#9737" class="Bound">Σ</a> <a id="9781" class="Symbol">→</a> <a id="9783" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="9788" href="ScopeGraph.ScopesFrames.html#9737" class="Bound">Σ</a>
    <a id="9794" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.setVal" class="Function">setVal</a> <a id="9801" class="Symbol">(</a><a id="9802" href="ScopeGraph.ScopesFrames.html#UsesGraph._%E2%86%A6_.path" class="InductiveConstructor">path</a> <a id="9807" href="ScopeGraph.ScopesFrames.html#9807" class="Bound">p</a> <a id="9809" href="ScopeGraph.ScopesFrames.html#9809" class="Bound">d</a><a id="9810" class="Symbol">)</a> <a id="9812" href="ScopeGraph.ScopesFrames.html#9812" class="Bound">v</a> <a id="9814" href="ScopeGraph.ScopesFrames.html#9814" class="Bound">f</a> <a id="9816" href="ScopeGraph.ScopesFrames.html#9816" class="Bound">h</a> <a id="9818" class="Symbol">=</a> <a id="9820" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.setSlot" class="Function">setSlot</a> <a id="9828" href="ScopeGraph.ScopesFrames.html#9809" class="Bound">d</a> <a id="9830" href="ScopeGraph.ScopesFrames.html#9812" class="Bound">v</a> <a id="9832" class="Symbol">(</a><a id="9833" href="ScopeGraph.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9842" href="ScopeGraph.ScopesFrames.html#9807" class="Bound">p</a> <a id="9844" href="ScopeGraph.ScopesFrames.html#9814" class="Bound">f</a> <a id="9846" href="ScopeGraph.ScopesFrames.html#9816" class="Bound">h</a><a id="9847" class="Symbol">)</a> <a id="9849" href="ScopeGraph.ScopesFrames.html#9816" class="Bound">h</a>
</pre></body></html>