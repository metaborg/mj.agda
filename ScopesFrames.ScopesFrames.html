<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ScopesFrames.ScopesFrames</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="22" class="Keyword">open</a> <a id="27" class="Keyword">import</a> <a id="34" href="Data.Fin.html" class="Module">Data.Fin</a>
<a id="43" class="Keyword">open</a> <a id="48" class="Keyword">import</a> <a id="55" href="Data.List.Most.html" class="Module">Data.List.Most</a>
<a id="70" class="Keyword">open</a> <a id="75" class="Keyword">import</a> <a id="82" href="Data.List.All.html" class="Module">Data.List.All</a> <a id="96" class="Keyword">renaming</a> <a id="105" class="Symbol">(</a><a id="106" href="Data.List.All.html#lookup" class="Function">lookup</a> <a id="113" class="Symbol">to</a> <a id="116" href="Data.List.All.html#lookup" class="Function">lookup∀</a><a id="123" class="Symbol">)</a>
<a id="125" class="Keyword">open</a> <a id="130" class="Keyword">import</a> <a id="137" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="146" class="Keyword">hiding</a> <a id="153" class="Symbol">(</a><a id="154" href="Data.Vec.html#_%E2%88%88_" class="Datatype Operator">_∈_</a> <a id="158" class="Symbol">;</a> <a id="160" href="Data.Vec.html#_%E2%88%B7%CA%B3_" class="Function Operator">_∷ʳ_</a> <a id="165" class="Symbol">;</a> <a id="167" href="Data.Vec.html#_%3E%3E%3D_" class="Function Operator">_&gt;&gt;=_</a> <a id="173" class="Symbol">;</a> <a id="175" href="Data.Vec.html#init" class="Function">init</a><a id="179" class="Symbol">)</a>
<a id="181" class="Keyword">open</a> <a id="186" class="Keyword">import</a> <a id="193" href="Data.Product.html" class="Module">Data.Product</a>
<a id="206" class="Keyword">open</a> <a id="211" class="Keyword">import</a> <a id="218" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="256" class="Keyword">hiding</a> <a id="263" class="Symbol">(</a><a id="264" href="Relation.Binary.PropositionalEquality.html#Reveal_%C2%B7_is_.%5B_%5D" class="InductiveConstructor Operator">[_]</a><a id="267" class="Symbol">)</a>
<a id="269" class="Keyword">open</a> <a id="274" href="Relation.Binary.PropositionalEquality.html#%E2%89%A1-Reasoning" class="Module">≡-Reasoning</a>
<a id="286" class="Keyword">open</a> <a id="291" class="Keyword">import</a> <a id="298" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="308" class="Keyword">open</a> <a id="313" class="Keyword">import</a> <a id="320" href="Data.List.Prefix.html" class="Module">Data.List.Prefix</a>
<a id="337" class="Keyword">open</a> <a id="342" class="Keyword">import</a> <a id="349" href="Data.List.Properties.Extra.html" class="Module">Data.List.Properties.Extra</a>
<a id="376" class="Keyword">open</a> <a id="381" class="Keyword">import</a> <a id="388" href="Data.List.All.Properties.Extra.html" class="Module">Data.List.All.Properties.Extra</a>
<a id="419" class="Keyword">open</a> <a id="424" class="Keyword">import</a> <a id="431" href="Data.List.All.html" class="Module">Data.List.All</a> <a id="445" class="Symbol">as</a> <a id="448" class="Module">List∀</a> <a id="454" class="Keyword">hiding</a> <a id="461" class="Symbol">(</a><a id="462" href="Data.List.All.html#lookup" class="Function">lookup</a><a id="468" class="Symbol">)</a>
<a id="470" class="Keyword">open</a> <a id="475" class="Keyword">import</a> <a id="482" href="Coinduction.html" class="Module">Coinduction</a>
<a id="494" class="Keyword">open</a> <a id="499" class="Keyword">import</a> <a id="506" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="517" class="Keyword">hiding</a> <a id="524" class="Symbol">(</a><a id="525" href="Data.Maybe.Base.html#All" class="Datatype">All</a><a id="528" class="Symbol">)</a>
<a id="530" class="Keyword">open</a> <a id="535" class="Keyword">import</a> <a id="542" href="Common.Weakening.html" class="Module">Common.Weakening</a>

<a id="560" class="Comment">-- This file contains the Agda Scope Graph Library described in</a>
<a id="624" class="Comment">-- Section 4 of the paper.</a>

<a id="652" class="Comment">-- The definitions are parameterized by a scope graph, where a scope</a>
<a id="721" class="Comment">-- graph is a finite map from scope identifiers to scope shape</a>
<a id="784" class="Comment">-- descriptors.</a>
<a id="800" class="Comment">--</a>
<a id="803" class="Comment">-- The scope graph library is also parametric in what the notion of</a>
<a id="871" class="Comment">-- type is for declarations in the scope graph.</a>
<a id="919" class="Comment">--</a>
<a id="922" class="Comment">-- We use modules for this library parameterization.  The `k`</a>
<a id="984" class="Comment">-- parameter of the `ScopesFrames` module represents the number of</a>
<a id="1051" class="Comment">-- scope identifiers in the scope graph that all definitions are</a>
<a id="1116" class="Comment">-- parameterized over; and the `Ty` parameter is a language-specific</a>
<a id="1185" class="Comment">-- notion of type.</a>

<a id="1205" class="Keyword">module</a> <a id="1212" href="ScopesFrames.ScopesFrames.html" class="Module">ScopesFrames.ScopesFrames</a> <a id="1238" class="Symbol">(</a><a id="1239" href="ScopesFrames.ScopesFrames.html#1239" class="Bound">k</a> <a id="1241" class="Symbol">:</a> <a id="1243" href="Agda.Builtin.Nat.html#%E2%84%95" class="Datatype">ℕ</a><a id="1244" class="Symbol">)</a> <a id="1246" class="Symbol">(</a><a id="1247" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a> <a id="1250" class="Symbol">:</a> <a id="1252" class="PrimitiveType">Set</a><a id="1255" class="Symbol">)</a> <a id="1257" class="Keyword">where</a>


<a id="1265" class="Comment">------------------</a>
<a id="1284" class="Comment">-- SCOPE GRAPHS --</a>
<a id="1303" class="Comment">------------------</a>

<a id="1323" class="Comment">-- Type aliases for scope identifiers (`Scope`s) and scope graphs</a>
<a id="1389" class="Comment">-- (`Graph`s).</a>
<a id="1404" class="Comment">--</a>
<a id="1407" class="Comment">-- As described in the paper, scope shapes are given by a list of</a>
<a id="1473" class="Comment">-- types corresponding to the declarations of the scope, and a list of</a>
<a id="1544" class="Comment">-- scopes, corresponding to the edges of the scope.</a>

<a id="Scope" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1603" class="Symbol">=</a> <a id="1605" href="Data.Fin.html#Fin" class="Datatype">Fin</a> <a id="1609" href="ScopesFrames.ScopesFrames.html#1239" class="Bound">k</a>
<a id="Graph" href="ScopesFrames.ScopesFrames.html#Graph" class="Function">Graph</a> <a id="1617" class="Symbol">=</a> <a id="1619" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1625" class="Symbol">→</a> <a id="1627" class="Symbol">(</a><a id="1628" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1633" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a> <a id="1636" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="1638" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1643" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a><a id="1648" class="Symbol">)</a>

<a id="1651" class="Comment">-- All the following definitions are parameterized by a scope graph</a>
<a id="1719" class="Comment">-- `g`.</a>

<a id="1728" class="Keyword">module</a> <a id="UsesGraph" href="ScopesFrames.ScopesFrames.html#UsesGraph" class="Module">UsesGraph</a> <a id="1745" class="Symbol">(</a><a id="1746" href="ScopesFrames.ScopesFrames.html#1746" class="Bound">g</a> <a id="1748" class="Symbol">:</a> <a id="1750" href="ScopesFrames.ScopesFrames.html#Graph" class="Function">Graph</a><a id="1755" class="Symbol">)</a> <a id="1757" class="Keyword">where</a>

  <a id="1766" class="Comment">-- Some projection functions:</a>
  <a id="UsesGraph.declsOf" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="1806" class="Symbol">:</a> <a id="1808" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1814" class="Symbol">→</a> <a id="1816" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1821" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a>     <a id="1828" class="Symbol">;</a>  <a id="1831" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="1839" href="ScopesFrames.ScopesFrames.html#1839" class="Bound">s</a>  <a id="1842" class="Symbol">=</a> <a id="1844" href="Data.Product.html#%CE%A3.proj%E2%82%81" class="Field">proj₁</a> <a id="1850" class="Symbol">(</a><a id="1851" href="ScopesFrames.ScopesFrames.html#1746" class="Bound">g</a> <a id="1853" href="ScopesFrames.ScopesFrames.html#1839" class="Bound">s</a><a id="1854" class="Symbol">)</a>
  <a id="UsesGraph.edgesOf" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="1866" class="Symbol">:</a> <a id="1868" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1874" class="Symbol">→</a> <a id="1876" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1881" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a>  <a id="1888" class="Symbol">;</a>  <a id="1891" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="1899" href="ScopesFrames.ScopesFrames.html#1899" class="Bound">s</a>  <a id="1902" class="Symbol">=</a> <a id="1904" href="Data.Product.html#%CE%A3.proj%E2%82%82" class="Field">proj₂</a> <a id="1910" class="Symbol">(</a><a id="1911" href="ScopesFrames.ScopesFrames.html#1746" class="Bound">g</a> <a id="1913" href="ScopesFrames.ScopesFrames.html#1899" class="Bound">s</a><a id="1914" class="Symbol">)</a>

  <a id="1919" class="Comment">-- A resolution path is a witness that we can traverse a sequence of</a>
  <a id="1990" class="Comment">-- scope edges (`_⟶_`) in `g` to arrive at a declaration of type</a>
  <a id="2057" class="Comment">-- `t`:</a>

  <a id="2068" class="Keyword">data</a> <a id="UsesGraph._⟶_" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">_⟶_</a> <a id="2077" class="Symbol">:</a> <a id="2079" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="2085" class="Symbol">→</a> <a id="2087" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="2093" class="Symbol">→</a> <a id="2095" class="PrimitiveType">Set</a> <a id="2099" class="Keyword">where</a>
    <a id="UsesGraph._⟶_.[]" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_.%5B%5D" class="InductiveConstructor">[]</a>   <a id="2114" class="Symbol">:</a>  <a id="2117" class="Symbol">∀</a> <a id="2119" class="Symbol">{</a><a id="2120" href="ScopesFrames.ScopesFrames.html#2120" class="Bound">s</a><a id="2121" class="Symbol">}</a> <a id="2123" class="Symbol">→</a> <a id="2125" href="ScopesFrames.ScopesFrames.html#2120" class="Bound">s</a> <a id="2127" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2129" href="ScopesFrames.ScopesFrames.html#2120" class="Bound">s</a>
    <a id="UsesGraph._⟶_._∷_" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_._%E2%88%B7_" class="InductiveConstructor Operator">_∷_</a>  <a id="2140" class="Symbol">:</a>  <a id="2143" class="Symbol">∀</a> <a id="2145" class="Symbol">{</a><a id="2146" href="ScopesFrames.ScopesFrames.html#2146" class="Bound">s</a> <a id="2148" href="ScopesFrames.ScopesFrames.html#2148" class="Bound">s&#39;</a> <a id="2151" href="ScopesFrames.ScopesFrames.html#2151" class="Bound">s&#39;&#39;</a><a id="2154" class="Symbol">}</a> <a id="2156" class="Symbol">→</a> <a id="2158" href="ScopesFrames.ScopesFrames.html#2148" class="Bound">s&#39;</a> <a id="2161" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="2163" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="2171" href="ScopesFrames.ScopesFrames.html#2146" class="Bound">s</a> <a id="2173" class="Symbol">→</a> <a id="2175" href="ScopesFrames.ScopesFrames.html#2148" class="Bound">s&#39;</a> <a id="2178" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2180" href="ScopesFrames.ScopesFrames.html#2151" class="Bound">s&#39;&#39;</a> <a id="2184" class="Symbol">→</a> <a id="2186" href="ScopesFrames.ScopesFrames.html#2146" class="Bound">s</a> <a id="2188" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2190" href="ScopesFrames.ScopesFrames.html#2151" class="Bound">s&#39;&#39;</a>

  <a id="2197" class="Comment">-- path concatenation</a>
  <a id="UsesGraph.concatₚ" href="ScopesFrames.ScopesFrames.html#UsesGraph.concat%E2%82%9A" class="Function">concatₚ</a> <a id="2229" class="Symbol">:</a> <a id="2231" class="Symbol">∀</a> <a id="2233" class="Symbol">{</a><a id="2234" href="ScopesFrames.ScopesFrames.html#2234" class="Bound">s</a> <a id="2236" href="ScopesFrames.ScopesFrames.html#2236" class="Bound">s&#39;</a> <a id="2239" href="ScopesFrames.ScopesFrames.html#2239" class="Bound">s&#39;&#39;</a><a id="2242" class="Symbol">}</a> <a id="2244" class="Symbol">→</a> <a id="2246" href="ScopesFrames.ScopesFrames.html#2234" class="Bound">s</a> <a id="2248" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2250" href="ScopesFrames.ScopesFrames.html#2236" class="Bound">s&#39;</a> <a id="2253" class="Symbol">→</a> <a id="2255" href="ScopesFrames.ScopesFrames.html#2236" class="Bound">s&#39;</a> <a id="2258" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2260" href="ScopesFrames.ScopesFrames.html#2239" class="Bound">s&#39;&#39;</a> <a id="2264" class="Symbol">→</a> <a id="2266" href="ScopesFrames.ScopesFrames.html#2234" class="Bound">s</a> <a id="2268" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2270" href="ScopesFrames.ScopesFrames.html#2239" class="Bound">s&#39;&#39;</a>
  <a id="2276" href="ScopesFrames.ScopesFrames.html#UsesGraph.concat%E2%82%9A" class="Function">concatₚ</a> <a id="2284" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_.%5B%5D" class="InductiveConstructor">[]</a> <a id="2287" href="ScopesFrames.ScopesFrames.html#2287" class="Bound">p₂</a> <a id="2290" class="Symbol">=</a> <a id="2292" href="ScopesFrames.ScopesFrames.html#2287" class="Bound">p₂</a>
  <a id="2297" href="ScopesFrames.ScopesFrames.html#UsesGraph.concat%E2%82%9A" class="Function">concatₚ</a> <a id="2305" class="Symbol">(</a><a id="2306" href="ScopesFrames.ScopesFrames.html#2306" class="Bound">x</a> <a id="2308" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_._%E2%88%B7_" class="InductiveConstructor Operator">∷</a> <a id="2310" href="ScopesFrames.ScopesFrames.html#2310" class="Bound">p₁</a><a id="2312" class="Symbol">)</a> <a id="2314" href="ScopesFrames.ScopesFrames.html#2314" class="Bound">p₂</a> <a id="2317" class="Symbol">=</a> <a id="2319" href="ScopesFrames.ScopesFrames.html#2306" class="Bound">x</a> <a id="2321" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_._%E2%88%B7_" class="InductiveConstructor Operator">∷</a> <a id="2323" class="Symbol">(</a><a id="2324" href="ScopesFrames.ScopesFrames.html#UsesGraph.concat%E2%82%9A" class="Function">concatₚ</a> <a id="2332" href="ScopesFrames.ScopesFrames.html#2310" class="Bound">p₁</a> <a id="2335" href="ScopesFrames.ScopesFrames.html#2314" class="Bound">p₂</a><a id="2337" class="Symbol">)</a>

  <a id="2342" class="Keyword">data</a> <a id="UsesGraph._↦_" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">_↦_</a> <a id="2351" class="Symbol">(</a><a id="2352" href="ScopesFrames.ScopesFrames.html#2352" class="Bound">s</a> <a id="2354" class="Symbol">:</a> <a id="2356" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a><a id="2361" class="Symbol">)</a> <a id="2363" class="Symbol">(</a><a id="2364" href="ScopesFrames.ScopesFrames.html#2364" class="Bound">t</a> <a id="2366" class="Symbol">:</a> <a id="2368" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a><a id="2370" class="Symbol">)</a> <a id="2372" class="Symbol">:</a> <a id="2374" class="PrimitiveType">Set</a> <a id="2378" class="Keyword">where</a>
    <a id="UsesGraph._↦_.path" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_.path" class="InductiveConstructor">path</a> <a id="2393" class="Symbol">:</a> <a id="2395" class="Symbol">∀{</a><a id="2397" href="ScopesFrames.ScopesFrames.html#2397" class="Bound">s&#39;</a><a id="2399" class="Symbol">}</a> <a id="2401" class="Symbol">→</a> <a id="2403" href="ScopesFrames.ScopesFrames.html#2352" class="Bound">s</a> <a id="2405" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2407" href="ScopesFrames.ScopesFrames.html#2397" class="Bound">s&#39;</a> <a id="2410" class="Symbol">→</a> <a id="2412" href="ScopesFrames.ScopesFrames.html#2364" class="Bound">t</a> <a id="2414" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="2416" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="2424" href="ScopesFrames.ScopesFrames.html#2397" class="Bound">s&#39;</a> <a id="2427" class="Symbol">→</a> <a id="2429" href="ScopesFrames.ScopesFrames.html#2352" class="Bound">s</a> <a id="2431" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">↦</a> <a id="2433" href="ScopesFrames.ScopesFrames.html#2364" class="Bound">t</a>

  <a id="UsesGraph.prepend" href="ScopesFrames.ScopesFrames.html#UsesGraph.prepend" class="Function">prepend</a> <a id="2446" class="Symbol">:</a> <a id="2448" class="Symbol">∀</a> <a id="2450" class="Symbol">{</a><a id="2451" href="ScopesFrames.ScopesFrames.html#2451" class="Bound">s</a> <a id="2453" href="ScopesFrames.ScopesFrames.html#2453" class="Bound">s&#39;</a> <a id="2456" href="ScopesFrames.ScopesFrames.html#2456" class="Bound">t</a><a id="2457" class="Symbol">}</a> <a id="2459" class="Symbol">→</a> <a id="2461" href="ScopesFrames.ScopesFrames.html#2451" class="Bound">s</a> <a id="2463" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2465" href="ScopesFrames.ScopesFrames.html#2453" class="Bound">s&#39;</a> <a id="2468" class="Symbol">→</a> <a id="2470" href="ScopesFrames.ScopesFrames.html#2453" class="Bound">s&#39;</a> <a id="2473" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">↦</a> <a id="2475" href="ScopesFrames.ScopesFrames.html#2456" class="Bound">t</a> <a id="2477" class="Symbol">→</a> <a id="2479" href="ScopesFrames.ScopesFrames.html#2451" class="Bound">s</a> <a id="2481" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">↦</a> <a id="2483" href="ScopesFrames.ScopesFrames.html#2456" class="Bound">t</a>
  <a id="2487" href="ScopesFrames.ScopesFrames.html#UsesGraph.prepend" class="Function">prepend</a> <a id="2495" href="ScopesFrames.ScopesFrames.html#2495" class="Bound">p</a> <a id="2497" class="Symbol">(</a><a id="2498" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_.path" class="InductiveConstructor">path</a> <a id="2503" href="ScopesFrames.ScopesFrames.html#2503" class="Bound">p&#39;</a> <a id="2506" href="ScopesFrames.ScopesFrames.html#2506" class="Bound">d</a><a id="2507" class="Symbol">)</a> <a id="2509" class="Symbol">=</a> <a id="2511" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_.path" class="InductiveConstructor">path</a> <a id="2516" class="Symbol">(</a><a id="2517" href="ScopesFrames.ScopesFrames.html#UsesGraph.concat%E2%82%9A" class="Function">concatₚ</a> <a id="2525" href="ScopesFrames.ScopesFrames.html#2495" class="Bound">p</a> <a id="2527" href="ScopesFrames.ScopesFrames.html#2503" class="Bound">p&#39;</a><a id="2529" class="Symbol">)</a> <a id="2531" href="ScopesFrames.ScopesFrames.html#2506" class="Bound">d</a>

  <a id="2536" class="Comment">-- The definitions above fully define scope graphs.  The remaining</a>
  <a id="2605" class="Comment">-- definitions in this file are intrinsically-typed by this notion</a>
  <a id="2674" class="Comment">-- of scope graph.</a>


  <a id="2697" class="Comment">----------------------</a>
  <a id="2722" class="Comment">-- FRAMES AND HEAPS --</a>
  <a id="2747" class="Comment">----------------------</a>

  <a id="2773" class="Comment">-- Heap types summarize what the scope is for each frame location in</a>
  <a id="2844" class="Comment">-- the heap:</a>

  <a id="UsesGraph.HeapTy" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a> <a id="2867" class="Symbol">=</a> <a id="2869" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="2874" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a>

  <a id="2883" class="Comment">-- A frame pointer `Frame s Σ` is a witness that there is a frame</a>
  <a id="2951" class="Comment">-- location scoped by `s` in a heap typed by `Σ`:</a>

  <a id="UsesGraph.Frame" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="3010" class="Symbol">:</a> <a id="3012" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="3018" class="Symbol">→</a> <a id="3020" class="Symbol">(</a><a id="3021" href="ScopesFrames.ScopesFrames.html#3021" class="Bound">Σ</a> <a id="3023" class="Symbol">:</a> <a id="3025" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="3031" class="Symbol">)</a> <a id="3033" class="Symbol">→</a> <a id="3035" class="PrimitiveType">Set</a>
  <a id="3041" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="3047" href="ScopesFrames.ScopesFrames.html#3047" class="Bound">s</a> <a id="3049" href="ScopesFrames.ScopesFrames.html#3049" class="Bound">Σ</a> <a id="3051" class="Symbol">=</a> <a id="3053" href="ScopesFrames.ScopesFrames.html#3047" class="Bound">s</a> <a id="3055" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="3057" href="ScopesFrames.ScopesFrames.html#3049" class="Bound">Σ</a>

  <a id="3062" class="Comment">-- Concrete frames and heaps store values that are weakened when the</a>
  <a id="3133" class="Comment">-- heap is extended.  The following definitions are parameterized by</a>
  <a id="3204" class="Comment">-- a language-specific notion of weakenable value.</a>

  <a id="3258" class="Keyword">module</a> <a id="UsesVal" href="ScopesFrames.ScopesFrames.html#UsesVal" class="Module">UsesVal</a> <a id="3273" class="Symbol">(</a><a id="3274" href="ScopesFrames.ScopesFrames.html#3274" class="Bound">Val</a> <a id="3278" class="Symbol">:</a> <a id="3280" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a> <a id="3283" class="Symbol">→</a> <a id="3285" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a> <a id="3292" class="Symbol">→</a> <a id="3294" class="PrimitiveType">Set</a><a id="3297" class="Symbol">)</a>
                 <a id="3316" class="Symbol">(</a><a id="3317" href="ScopesFrames.ScopesFrames.html#3317" class="Bound">weaken-val</a> <a id="3328" class="Symbol">:</a> <a id="3330" class="Symbol">∀</a> <a id="3332" class="Symbol">{</a><a id="3333" href="ScopesFrames.ScopesFrames.html#3333" class="Bound">t</a> <a id="3335" href="ScopesFrames.ScopesFrames.html#3335" class="Bound">Σ</a> <a id="3337" href="ScopesFrames.ScopesFrames.html#3337" class="Bound">Σ&#39;</a><a id="3339" class="Symbol">}</a> <a id="3341" class="Symbol">→</a> <a id="3343" href="ScopesFrames.ScopesFrames.html#3335" class="Bound">Σ</a> <a id="3345" href="Data.List.Prefix.html#_%E2%8A%91_" class="Datatype Operator">⊑</a> <a id="3347" href="ScopesFrames.ScopesFrames.html#3337" class="Bound">Σ&#39;</a> <a id="3350" class="Symbol">→</a> <a id="3352" href="ScopesFrames.ScopesFrames.html#3274" class="Bound">Val</a> <a id="3356" href="ScopesFrames.ScopesFrames.html#3333" class="Bound">t</a> <a id="3358" href="ScopesFrames.ScopesFrames.html#3335" class="Bound">Σ</a> <a id="3360" class="Symbol">→</a> <a id="3362" href="ScopesFrames.ScopesFrames.html#3274" class="Bound">Val</a> <a id="3366" href="ScopesFrames.ScopesFrames.html#3333" class="Bound">t</a> <a id="3368" href="ScopesFrames.ScopesFrames.html#3337" class="Bound">Σ&#39;</a><a id="3370" class="Symbol">)</a> <a id="3372" class="Keyword">where</a>

    <a id="3383" class="Comment">-- Slots are given by a list of values that are in one-to-one</a>
    <a id="3449" class="Comment">-- correspondence with a list of declarations (types):</a>

    <a id="UsesGraph.UsesVal.Slots" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="3515" class="Symbol">:</a> <a id="3517" class="Symbol">(</a><a id="3518" href="ScopesFrames.ScopesFrames.html#3518" class="Bound">ds</a> <a id="3521" class="Symbol">:</a> <a id="3523" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="3528" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a><a id="3530" class="Symbol">)</a> <a id="3532" class="Symbol">→</a> <a id="3534" class="Symbol">(</a><a id="3535" href="ScopesFrames.ScopesFrames.html#3535" class="Bound">Σ</a> <a id="3537" class="Symbol">:</a> <a id="3539" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="3545" class="Symbol">)</a> <a id="3547" class="Symbol">→</a> <a id="3549" class="PrimitiveType">Set</a>
    <a id="3557" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="3563" href="ScopesFrames.ScopesFrames.html#3563" class="Bound">ds</a> <a id="3566" href="ScopesFrames.ScopesFrames.html#3566" class="Bound">Σ</a> <a id="3568" class="Symbol">=</a> <a id="3570" href="Data.List.All.html#All" class="Datatype">All</a> <a id="3574" class="Symbol">(λ</a> <a id="3577" href="ScopesFrames.ScopesFrames.html#3577" class="Bound">t</a> <a id="3579" class="Symbol">→</a> <a id="3581" href="ScopesFrames.ScopesFrames.html#3274" class="Bound">Val</a> <a id="3585" href="ScopesFrames.ScopesFrames.html#3577" class="Bound">t</a> <a id="3587" href="ScopesFrames.ScopesFrames.html#3566" class="Bound">Σ</a><a id="3588" class="Symbol">)</a> <a id="3590" href="ScopesFrames.ScopesFrames.html#3563" class="Bound">ds</a>

    <a id="3598" class="Comment">-- Links are given by a list of frame pointers (links) that are in</a>
    <a id="3669" class="Comment">-- one-to-one correspondence with a list of edges (scopes):</a>

    <a id="UsesGraph.UsesVal.Links" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="3740" class="Symbol">:</a> <a id="3742" class="Symbol">(</a><a id="3743" href="ScopesFrames.ScopesFrames.html#3743" class="Bound">es</a> <a id="3746" class="Symbol">:</a> <a id="3748" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="3753" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a><a id="3758" class="Symbol">)</a> <a id="3760" class="Symbol">→</a> <a id="3762" class="Symbol">(</a><a id="3763" href="ScopesFrames.ScopesFrames.html#3763" class="Bound">Σ</a> <a id="3765" class="Symbol">:</a> <a id="3767" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="3773" class="Symbol">)</a> <a id="3775" class="Symbol">→</a> <a id="3777" class="PrimitiveType">Set</a>
    <a id="3785" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="3791" href="ScopesFrames.ScopesFrames.html#3791" class="Bound">es</a> <a id="3794" href="ScopesFrames.ScopesFrames.html#3794" class="Bound">Σ</a> <a id="3796" class="Symbol">=</a> <a id="3798" href="Data.List.All.html#All" class="Datatype">All</a> <a id="3802" class="Symbol">(λ</a> <a id="3805" href="ScopesFrames.ScopesFrames.html#3805" class="Bound">s</a> <a id="3807" class="Symbol">→</a> <a id="3809" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="3815" href="ScopesFrames.ScopesFrames.html#3805" class="Bound">s</a> <a id="3817" href="ScopesFrames.ScopesFrames.html#3794" class="Bound">Σ</a><a id="3818" class="Symbol">)</a> <a id="3820" href="ScopesFrames.ScopesFrames.html#3791" class="Bound">es</a>

    <a id="3828" class="Comment">-- A heap frame for a scope `s` is given by a set of slots and</a>
    <a id="3895" class="Comment">-- links that are in one-to-one correspondence with the</a>
    <a id="3955" class="Comment">-- declarations and edges of the scope:</a>

    <a id="UsesGraph.UsesVal.HeapFrame" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="4010" class="Symbol">:</a> <a id="4012" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="4018" class="Symbol">→</a> <a id="4020" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a> <a id="4027" class="Symbol">→</a> <a id="4029" class="PrimitiveType">Set</a>
    <a id="4037" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="4047" href="ScopesFrames.ScopesFrames.html#4047" class="Bound">s</a> <a id="4049" href="ScopesFrames.ScopesFrames.html#4049" class="Bound">Σ</a> <a id="4051" class="Symbol">=</a> <a id="4053" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="4059" class="Symbol">(</a><a id="4060" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="4068" href="ScopesFrames.ScopesFrames.html#4047" class="Bound">s</a><a id="4069" class="Symbol">)</a> <a id="4071" href="ScopesFrames.ScopesFrames.html#4049" class="Bound">Σ</a> <a id="4073" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="4075" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="4081" class="Symbol">(</a><a id="4082" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="4090" href="ScopesFrames.ScopesFrames.html#4047" class="Bound">s</a><a id="4091" class="Symbol">)</a> <a id="4093" href="ScopesFrames.ScopesFrames.html#4049" class="Bound">Σ</a>

    <a id="4100" class="Comment">-- A heap typed by `Σ` is given by a list of heap frames such that</a>
    <a id="4171" class="Comment">-- each frame location is in the heap is typed by the</a>
    <a id="4229" class="Comment">-- corresponding location in `Σ`.</a>

    <a id="UsesGraph.UsesVal.Heap" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="4273" class="Symbol">:</a> <a id="4275" class="Symbol">(</a><a id="4276" href="ScopesFrames.ScopesFrames.html#4276" class="Bound">Σ</a> <a id="4278" class="Symbol">:</a> <a id="4280" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="4286" class="Symbol">)</a> <a id="4288" class="Symbol">→</a> <a id="4290" class="PrimitiveType">Set</a>
    <a id="4298" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="4303" href="ScopesFrames.ScopesFrames.html#4303" class="Bound">Σ</a> <a id="4305" class="Symbol">=</a> <a id="4307" href="Data.List.All.html#All" class="Datatype">All</a> <a id="4311" class="Symbol">(λ</a> <a id="4314" href="ScopesFrames.ScopesFrames.html#4314" class="Bound">s</a> <a id="4316" class="Symbol">→</a> <a id="4318" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="4328" href="ScopesFrames.ScopesFrames.html#4314" class="Bound">s</a> <a id="4330" href="ScopesFrames.ScopesFrames.html#4303" class="Bound">Σ</a><a id="4331" class="Symbol">)</a> <a id="4333" href="ScopesFrames.ScopesFrames.html#4303" class="Bound">Σ</a>


    <a id="4341" class="Comment">----------------------</a>
    <a id="4368" class="Comment">-- FRAME OPERATIONS --</a>
    <a id="4395" class="Comment">----------------------</a>

    <a id="4423" class="Comment">-- Frame initialization extends the heap, requiring heap type</a>
    <a id="4489" class="Comment">-- weakening.  The `Common.Weakening` module defines a generic</a>
    <a id="4556" class="Comment">-- `Weakenable` record, which we instantiate for each entity that</a>
    <a id="4626" class="Comment">-- is required to be weakenable.  We use Agda&#39;s instance arguments</a>
    <a id="4697" class="Comment">-- to automatically resolve the right notion of weakening where</a>
    <a id="4765" class="Comment">-- possible.</a>

    <a id="4783" class="Comment">-- We add some instances of the Weakenable typeclass</a>
    <a id="4840" class="Comment">-- to the instance argument scope:</a>

    <a id="4880" class="Keyword">instance</a>
      <a id="UsesGraph.UsesVal.weaken-val&#39;" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-val%27" class="Function">weaken-val&#39;</a> <a id="4907" class="Symbol">:</a> <a id="4909" class="Symbol">∀</a> <a id="4911" class="Symbol">{</a><a id="4912" href="ScopesFrames.ScopesFrames.html#4912" class="Bound">t</a><a id="4913" class="Symbol">}</a> <a id="4915" class="Symbol">→</a> <a id="4917" href="Common.Weakening.html#Weakenable" class="Record">Weakenable</a> <a id="4928" class="Symbol">(λ</a> <a id="4931" href="ScopesFrames.ScopesFrames.html#4931" class="Bound">Σ</a> <a id="4933" class="Symbol">→</a> <a id="4935" href="ScopesFrames.ScopesFrames.html#3274" class="Bound">Val</a> <a id="4939" href="ScopesFrames.ScopesFrames.html#4912" class="Bound">t</a> <a id="4941" href="ScopesFrames.ScopesFrames.html#4931" class="Bound">Σ</a><a id="4942" class="Symbol">)</a>
      <a id="4950" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-val%27" class="Function">weaken-val&#39;</a> <a id="4962" class="Symbol">=</a> <a id="4964" class="Keyword">record</a> <a id="4971" class="Symbol">{</a> <a id="4973" class="Field">wk</a> <a id="4976" class="Symbol">=</a> <a id="4978" href="ScopesFrames.ScopesFrames.html#3317" class="Bound">weaken-val</a> <a id="4989" class="Symbol">}</a>

      <a id="UsesGraph.UsesVal.weaken-heapframe" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-heapframe" class="Function">weaken-heapframe</a> <a id="5015" class="Symbol">:</a> <a id="5017" class="Symbol">∀</a> <a id="5019" class="Symbol">{</a><a id="5020" href="ScopesFrames.ScopesFrames.html#5020" class="Bound">s</a><a id="5021" class="Symbol">}</a> <a id="5023" class="Symbol">→</a> <a id="5025" href="Common.Weakening.html#Weakenable" class="Record">Weakenable</a> <a id="5036" class="Symbol">(</a><a id="5037" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="5047" href="ScopesFrames.ScopesFrames.html#5020" class="Bound">s</a><a id="5048" class="Symbol">)</a>
      <a id="5056" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-heapframe" class="Function">weaken-heapframe</a> <a id="5073" class="Symbol">=</a> <a id="5075" class="Keyword">record</a> <a id="5082" class="Symbol">{</a> <a id="5084" class="Field">wk</a> <a id="5087" class="Symbol">=</a> <a id="5089" class="Symbol">λ{</a> <a id="5092" href="ScopesFrames.ScopesFrames.html#5092" class="Bound">ext</a> <a id="5096" class="Symbol">(</a><a id="5097" href="ScopesFrames.ScopesFrames.html#5097" class="Bound">slots</a> <a id="5103" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="5105" href="ScopesFrames.ScopesFrames.html#5105" class="Bound">links</a><a id="5110" class="Symbol">)</a> <a id="5112" class="Symbol">→</a> <a id="5114" class="Symbol">(</a><a id="5115" href="Common.Weakening.html#746" class="Field">wk</a> <a id="5118" href="ScopesFrames.ScopesFrames.html#5092" class="Bound">ext</a> <a id="5122" href="ScopesFrames.ScopesFrames.html#5097" class="Bound">slots</a> <a id="5128" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="5130" href="Common.Weakening.html#746" class="Field">wk</a> <a id="5133" href="ScopesFrames.ScopesFrames.html#5092" class="Bound">ext</a> <a id="5137" href="ScopesFrames.ScopesFrames.html#5105" class="Bound">links</a><a id="5142" class="Symbol">)</a> <a id="5144" class="Symbol">}</a> <a id="5146" class="Symbol">}</a>

      <a id="UsesGraph.UsesVal.weaken-frame" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-frame" class="Function">weaken-frame</a> <a id="5168" class="Symbol">:</a> <a id="5170" class="Symbol">∀</a> <a id="5172" class="Symbol">{</a><a id="5173" href="ScopesFrames.ScopesFrames.html#5173" class="Bound">s</a><a id="5174" class="Symbol">}</a> <a id="5176" class="Symbol">→</a> <a id="5178" href="Common.Weakening.html#Weakenable" class="Record">Weakenable</a> <a id="5189" class="Symbol">(</a><a id="5190" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="5196" href="ScopesFrames.ScopesFrames.html#5173" class="Bound">s</a><a id="5197" class="Symbol">)</a>
      <a id="5205" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-frame" class="Function">weaken-frame</a> <a id="5218" class="Symbol">=</a> <a id="5220" class="Keyword">record</a> <a id="5227" class="Symbol">{</a> <a id="5229" class="Field">wk</a> <a id="5232" class="Symbol">=</a> <a id="5234" href="Common.Weakening.html#Weakenable.wk" class="Field">Weakenable.wk</a> <a id="5248" href="Common.Weakening.html#any-weakenable" class="Function">any-weakenable</a> <a id="5263" class="Symbol">}</a>

    <a id="5270" class="Comment">-- Frame initialization takes as argument:</a>
    <a id="5317" class="Comment">--</a>
    <a id="5324" class="Comment">-- * a scope `s`;</a>
    <a id="5346" class="Comment">--</a>
    <a id="5353" class="Comment">-- * a scope shape witness which asserts that looking up `s` in</a>
    <a id="5421" class="Comment">--   the current scope graph `g` yields a scope shape where the</a>
    <a id="5489" class="Comment">--   declarations are given by a list of types `ds`, and scope</a>
    <a id="5556" class="Comment">--   edges are given by a list of scopes `es`;</a>
    <a id="5607" class="Comment">--</a>
    <a id="5614" class="Comment">-- * a set of slots typed by `ds`;</a>
    <a id="5653" class="Comment">--</a>
    <a id="5660" class="Comment">-- * a set of links typed by `es`; and</a>
    <a id="5703" class="Comment">--</a>
    <a id="5710" class="Comment">-- * a heap typed by the heap type `Σ` which also types the slots</a>
    <a id="5780" class="Comment">--   and links.</a>
    <a id="5800" class="Comment">--</a>
    <a id="5807" class="Comment">-- The operation returns an extended heap (`∷ʳ` appends a single</a>
    <a id="5876" class="Comment">-- element to a list, and is defined in `Data.List.Base` in the</a>
    <a id="5944" class="Comment">-- Agda Standard Library) and a frame pointer into the extended</a>
    <a id="6012" class="Comment">-- heap, i.e., the newly allocated and initialized frame.</a>

    <a id="UsesGraph.UsesVal.initFrame" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.initFrame" class="Function">initFrame</a>   <a id="6087" class="Symbol">:</a>  <a id="6090" class="Symbol">(</a><a id="6091" href="ScopesFrames.ScopesFrames.html#6091" class="Bound">s</a> <a id="6093" class="Symbol">:</a> <a id="6095" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a><a id="6100" class="Symbol">)</a> <a id="6102" class="Symbol">→</a> <a id="6104" class="Symbol">∀</a> <a id="6106" class="Symbol">{</a><a id="6107" href="ScopesFrames.ScopesFrames.html#6107" class="Bound">Σ</a> <a id="6109" href="ScopesFrames.ScopesFrames.html#6109" class="Bound">ds</a> <a id="6112" href="ScopesFrames.ScopesFrames.html#6112" class="Bound">es</a><a id="6114" class="Symbol">}⦃</a> <a id="6117" href="ScopesFrames.ScopesFrames.html#6117" class="Bound">shape</a> <a id="6123" class="Symbol">:</a> <a id="6125" href="ScopesFrames.ScopesFrames.html#1746" class="Bound">g</a> <a id="6127" href="ScopesFrames.ScopesFrames.html#6091" class="Bound">s</a> <a id="6129" href="Agda.Builtin.Equality.html#_%E2%89%A1_" class="Datatype Operator">≡</a> <a id="6131" class="Symbol">(</a><a id="6132" href="ScopesFrames.ScopesFrames.html#6109" class="Bound">ds</a> <a id="6135" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="6137" href="ScopesFrames.ScopesFrames.html#6112" class="Bound">es</a><a id="6139" class="Symbol">)</a> <a id="6141" class="Symbol">⦄</a> <a id="6143" class="Symbol">→</a>
                   <a id="6164" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="6170" href="ScopesFrames.ScopesFrames.html#6109" class="Bound">ds</a> <a id="6173" href="ScopesFrames.ScopesFrames.html#6107" class="Bound">Σ</a> <a id="6175" class="Symbol">→</a> <a id="6177" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="6183" href="ScopesFrames.ScopesFrames.html#6112" class="Bound">es</a> <a id="6186" href="ScopesFrames.ScopesFrames.html#6107" class="Bound">Σ</a> <a id="6188" class="Symbol">→</a> <a id="6190" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="6195" href="ScopesFrames.ScopesFrames.html#6107" class="Bound">Σ</a> <a id="6197" class="Symbol">→</a> <a id="6199" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="6205" href="ScopesFrames.ScopesFrames.html#6091" class="Bound">s</a> <a id="6207" class="Symbol">(</a><a id="6208" href="ScopesFrames.ScopesFrames.html#6107" class="Bound">Σ</a> <a id="6210" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="6213" href="ScopesFrames.ScopesFrames.html#6091" class="Bound">s</a><a id="6214" class="Symbol">)</a> <a id="6216" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="6218" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="6223" class="Symbol">(</a><a id="6224" href="ScopesFrames.ScopesFrames.html#6107" class="Bound">Σ</a> <a id="6226" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="6229" href="ScopesFrames.ScopesFrames.html#6091" class="Bound">s</a><a id="6230" class="Symbol">)</a>
    <a id="6236" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.initFrame" class="Function">initFrame</a> <a id="6246" href="ScopesFrames.ScopesFrames.html#6246" class="Bound">s</a> <a id="6248" class="Symbol">{</a><a id="6249" href="ScopesFrames.ScopesFrames.html#6249" class="Bound">Σ</a><a id="6250" class="Symbol">}</a> <a id="6252" class="Symbol">⦃</a> <a id="6254" href="Agda.Builtin.Equality.html#_%E2%89%A1_.refl" class="InductiveConstructor">refl</a> <a id="6259" class="Symbol">⦄</a> <a id="6261" href="ScopesFrames.ScopesFrames.html#6261" class="Bound">slots</a> <a id="6267" href="ScopesFrames.ScopesFrames.html#6267" class="Bound">links</a> <a id="6273" href="ScopesFrames.ScopesFrames.html#6273" class="Bound">h</a> <a id="6275" class="Symbol">=</a>
      <a id="6283" class="Keyword">let</a> <a id="6287" href="ScopesFrames.ScopesFrames.html#6287" class="Bound">ext</a> <a id="6291" class="Symbol">=</a> <a id="6293" href="Data.List.Prefix.html#%E2%88%B7%CA%B3-%E2%8A%92" class="Function">∷ʳ-⊒</a> <a id="6298" href="ScopesFrames.ScopesFrames.html#6246" class="Bound">s</a> <a id="6300" href="ScopesFrames.ScopesFrames.html#6249" class="Bound">Σ</a> <a id="6302" class="Comment">-- heap extension fact</a>
          <a id="6335" href="ScopesFrames.ScopesFrames.html#6335" class="Bound">f&#39;</a>  <a id="6339" class="Symbol">=</a> <a id="6341" href="Data.List.Properties.Extra.html#%E2%88%88-%E2%88%B7%CA%B3" class="Function">∈-∷ʳ</a> <a id="6346" href="ScopesFrames.ScopesFrames.html#6249" class="Bound">Σ</a> <a id="6348" href="ScopesFrames.ScopesFrames.html#6246" class="Bound">s</a> <a id="6350" class="Comment">-- updated frame pointer witness</a>
          <a id="6393" href="ScopesFrames.ScopesFrames.html#6393" class="Bound">h&#39;</a>  <a id="6397" class="Symbol">=</a> <a id="6399" class="Symbol">(</a><a id="6400" href="Common.Weakening.html#746" class="Field">wk</a> <a id="6403" href="ScopesFrames.ScopesFrames.html#6287" class="Bound">ext</a> <a id="6407" href="ScopesFrames.ScopesFrames.html#6273" class="Bound">h</a><a id="6408" class="Symbol">)</a> <a id="6410" href="Data.List.All.Properties.Extra.html#_all-%E2%88%B7%CA%B3_" class="Function Operator">all-∷ʳ</a> <a id="6417" class="Symbol">(</a><a id="6418" href="Common.Weakening.html#746" class="Field">wk</a> <a id="6421" href="ScopesFrames.ScopesFrames.html#6287" class="Bound">ext</a> <a id="6425" href="ScopesFrames.ScopesFrames.html#6261" class="Bound">slots</a> <a id="6431" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="6433" href="Common.Weakening.html#746" class="Field">wk</a> <a id="6436" href="ScopesFrames.ScopesFrames.html#6287" class="Bound">ext</a> <a id="6440" href="ScopesFrames.ScopesFrames.html#6267" class="Bound">links</a><a id="6445" class="Symbol">)</a> <a id="6447" class="Comment">-- extended heap</a>
      <a id="6470" class="Keyword">in</a> <a id="6473" class="Symbol">(</a><a id="6474" href="ScopesFrames.ScopesFrames.html#6335" class="Bound">f&#39;</a> <a id="6477" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="6479" href="ScopesFrames.ScopesFrames.html#6393" class="Bound">h&#39;</a><a id="6481" class="Symbol">)</a>

    <a id="6488" class="Comment">-- Frames may be self-referential.  For example, the values stored</a>
    <a id="6559" class="Comment">-- in the slots of a frame may contain pointers to the frame</a>
    <a id="6624" class="Comment">-- itself.  The `initFrame` function above does not support</a>
    <a id="6688" class="Comment">-- initializing such self-referential slots, since the slots are</a>
    <a id="6757" class="Comment">-- assumed to be typed under the unextended heap.</a>
    <a id="6811" class="Comment">--</a>
    <a id="6818" class="Comment">-- The `initFrameι` function we now define takes as argument a</a>
    <a id="6885" class="Comment">-- function to be used to initialize possibly-self-referential</a>
    <a id="6952" class="Comment">-- frame slots.  The function takes as argument a frame pointer</a>
    <a id="7020" class="Comment">-- into a heap extended by the scope that we are currently</a>
    <a id="7083" class="Comment">-- initializing, and slots are typed under this extended heap;</a>
    <a id="7150" class="Comment">-- hence the slots can have self-references to the frame currently</a>
    <a id="7221" class="Comment">-- being initialized.</a>

    <a id="UsesGraph.UsesVal.initFrameι" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.initFrame%CE%B9" class="Function">initFrameι</a> <a id="7259" class="Symbol">:</a> <a id="7261" class="Symbol">(</a><a id="7262" href="ScopesFrames.ScopesFrames.html#7262" class="Bound">s</a> <a id="7264" class="Symbol">:</a> <a id="7266" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a><a id="7271" class="Symbol">)</a> <a id="7273" class="Symbol">→</a> <a id="7275" class="Symbol">∀</a> <a id="7277" class="Symbol">{</a><a id="7278" href="ScopesFrames.ScopesFrames.html#7278" class="Bound">Σ</a> <a id="7280" href="ScopesFrames.ScopesFrames.html#7280" class="Bound">ds</a> <a id="7283" href="ScopesFrames.ScopesFrames.html#7283" class="Bound">es</a><a id="7285" class="Symbol">}⦃</a> <a id="7288" href="ScopesFrames.ScopesFrames.html#7288" class="Bound">shape</a> <a id="7294" class="Symbol">:</a> <a id="7296" href="ScopesFrames.ScopesFrames.html#1746" class="Bound">g</a> <a id="7298" href="ScopesFrames.ScopesFrames.html#7262" class="Bound">s</a> <a id="7300" href="Agda.Builtin.Equality.html#_%E2%89%A1_" class="Datatype Operator">≡</a> <a id="7302" class="Symbol">(</a><a id="7303" href="ScopesFrames.ScopesFrames.html#7280" class="Bound">ds</a> <a id="7306" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="7308" href="ScopesFrames.ScopesFrames.html#7283" class="Bound">es</a><a id="7310" class="Symbol">)</a> <a id="7312" class="Symbol">⦄</a> <a id="7314" class="Symbol">→</a>
                 <a id="7333" class="Symbol">(</a><a id="7334" href="ScopesFrames.ScopesFrames.html#7334" class="Bound">slotsf</a> <a id="7341" class="Symbol">:</a> <a id="7343" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="7349" href="ScopesFrames.ScopesFrames.html#7262" class="Bound">s</a> <a id="7351" class="Symbol">(</a><a id="7352" href="ScopesFrames.ScopesFrames.html#7278" class="Bound">Σ</a> <a id="7354" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7357" href="ScopesFrames.ScopesFrames.html#7262" class="Bound">s</a><a id="7358" class="Symbol">)</a> <a id="7360" class="Symbol">→</a> <a id="7362" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="7368" href="ScopesFrames.ScopesFrames.html#7280" class="Bound">ds</a> <a id="7371" class="Symbol">(</a><a id="7372" href="ScopesFrames.ScopesFrames.html#7278" class="Bound">Σ</a> <a id="7374" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7377" href="ScopesFrames.ScopesFrames.html#7262" class="Bound">s</a><a id="7378" class="Symbol">))</a> <a id="7381" class="Symbol">→</a> <a id="7383" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="7389" href="ScopesFrames.ScopesFrames.html#7283" class="Bound">es</a> <a id="7392" href="ScopesFrames.ScopesFrames.html#7278" class="Bound">Σ</a> <a id="7394" class="Symbol">→</a> <a id="7396" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="7401" href="ScopesFrames.ScopesFrames.html#7278" class="Bound">Σ</a> <a id="7403" class="Symbol">→</a>
                 <a id="7422" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="7428" href="ScopesFrames.ScopesFrames.html#7262" class="Bound">s</a> <a id="7430" class="Symbol">(</a><a id="7431" href="ScopesFrames.ScopesFrames.html#7278" class="Bound">Σ</a> <a id="7433" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7436" href="ScopesFrames.ScopesFrames.html#7262" class="Bound">s</a><a id="7437" class="Symbol">)</a> <a id="7439" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="7441" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="7446" class="Symbol">(</a><a id="7447" href="ScopesFrames.ScopesFrames.html#7278" class="Bound">Σ</a> <a id="7449" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7452" href="ScopesFrames.ScopesFrames.html#7262" class="Bound">s</a><a id="7453" class="Symbol">)</a>
    <a id="7459" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.initFrame%CE%B9" class="Function">initFrameι</a> <a id="7470" href="ScopesFrames.ScopesFrames.html#7470" class="Bound">s</a> <a id="7472" class="Symbol">{</a><a id="7473" href="ScopesFrames.ScopesFrames.html#7473" class="Bound">Σ</a><a id="7474" class="Symbol">}</a> <a id="7476" class="Symbol">⦃</a> <a id="7478" href="Agda.Builtin.Equality.html#_%E2%89%A1_.refl" class="InductiveConstructor">refl</a> <a id="7483" class="Symbol">⦄</a> <a id="7485" href="ScopesFrames.ScopesFrames.html#7485" class="Bound">slotsf</a> <a id="7492" href="ScopesFrames.ScopesFrames.html#7492" class="Bound">links</a> <a id="7498" href="ScopesFrames.ScopesFrames.html#7498" class="Bound">h</a> <a id="7500" class="Symbol">=</a>
      <a id="7508" class="Keyword">let</a> <a id="7512" href="ScopesFrames.ScopesFrames.html#7512" class="Bound">ext</a> <a id="7516" class="Symbol">=</a> <a id="7518" href="Data.List.Prefix.html#%E2%88%B7%CA%B3-%E2%8A%92" class="Function">∷ʳ-⊒</a> <a id="7523" href="ScopesFrames.ScopesFrames.html#7470" class="Bound">s</a> <a id="7525" href="ScopesFrames.ScopesFrames.html#7473" class="Bound">Σ</a> <a id="7527" class="Comment">-- heap extension fact</a>
          <a id="7560" href="ScopesFrames.ScopesFrames.html#7560" class="Bound">f&#39;</a>  <a id="7564" class="Symbol">=</a> <a id="7566" href="Data.List.Properties.Extra.html#%E2%88%88-%E2%88%B7%CA%B3" class="Function">∈-∷ʳ</a> <a id="7571" href="ScopesFrames.ScopesFrames.html#7473" class="Bound">Σ</a> <a id="7573" href="ScopesFrames.ScopesFrames.html#7470" class="Bound">s</a> <a id="7575" class="Comment">-- updated frame pointer witness</a>
          <a id="7618" href="ScopesFrames.ScopesFrames.html#7618" class="Bound">h&#39;</a>  <a id="7622" class="Symbol">=</a> <a id="7624" class="Symbol">(</a><a id="7625" href="Common.Weakening.html#746" class="Field">wk</a> <a id="7628" href="ScopesFrames.ScopesFrames.html#7512" class="Bound">ext</a> <a id="7632" href="ScopesFrames.ScopesFrames.html#7498" class="Bound">h</a><a id="7633" class="Symbol">)</a> <a id="7635" href="Data.List.All.Properties.Extra.html#_all-%E2%88%B7%CA%B3_" class="Function Operator">all-∷ʳ</a> <a id="7642" class="Symbol">(</a><a id="7643" href="ScopesFrames.ScopesFrames.html#7485" class="Bound">slotsf</a> <a id="7650" href="ScopesFrames.ScopesFrames.html#7560" class="Bound">f&#39;</a> <a id="7653" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="7655" href="Common.Weakening.html#746" class="Field">wk</a> <a id="7658" href="ScopesFrames.ScopesFrames.html#7512" class="Bound">ext</a> <a id="7662" href="ScopesFrames.ScopesFrames.html#7492" class="Bound">links</a><a id="7667" class="Symbol">)</a> <a id="7669" class="Comment">-- extended heap</a>
      <a id="7692" class="Keyword">in</a> <a id="7695" class="Symbol">(</a><a id="7696" href="ScopesFrames.ScopesFrames.html#7560" class="Bound">f&#39;</a> <a id="7699" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="7701" href="ScopesFrames.ScopesFrames.html#7618" class="Bound">h&#39;</a><a id="7703" class="Symbol">)</a>


    <a id="7711" class="Comment">-- Given a witness that a declaration typed by `t` is in a scope,</a>
    <a id="7781" class="Comment">-- and a frame pointer, we can fetch the well-typed value stored</a>
    <a id="7850" class="Comment">-- in the corresponding frame slot:</a>

    <a id="UsesGraph.UsesVal.getSlot" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getSlot" class="Function">getSlot</a> <a id="7899" class="Symbol">:</a> <a id="7901" class="Symbol">∀</a> <a id="7903" class="Symbol">{</a><a id="7904" href="ScopesFrames.ScopesFrames.html#7904" class="Bound">s</a> <a id="7906" href="ScopesFrames.ScopesFrames.html#7906" class="Bound">t</a> <a id="7908" href="ScopesFrames.ScopesFrames.html#7908" class="Bound">Σ</a><a id="7909" class="Symbol">}</a> <a id="7911" class="Symbol">→</a> <a id="7913" href="ScopesFrames.ScopesFrames.html#7906" class="Bound">t</a> <a id="7915" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="7917" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="7925" href="ScopesFrames.ScopesFrames.html#7904" class="Bound">s</a> <a id="7927" class="Symbol">→</a> <a id="7929" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="7935" href="ScopesFrames.ScopesFrames.html#7904" class="Bound">s</a> <a id="7937" href="ScopesFrames.ScopesFrames.html#7908" class="Bound">Σ</a> <a id="7939" class="Symbol">→</a> <a id="7941" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="7946" href="ScopesFrames.ScopesFrames.html#7908" class="Bound">Σ</a> <a id="7948" class="Symbol">→</a> <a id="7950" href="ScopesFrames.ScopesFrames.html#3274" class="Bound">Val</a> <a id="7954" href="ScopesFrames.ScopesFrames.html#7906" class="Bound">t</a> <a id="7956" href="ScopesFrames.ScopesFrames.html#7908" class="Bound">Σ</a>
    <a id="7962" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getSlot" class="Function">getSlot</a> <a id="7970" href="ScopesFrames.ScopesFrames.html#7970" class="Bound">d</a> <a id="7972" href="ScopesFrames.ScopesFrames.html#7972" class="Bound">f</a> <a id="7974" href="ScopesFrames.ScopesFrames.html#7974" class="Bound">h</a>
      <a id="7982" class="Keyword">with</a> <a id="7987" class="Symbol">(</a><a id="7988" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8001" href="ScopesFrames.ScopesFrames.html#7974" class="Bound">h</a> <a id="8003" href="ScopesFrames.ScopesFrames.html#7972" class="Bound">f</a><a id="8004" class="Symbol">)</a>
    <a id="8010" class="Symbol">...</a>  <a id="8015" class="Symbol">|</a> <a id="8017" class="Symbol">(</a><a id="8018" href="ScopesFrames.ScopesFrames.html#8018" class="Bound">slots</a> <a id="8024" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8026" href="ScopesFrames.ScopesFrames.html#8026" class="Bound">links</a><a id="8031" class="Symbol">)</a> <a id="8033" class="Symbol">=</a> <a id="8035" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8048" href="ScopesFrames.ScopesFrames.html#8018" class="Bound">slots</a> <a id="8054" class="Bound">d</a>

    <a id="8061" class="Comment">-- Given a witness that a declaration typed by `t` is in a scope,</a>
    <a id="8131" class="Comment">-- and a frame pointer, we can mutate the corresponding slot in a</a>
    <a id="8201" class="Comment">-- type preserving manner:</a>

    <a id="UsesGraph.UsesVal.setSlot" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setSlot" class="Function">setSlot</a> <a id="8241" class="Symbol">:</a> <a id="8243" class="Symbol">∀</a> <a id="8245" class="Symbol">{</a><a id="8246" href="ScopesFrames.ScopesFrames.html#8246" class="Bound">s</a> <a id="8248" href="ScopesFrames.ScopesFrames.html#8248" class="Bound">t</a> <a id="8250" href="ScopesFrames.ScopesFrames.html#8250" class="Bound">Σ</a><a id="8251" class="Symbol">}</a> <a id="8253" class="Symbol">→</a> <a id="8255" href="ScopesFrames.ScopesFrames.html#8248" class="Bound">t</a> <a id="8257" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="8259" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="8267" href="ScopesFrames.ScopesFrames.html#8246" class="Bound">s</a> <a id="8269" class="Symbol">→</a> <a id="8271" href="ScopesFrames.ScopesFrames.html#3274" class="Bound">Val</a> <a id="8275" href="ScopesFrames.ScopesFrames.html#8248" class="Bound">t</a> <a id="8277" href="ScopesFrames.ScopesFrames.html#8250" class="Bound">Σ</a> <a id="8279" class="Symbol">→</a> <a id="8281" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8287" href="ScopesFrames.ScopesFrames.html#8246" class="Bound">s</a> <a id="8289" href="ScopesFrames.ScopesFrames.html#8250" class="Bound">Σ</a> <a id="8291" class="Symbol">→</a> <a id="8293" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8298" href="ScopesFrames.ScopesFrames.html#8250" class="Bound">Σ</a> <a id="8300" class="Symbol">→</a> <a id="8302" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8307" href="ScopesFrames.ScopesFrames.html#8250" class="Bound">Σ</a>
    <a id="8313" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setSlot" class="Function">setSlot</a> <a id="8321" href="ScopesFrames.ScopesFrames.html#8321" class="Bound">d</a> <a id="8323" href="ScopesFrames.ScopesFrames.html#8323" class="Bound">v</a> <a id="8325" href="ScopesFrames.ScopesFrames.html#8325" class="Bound">f</a> <a id="8327" href="ScopesFrames.ScopesFrames.html#8327" class="Bound">h</a>
      <a id="8335" class="Keyword">with</a> <a id="8340" class="Symbol">(</a><a id="8341" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8354" href="ScopesFrames.ScopesFrames.html#8327" class="Bound">h</a> <a id="8356" href="ScopesFrames.ScopesFrames.html#8325" class="Bound">f</a><a id="8357" class="Symbol">)</a>
    <a id="8363" class="Symbol">...</a>  <a id="8368" class="Symbol">|</a> <a id="8370" class="Symbol">(</a><a id="8371" href="ScopesFrames.ScopesFrames.html#8371" class="Bound">slots</a> <a id="8377" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8379" href="ScopesFrames.ScopesFrames.html#8379" class="Bound">links</a><a id="8384" class="Symbol">)</a> <a id="8386" class="Symbol">=</a> <a id="8388" class="Bound">h</a> <a id="8390" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8395" class="Bound">f</a> <a id="8397" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8401" class="Symbol">(</a><a id="8402" href="ScopesFrames.ScopesFrames.html#8371" class="Bound">slots</a> <a id="8408" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8413" class="Bound">d</a> <a id="8415" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8419" class="Bound">v</a> <a id="8421" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8423" href="ScopesFrames.ScopesFrames.html#8379" class="Bound">links</a><a id="8428" class="Symbol">)</a>

    <a id="8435" class="Comment">-- ... and similarly for edges:</a>

    <a id="UsesGraph.UsesVal.getLink" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getLink" class="Function">getLink</a> <a id="8480" class="Symbol">:</a> <a id="8482" class="Symbol">∀</a> <a id="8484" class="Symbol">{</a><a id="8485" href="ScopesFrames.ScopesFrames.html#8485" class="Bound">s</a> <a id="8487" href="ScopesFrames.ScopesFrames.html#8487" class="Bound">s&#39;</a> <a id="8490" href="ScopesFrames.ScopesFrames.html#8490" class="Bound">Σ</a><a id="8491" class="Symbol">}</a> <a id="8493" class="Symbol">→</a> <a id="8495" href="ScopesFrames.ScopesFrames.html#8487" class="Bound">s&#39;</a> <a id="8498" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="8500" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="8508" href="ScopesFrames.ScopesFrames.html#8485" class="Bound">s</a> <a id="8510" class="Symbol">→</a> <a id="8512" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8518" href="ScopesFrames.ScopesFrames.html#8485" class="Bound">s</a> <a id="8520" href="ScopesFrames.ScopesFrames.html#8490" class="Bound">Σ</a> <a id="8522" class="Symbol">→</a> <a id="8524" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8529" href="ScopesFrames.ScopesFrames.html#8490" class="Bound">Σ</a> <a id="8531" class="Symbol">→</a> <a id="8533" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8539" href="ScopesFrames.ScopesFrames.html#8487" class="Bound">s&#39;</a> <a id="8542" href="ScopesFrames.ScopesFrames.html#8490" class="Bound">Σ</a>
    <a id="8548" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getLink" class="Function">getLink</a> <a id="8556" href="ScopesFrames.ScopesFrames.html#8556" class="Bound">e</a> <a id="8558" href="ScopesFrames.ScopesFrames.html#8558" class="Bound">f</a> <a id="8560" href="ScopesFrames.ScopesFrames.html#8560" class="Bound">h</a>
      <a id="8568" class="Keyword">with</a> <a id="8573" class="Symbol">(</a><a id="8574" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8587" href="ScopesFrames.ScopesFrames.html#8560" class="Bound">h</a> <a id="8589" href="ScopesFrames.ScopesFrames.html#8558" class="Bound">f</a><a id="8590" class="Symbol">)</a>
    <a id="8596" class="Symbol">...</a>  <a id="8601" class="Symbol">|</a> <a id="8603" class="Symbol">(</a><a id="8604" href="ScopesFrames.ScopesFrames.html#8604" class="Bound">slots</a> <a id="8610" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8612" href="ScopesFrames.ScopesFrames.html#8612" class="Bound">links</a><a id="8617" class="Symbol">)</a> <a id="8619" class="Symbol">=</a> <a id="8621" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8634" href="ScopesFrames.ScopesFrames.html#8612" class="Bound">links</a> <a id="8640" class="Bound">e</a>

    <a id="UsesGraph.UsesVal.setLink" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setLink" class="Function">setLink</a> <a id="8655" class="Symbol">:</a> <a id="8657" class="Symbol">∀</a> <a id="8659" class="Symbol">{</a><a id="8660" href="ScopesFrames.ScopesFrames.html#8660" class="Bound">s</a> <a id="8662" href="ScopesFrames.ScopesFrames.html#8662" class="Bound">s&#39;</a> <a id="8665" href="ScopesFrames.ScopesFrames.html#8665" class="Bound">Σ</a><a id="8666" class="Symbol">}</a> <a id="8668" class="Symbol">→</a> <a id="8670" href="ScopesFrames.ScopesFrames.html#8662" class="Bound">s&#39;</a> <a id="8673" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="8675" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="8683" href="ScopesFrames.ScopesFrames.html#8660" class="Bound">s</a> <a id="8685" class="Symbol">→</a> <a id="8687" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8693" href="ScopesFrames.ScopesFrames.html#8662" class="Bound">s&#39;</a> <a id="8696" href="ScopesFrames.ScopesFrames.html#8665" class="Bound">Σ</a> <a id="8698" class="Symbol">→</a> <a id="8700" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8706" href="ScopesFrames.ScopesFrames.html#8660" class="Bound">s</a> <a id="8708" href="ScopesFrames.ScopesFrames.html#8665" class="Bound">Σ</a> <a id="8710" class="Symbol">→</a> <a id="8712" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8717" href="ScopesFrames.ScopesFrames.html#8665" class="Bound">Σ</a> <a id="8719" class="Symbol">→</a> <a id="8721" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8726" href="ScopesFrames.ScopesFrames.html#8665" class="Bound">Σ</a>
    <a id="8732" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setLink" class="Function">setLink</a> <a id="8740" href="ScopesFrames.ScopesFrames.html#8740" class="Bound">e</a> <a id="8742" href="ScopesFrames.ScopesFrames.html#8742" class="Bound">f&#39;</a> <a id="8745" href="ScopesFrames.ScopesFrames.html#8745" class="Bound">f</a> <a id="8747" href="ScopesFrames.ScopesFrames.html#8747" class="Bound">h</a>
      <a id="8755" class="Keyword">with</a> <a id="8760" class="Symbol">(</a><a id="8761" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8774" href="ScopesFrames.ScopesFrames.html#8747" class="Bound">h</a> <a id="8776" href="ScopesFrames.ScopesFrames.html#8745" class="Bound">f</a><a id="8777" class="Symbol">)</a>
    <a id="8783" class="Symbol">...</a>  <a id="8788" class="Symbol">|</a> <a id="8790" class="Symbol">(</a><a id="8791" href="ScopesFrames.ScopesFrames.html#8791" class="Bound">slots</a> <a id="8797" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8799" href="ScopesFrames.ScopesFrames.html#8799" class="Bound">links</a><a id="8804" class="Symbol">)</a> <a id="8806" class="Symbol">=</a> <a id="8808" class="Bound">h</a> <a id="8810" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8815" class="Bound">f</a> <a id="8817" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8821" class="Symbol">(</a><a id="8822" href="ScopesFrames.ScopesFrames.html#8791" class="Bound">slots</a> <a id="8828" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8830" href="ScopesFrames.ScopesFrames.html#8799" class="Bound">links</a> <a id="8836" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8841" class="Bound">e</a> <a id="8843" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8847" class="Bound">f&#39;</a><a id="8849" class="Symbol">)</a>

    <a id="8856" class="Comment">-- Given a witness that there is a path through the scope graph</a>
    <a id="8924" class="Comment">-- from scope `s` to scope `s&#39;`, a frame typed by `s`, and a</a>
    <a id="8989" class="Comment">-- well-typed heap, we can traverse the path by following the</a>
    <a id="9055" class="Comment">-- corresponding frame links in the heap to arrive at a frame</a>
    <a id="9121" class="Comment">-- scoped by `s&#39;`:</a>

    <a id="UsesGraph.UsesVal.getFrame" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9154" class="Symbol">:</a> <a id="9156" class="Symbol">∀</a> <a id="9158" class="Symbol">{</a><a id="9159" href="ScopesFrames.ScopesFrames.html#9159" class="Bound">s</a> <a id="9161" href="ScopesFrames.ScopesFrames.html#9161" class="Bound">s&#39;</a> <a id="9164" href="ScopesFrames.ScopesFrames.html#9164" class="Bound">Σ</a><a id="9165" class="Symbol">}</a> <a id="9167" class="Symbol">→</a> <a id="9169" class="Symbol">(</a><a id="9170" href="ScopesFrames.ScopesFrames.html#9159" class="Bound">s</a> <a id="9172" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="9174" href="ScopesFrames.ScopesFrames.html#9161" class="Bound">s&#39;</a><a id="9176" class="Symbol">)</a> <a id="9178" class="Symbol">→</a> <a id="9180" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="9186" href="ScopesFrames.ScopesFrames.html#9159" class="Bound">s</a> <a id="9188" href="ScopesFrames.ScopesFrames.html#9164" class="Bound">Σ</a> <a id="9190" class="Symbol">→</a> <a id="9192" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="9197" href="ScopesFrames.ScopesFrames.html#9164" class="Bound">Σ</a> <a id="9199" class="Symbol">→</a> <a id="9201" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="9207" href="ScopesFrames.ScopesFrames.html#9161" class="Bound">s&#39;</a> <a id="9210" href="ScopesFrames.ScopesFrames.html#9164" class="Bound">Σ</a>
    <a id="9216" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9225" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_.%5B%5D" class="InductiveConstructor">[]</a>      <a id="9233" href="ScopesFrames.ScopesFrames.html#9233" class="Bound">f</a> <a id="9235" href="ScopesFrames.ScopesFrames.html#9235" class="Bound">h</a> <a id="9237" class="Symbol">=</a> <a id="9239" href="ScopesFrames.ScopesFrames.html#9233" class="Bound">f</a>
    <a id="9245" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9254" class="Symbol">(</a><a id="9255" href="ScopesFrames.ScopesFrames.html#9255" class="Bound">e</a> <a id="9257" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_._%E2%88%B7_" class="InductiveConstructor Operator">∷</a> <a id="9259" href="ScopesFrames.ScopesFrames.html#9259" class="Bound">p</a><a id="9260" class="Symbol">)</a> <a id="9262" href="ScopesFrames.ScopesFrames.html#9262" class="Bound">f</a> <a id="9264" href="ScopesFrames.ScopesFrames.html#9264" class="Bound">h</a>
      <a id="9272" class="Keyword">with</a> <a id="9277" class="Symbol">(</a><a id="9278" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="9291" href="ScopesFrames.ScopesFrames.html#9264" class="Bound">h</a> <a id="9293" href="ScopesFrames.ScopesFrames.html#9262" class="Bound">f</a><a id="9294" class="Symbol">)</a>
    <a id="9300" class="Symbol">...</a>  <a id="9305" class="Symbol">|</a> <a id="9307" class="Symbol">(</a><a id="9308" href="ScopesFrames.ScopesFrames.html#9308" class="Bound">slots</a> <a id="9314" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="9316" href="ScopesFrames.ScopesFrames.html#9316" class="Bound">links</a><a id="9321" class="Symbol">)</a> <a id="9323" class="Symbol">=</a> <a id="9325" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9334" class="Bound">p</a> <a id="9336" class="Symbol">(</a><a id="9337" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="9350" href="ScopesFrames.ScopesFrames.html#9316" class="Bound">links</a> <a id="9356" class="Bound">e</a><a id="9357" class="Symbol">)</a> <a id="9359" class="Bound">h</a>

    <a id="9366" class="Comment">-- Given the definitions above, we can define some shorthand</a>
    <a id="9431" class="Comment">-- functions for getting and setting values:</a>

    <a id="UsesGraph.UsesVal.getVal" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getVal" class="Function">getVal</a>  <a id="9489" class="Symbol">:</a>  <a id="9492" class="Symbol">∀</a> <a id="9494" class="Symbol">{</a><a id="9495" href="ScopesFrames.ScopesFrames.html#9495" class="Bound">s</a> <a id="9497" href="ScopesFrames.ScopesFrames.html#9497" class="Bound">t</a><a id="9498" class="Symbol">}</a> <a id="9500" class="Symbol">→</a> <a id="9502" class="Symbol">(</a><a id="9503" href="ScopesFrames.ScopesFrames.html#9495" class="Bound">s</a> <a id="9505" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">↦</a> <a id="9507" href="ScopesFrames.ScopesFrames.html#9497" class="Bound">t</a><a id="9508" class="Symbol">)</a> <a id="9510" class="Symbol">→</a> <a id="9512" class="Symbol">∀</a> <a id="9514" class="Symbol">{</a><a id="9515" href="ScopesFrames.ScopesFrames.html#9515" class="Bound">Σ</a><a id="9516" class="Symbol">}</a> <a id="9518" class="Symbol">→</a> <a id="9520" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="9526" href="ScopesFrames.ScopesFrames.html#9495" class="Bound">s</a> <a id="9528" href="ScopesFrames.ScopesFrames.html#9515" class="Bound">Σ</a> <a id="9530" class="Symbol">→</a> <a id="9532" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="9537" href="ScopesFrames.ScopesFrames.html#9515" class="Bound">Σ</a> <a id="9539" class="Symbol">→</a> <a id="9541" href="ScopesFrames.ScopesFrames.html#3274" class="Bound">Val</a> <a id="9545" href="ScopesFrames.ScopesFrames.html#9497" class="Bound">t</a> <a id="9547" href="ScopesFrames.ScopesFrames.html#9515" class="Bound">Σ</a>
    <a id="9553" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getVal" class="Function">getVal</a> <a id="9560" class="Symbol">(</a><a id="9561" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_.path" class="InductiveConstructor">path</a> <a id="9566" href="ScopesFrames.ScopesFrames.html#9566" class="Bound">p</a> <a id="9568" href="ScopesFrames.ScopesFrames.html#9568" class="Bound">d</a><a id="9569" class="Symbol">)</a> <a id="9571" href="ScopesFrames.ScopesFrames.html#9571" class="Bound">f</a> <a id="9573" href="ScopesFrames.ScopesFrames.html#9573" class="Bound">h</a> <a id="9575" class="Symbol">=</a> <a id="9577" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getSlot" class="Function">getSlot</a> <a id="9585" href="ScopesFrames.ScopesFrames.html#9568" class="Bound">d</a> <a id="9587" class="Symbol">(</a><a id="9588" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9597" href="ScopesFrames.ScopesFrames.html#9566" class="Bound">p</a> <a id="9599" href="ScopesFrames.ScopesFrames.html#9571" class="Bound">f</a> <a id="9601" href="ScopesFrames.ScopesFrames.html#9573" class="Bound">h</a><a id="9602" class="Symbol">)</a> <a id="9604" href="ScopesFrames.ScopesFrames.html#9573" class="Bound">h</a>

    <a id="UsesGraph.UsesVal.setVal" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setVal" class="Function">setVal</a>  <a id="9619" class="Symbol">:</a>  <a id="9622" class="Symbol">∀</a> <a id="9624" class="Symbol">{</a><a id="9625" href="ScopesFrames.ScopesFrames.html#9625" class="Bound">s</a> <a id="9627" href="ScopesFrames.ScopesFrames.html#9627" class="Bound">t</a> <a id="9629" href="ScopesFrames.ScopesFrames.html#9629" class="Bound">Σ</a><a id="9630" class="Symbol">}</a> <a id="9632" class="Symbol">→</a> <a id="9634" class="Symbol">(</a><a id="9635" href="ScopesFrames.ScopesFrames.html#9625" class="Bound">s</a> <a id="9637" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">↦</a> <a id="9639" href="ScopesFrames.ScopesFrames.html#9627" class="Bound">t</a><a id="9640" class="Symbol">)</a> <a id="9642" class="Symbol">→</a> <a id="9644" href="ScopesFrames.ScopesFrames.html#3274" class="Bound">Val</a> <a id="9648" href="ScopesFrames.ScopesFrames.html#9627" class="Bound">t</a> <a id="9650" href="ScopesFrames.ScopesFrames.html#9629" class="Bound">Σ</a> <a id="9652" class="Symbol">→</a> <a id="9654" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="9660" href="ScopesFrames.ScopesFrames.html#9625" class="Bound">s</a> <a id="9662" href="ScopesFrames.ScopesFrames.html#9629" class="Bound">Σ</a> <a id="9664" class="Symbol">→</a> <a id="9666" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="9671" href="ScopesFrames.ScopesFrames.html#9629" class="Bound">Σ</a> <a id="9673" class="Symbol">→</a> <a id="9675" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="9680" href="ScopesFrames.ScopesFrames.html#9629" class="Bound">Σ</a>
    <a id="9686" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setVal" class="Function">setVal</a> <a id="9693" class="Symbol">(</a><a id="9694" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_.path" class="InductiveConstructor">path</a> <a id="9699" href="ScopesFrames.ScopesFrames.html#9699" class="Bound">p</a> <a id="9701" href="ScopesFrames.ScopesFrames.html#9701" class="Bound">d</a><a id="9702" class="Symbol">)</a> <a id="9704" href="ScopesFrames.ScopesFrames.html#9704" class="Bound">v</a> <a id="9706" href="ScopesFrames.ScopesFrames.html#9706" class="Bound">f</a> <a id="9708" href="ScopesFrames.ScopesFrames.html#9708" class="Bound">h</a> <a id="9710" class="Symbol">=</a> <a id="9712" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setSlot" class="Function">setSlot</a> <a id="9720" href="ScopesFrames.ScopesFrames.html#9701" class="Bound">d</a> <a id="9722" href="ScopesFrames.ScopesFrames.html#9704" class="Bound">v</a> <a id="9724" class="Symbol">(</a><a id="9725" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9734" href="ScopesFrames.ScopesFrames.html#9699" class="Bound">p</a> <a id="9736" href="ScopesFrames.ScopesFrames.html#9706" class="Bound">f</a> <a id="9738" href="ScopesFrames.ScopesFrames.html#9708" class="Bound">h</a><a id="9739" class="Symbol">)</a> <a id="9741" href="ScopesFrames.ScopesFrames.html#9708" class="Bound">h</a>
</pre></body></html>