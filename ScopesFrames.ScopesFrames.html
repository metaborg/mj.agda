<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ScopesFrames.ScopesFrames</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="22" class="Keyword">open</a> <a id="27" class="Keyword">import</a> <a id="34" href="Data.Fin.html" class="Module">Data.Fin</a>
<a id="43" class="Keyword">open</a> <a id="48" class="Keyword">import</a> <a id="55" href="Data.List.Most.html" class="Module">Data.List.Most</a>
<a id="70" class="Keyword">open</a> <a id="75" class="Keyword">import</a> <a id="82" href="Data.List.All.html" class="Module">Data.List.All</a> <a id="96" class="Keyword">renaming</a> <a id="105" class="Symbol">(</a><a id="106" href="Data.List.All.html#lookup" class="Function">lookup</a> <a id="113" class="Symbol">to</a> <a id="116" href="Data.List.All.html#lookup" class="Function">lookup∀</a><a id="123" class="Symbol">)</a>
<a id="125" class="Keyword">open</a> <a id="130" class="Keyword">import</a> <a id="137" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="146" class="Keyword">hiding</a> <a id="153" class="Symbol">(</a><a id="154" href="Data.Vec.html#_%E2%88%88_" class="Datatype Operator">_∈_</a> <a id="158" class="Symbol">;</a> <a id="160" href="Data.Vec.html#_%E2%88%B7%CA%B3_" class="Function Operator">_∷ʳ_</a> <a id="165" class="Symbol">;</a> <a id="167" href="Data.Vec.html#_%3E%3E%3D_" class="Function Operator">_&gt;&gt;=_</a> <a id="173" class="Symbol">;</a> <a id="175" href="Data.Vec.html#init" class="Function">init</a><a id="179" class="Symbol">)</a>
<a id="181" class="Keyword">open</a> <a id="186" class="Keyword">import</a> <a id="193" href="Data.Product.html" class="Module">Data.Product</a>
<a id="206" class="Keyword">open</a> <a id="211" class="Keyword">import</a> <a id="218" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="256" class="Keyword">hiding</a> <a id="263" class="Symbol">(</a><a id="264" href="Relation.Binary.PropositionalEquality.html#Reveal_%C2%B7_is_.%5B_%5D" class="InductiveConstructor Operator">[_]</a><a id="267" class="Symbol">)</a>
<a id="269" class="Keyword">open</a> <a id="274" href="Relation.Binary.PropositionalEquality.html#%E2%89%A1-Reasoning" class="Module">≡-Reasoning</a>
<a id="286" class="Keyword">open</a> <a id="291" class="Keyword">import</a> <a id="298" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="308" class="Keyword">open</a> <a id="313" class="Keyword">import</a> <a id="320" href="Data.List.Prefix.html" class="Module">Data.List.Prefix</a>
<a id="337" class="Keyword">open</a> <a id="342" class="Keyword">import</a> <a id="349" href="Data.List.Properties.Extra.html" class="Module">Data.List.Properties.Extra</a>
<a id="376" class="Keyword">open</a> <a id="381" class="Keyword">import</a> <a id="388" href="Data.List.All.Properties.Extra.html" class="Module">Data.List.All.Properties.Extra</a>
<a id="419" class="Keyword">open</a> <a id="424" class="Keyword">import</a> <a id="431" href="Data.List.All.html" class="Module">Data.List.All</a> <a id="445" class="Symbol">as</a> <a id="448" class="Module">List∀</a> <a id="454" class="Keyword">hiding</a> <a id="461" class="Symbol">(</a><a id="462" href="Data.List.All.html#lookup" class="Function">lookup</a><a id="468" class="Symbol">)</a>
<a id="470" class="Keyword">open</a> <a id="475" class="Keyword">import</a> <a id="482" href="Coinduction.html" class="Module">Coinduction</a>
<a id="494" class="Keyword">open</a> <a id="499" class="Keyword">import</a> <a id="506" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="517" class="Keyword">hiding</a> <a id="524" class="Symbol">(</a><a id="525" href="Data.Maybe.Base.html#All" class="Datatype">All</a><a id="528" class="Symbol">)</a>
<a id="530" class="Keyword">open</a> <a id="535" class="Keyword">import</a> <a id="542" href="Common.Weakening.html" class="Module">Common.Weakening</a>

<a id="560" class="Comment">-- This file contains the Agda Scope Graph Library described in</a>
<a id="624" class="Comment">-- Section 4 of the paper.</a>

<a id="652" class="Comment">-- The definitions are parameterized by a scope graph, where a scope</a>
<a id="721" class="Comment">-- graph is a finite map from scope identifiers to scope shape</a>
<a id="784" class="Comment">-- descriptors.</a>
<a id="800" class="Comment">--</a>
<a id="803" class="Comment">-- The scope graph library is also parametric in what the notion of</a>
<a id="871" class="Comment">-- type is for declarations in the scope graph.</a>
<a id="919" class="Comment">--</a>
<a id="922" class="Comment">-- We use modules for this library parameterization.  The `k`</a>
<a id="984" class="Comment">-- parameter of the `ScopesFrames` module represents the number of</a>
<a id="1051" class="Comment">-- scope identifiers in the scope graph that all definitions are</a>
<a id="1116" class="Comment">-- parameterized over; and the `Ty` parameter is a language-specific</a>
<a id="1185" class="Comment">-- notion of type.</a>

<a id="1205" class="Keyword">module</a> <a id="1212" href="ScopesFrames.ScopesFrames.html" class="Module">ScopesFrames.ScopesFrames</a> <a id="1238" class="Symbol">(</a><a id="1239" href="ScopesFrames.ScopesFrames.html#1239" class="Bound">k</a> <a id="1241" class="Symbol">:</a> <a id="1243" href="Agda.Builtin.Nat.html#%E2%84%95" class="Datatype">ℕ</a><a id="1244" class="Symbol">)</a> <a id="1246" class="Symbol">(</a><a id="1247" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a> <a id="1250" class="Symbol">:</a> <a id="1252" class="PrimitiveType">Set</a><a id="1255" class="Symbol">)</a> <a id="1257" class="Keyword">where</a>


<a id="1265" class="Comment">------------------</a>
<a id="1284" class="Comment">-- SCOPE GRAPHS --</a>
<a id="1303" class="Comment">------------------</a>

<a id="1323" class="Comment">-- Type aliases for scope identifiers (`Scope`s) and scope graphs</a>
<a id="1389" class="Comment">-- (`Graph`s).</a>
<a id="1404" class="Comment">--</a>
<a id="1407" class="Comment">-- As described in the paper, scope shapes are given by a list of</a>
<a id="1473" class="Comment">-- types corresponding to the declarations of the scope, and a list of</a>
<a id="1544" class="Comment">-- scopes, corresponding to the edges of the scope.</a>

<a id="Scope" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1603" class="Symbol">=</a> <a id="1605" href="Data.Fin.html#Fin" class="Datatype">Fin</a> <a id="1609" href="ScopesFrames.ScopesFrames.html#1239" class="Bound">k</a>
<a id="Graph" href="ScopesFrames.ScopesFrames.html#Graph" class="Function">Graph</a> <a id="1617" class="Symbol">=</a> <a id="1619" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1625" class="Symbol">→</a> <a id="1627" class="Symbol">(</a><a id="1628" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1633" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a> <a id="1636" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="1638" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1643" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a><a id="1648" class="Symbol">)</a>

<a id="1651" class="Comment">-- All the following definitions are parameterized by a scope graph</a>
<a id="1719" class="Comment">-- `g`.</a>

<a id="1728" class="Keyword">module</a> <a id="UsesGraph" href="ScopesFrames.ScopesFrames.html#UsesGraph" class="Module">UsesGraph</a> <a id="1745" class="Symbol">(</a><a id="1746" href="ScopesFrames.ScopesFrames.html#1746" class="Bound">g</a> <a id="1748" class="Symbol">:</a> <a id="1750" href="ScopesFrames.ScopesFrames.html#Graph" class="Function">Graph</a><a id="1755" class="Symbol">)</a> <a id="1757" class="Keyword">where</a>

  <a id="1766" class="Comment">-- Some projection functions:</a>
  <a id="UsesGraph.declsOf" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="1806" class="Symbol">:</a> <a id="1808" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1814" class="Symbol">→</a> <a id="1816" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1821" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a>     <a id="1828" class="Symbol">;</a>  <a id="1831" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="1839" href="ScopesFrames.ScopesFrames.html#1839" class="Bound">s</a>  <a id="1842" class="Symbol">=</a> <a id="1844" href="Data.Product.html#%CE%A3.proj%E2%82%81" class="Field">proj₁</a> <a id="1850" class="Symbol">(</a><a id="1851" href="ScopesFrames.ScopesFrames.html#1746" class="Bound">g</a> <a id="1853" href="ScopesFrames.ScopesFrames.html#1839" class="Bound">s</a><a id="1854" class="Symbol">)</a>
  <a id="UsesGraph.edgesOf" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="1866" class="Symbol">:</a> <a id="1868" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="1874" class="Symbol">→</a> <a id="1876" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="1881" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a>  <a id="1888" class="Symbol">;</a>  <a id="1891" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="1899" href="ScopesFrames.ScopesFrames.html#1899" class="Bound">s</a>  <a id="1902" class="Symbol">=</a> <a id="1904" href="Data.Product.html#%CE%A3.proj%E2%82%82" class="Field">proj₂</a> <a id="1910" class="Symbol">(</a><a id="1911" href="ScopesFrames.ScopesFrames.html#1746" class="Bound">g</a> <a id="1913" href="ScopesFrames.ScopesFrames.html#1899" class="Bound">s</a><a id="1914" class="Symbol">)</a>

  <a id="1919" class="Comment">-- A resolution path is a witness that we can traverse a sequence of</a>
  <a id="1990" class="Comment">-- scope edges (`_⟶_`) in `g` to arrive at a declaration of type</a>
  <a id="2057" class="Comment">-- `t`:</a>

  <a id="2068" class="Keyword">data</a> <a id="UsesGraph._⟶_" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">_⟶_</a> <a id="2077" class="Symbol">:</a> <a id="2079" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="2085" class="Symbol">→</a> <a id="2087" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="2093" class="Symbol">→</a> <a id="2095" class="PrimitiveType">Set</a> <a id="2099" class="Keyword">where</a>
    <a id="UsesGraph._⟶_.[]" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_.%5B%5D" class="InductiveConstructor">[]</a>   <a id="2114" class="Symbol">:</a>  <a id="2117" class="Symbol">∀</a> <a id="2119" class="Symbol">{</a><a id="2120" href="ScopesFrames.ScopesFrames.html#2120" class="Bound">s</a><a id="2121" class="Symbol">}</a> <a id="2123" class="Symbol">→</a> <a id="2125" href="ScopesFrames.ScopesFrames.html#2120" class="Bound">s</a> <a id="2127" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2129" href="ScopesFrames.ScopesFrames.html#2120" class="Bound">s</a>
    <a id="UsesGraph._⟶_._∷_" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_._%E2%88%B7_" class="InductiveConstructor Operator">_∷_</a>  <a id="2140" class="Symbol">:</a>  <a id="2143" class="Symbol">∀</a> <a id="2145" class="Symbol">{</a><a id="2146" href="ScopesFrames.ScopesFrames.html#2146" class="Bound">s</a> <a id="2148" href="ScopesFrames.ScopesFrames.html#2148" class="Bound">s&#39;</a> <a id="2151" href="ScopesFrames.ScopesFrames.html#2151" class="Bound">s&#39;&#39;</a><a id="2154" class="Symbol">}</a> <a id="2156" class="Symbol">→</a> <a id="2158" href="ScopesFrames.ScopesFrames.html#2148" class="Bound">s&#39;</a> <a id="2161" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="2163" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="2171" href="ScopesFrames.ScopesFrames.html#2146" class="Bound">s</a> <a id="2173" class="Symbol">→</a> <a id="2175" href="ScopesFrames.ScopesFrames.html#2148" class="Bound">s&#39;</a> <a id="2178" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2180" href="ScopesFrames.ScopesFrames.html#2151" class="Bound">s&#39;&#39;</a> <a id="2184" class="Symbol">→</a> <a id="2186" href="ScopesFrames.ScopesFrames.html#2146" class="Bound">s</a> <a id="2188" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2190" href="ScopesFrames.ScopesFrames.html#2151" class="Bound">s&#39;&#39;</a>

  <a id="2197" class="Keyword">data</a> <a id="UsesGraph._↦_" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">_↦_</a> <a id="2206" class="Symbol">(</a><a id="2207" href="ScopesFrames.ScopesFrames.html#2207" class="Bound">s</a> <a id="2209" class="Symbol">:</a> <a id="2211" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a><a id="2216" class="Symbol">)</a> <a id="2218" class="Symbol">(</a><a id="2219" href="ScopesFrames.ScopesFrames.html#2219" class="Bound">t</a> <a id="2221" class="Symbol">:</a> <a id="2223" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a><a id="2225" class="Symbol">)</a> <a id="2227" class="Symbol">:</a> <a id="2229" class="PrimitiveType">Set</a> <a id="2233" class="Keyword">where</a>
    <a id="UsesGraph._↦_.path" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_.path" class="InductiveConstructor">path</a> <a id="2248" class="Symbol">:</a> <a id="2250" class="Symbol">∀{</a><a id="2252" href="ScopesFrames.ScopesFrames.html#2252" class="Bound">s&#39;</a><a id="2254" class="Symbol">}</a> <a id="2256" class="Symbol">→</a> <a id="2258" href="ScopesFrames.ScopesFrames.html#2207" class="Bound">s</a> <a id="2260" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="2262" href="ScopesFrames.ScopesFrames.html#2252" class="Bound">s&#39;</a> <a id="2265" class="Symbol">→</a> <a id="2267" href="ScopesFrames.ScopesFrames.html#2219" class="Bound">t</a> <a id="2269" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="2271" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="2279" href="ScopesFrames.ScopesFrames.html#2252" class="Bound">s&#39;</a> <a id="2282" class="Symbol">→</a> <a id="2284" href="ScopesFrames.ScopesFrames.html#2207" class="Bound">s</a> <a id="2286" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">↦</a> <a id="2288" href="ScopesFrames.ScopesFrames.html#2219" class="Bound">t</a>

  <a id="2293" class="Comment">-- The definitions above fully define scope graphs.  The remaining</a>
  <a id="2362" class="Comment">-- definitions in this file are intrinsically-typed by this notion</a>
  <a id="2431" class="Comment">-- of scope graph.</a>


  <a id="2454" class="Comment">----------------------</a>
  <a id="2479" class="Comment">-- FRAMES AND HEAPS --</a>
  <a id="2504" class="Comment">----------------------</a>

  <a id="2530" class="Comment">-- Heap types summarize what the scope is for each frame location in</a>
  <a id="2601" class="Comment">-- the heap:</a>

  <a id="UsesGraph.HeapTy" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a> <a id="2624" class="Symbol">=</a> <a id="2626" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="2631" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a>

  <a id="2640" class="Comment">-- A frame pointer `Frame s Σ` is a witness that there is a frame</a>
  <a id="2708" class="Comment">-- location scoped by `s` in a heap typed by `Σ`:</a>

  <a id="UsesGraph.Frame" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="2767" class="Symbol">:</a> <a id="2769" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="2775" class="Symbol">→</a> <a id="2777" class="Symbol">(</a><a id="2778" href="ScopesFrames.ScopesFrames.html#2778" class="Bound">Σ</a> <a id="2780" class="Symbol">:</a> <a id="2782" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="2788" class="Symbol">)</a> <a id="2790" class="Symbol">→</a> <a id="2792" class="PrimitiveType">Set</a>
  <a id="2798" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="2804" href="ScopesFrames.ScopesFrames.html#2804" class="Bound">s</a> <a id="2806" href="ScopesFrames.ScopesFrames.html#2806" class="Bound">Σ</a> <a id="2808" class="Symbol">=</a> <a id="2810" href="ScopesFrames.ScopesFrames.html#2804" class="Bound">s</a> <a id="2812" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="2814" href="ScopesFrames.ScopesFrames.html#2806" class="Bound">Σ</a>

  <a id="2819" class="Comment">-- Concrete frames and heaps store values that are weakened when the</a>
  <a id="2890" class="Comment">-- heap is extended.  The following definitions are parameterized by</a>
  <a id="2961" class="Comment">-- a language-specific notion of weakenable value.</a>

  <a id="3015" class="Keyword">module</a> <a id="UsesVal" href="ScopesFrames.ScopesFrames.html#UsesVal" class="Module">UsesVal</a> <a id="3030" class="Symbol">(</a><a id="3031" href="ScopesFrames.ScopesFrames.html#3031" class="Bound">Val</a> <a id="3035" class="Symbol">:</a> <a id="3037" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a> <a id="3040" class="Symbol">→</a> <a id="3042" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a> <a id="3049" class="Symbol">→</a> <a id="3051" class="PrimitiveType">Set</a><a id="3054" class="Symbol">)</a>
                 <a id="3073" class="Symbol">(</a><a id="3074" href="ScopesFrames.ScopesFrames.html#3074" class="Bound">weaken-val</a> <a id="3085" class="Symbol">:</a> <a id="3087" class="Symbol">∀</a> <a id="3089" class="Symbol">{</a><a id="3090" href="ScopesFrames.ScopesFrames.html#3090" class="Bound">t</a> <a id="3092" href="ScopesFrames.ScopesFrames.html#3092" class="Bound">Σ</a> <a id="3094" href="ScopesFrames.ScopesFrames.html#3094" class="Bound">Σ&#39;</a><a id="3096" class="Symbol">}</a> <a id="3098" class="Symbol">→</a> <a id="3100" href="ScopesFrames.ScopesFrames.html#3092" class="Bound">Σ</a> <a id="3102" href="Data.List.Prefix.html#_%E2%8A%91_" class="Datatype Operator">⊑</a> <a id="3104" href="ScopesFrames.ScopesFrames.html#3094" class="Bound">Σ&#39;</a> <a id="3107" class="Symbol">→</a> <a id="3109" href="ScopesFrames.ScopesFrames.html#3031" class="Bound">Val</a> <a id="3113" href="ScopesFrames.ScopesFrames.html#3090" class="Bound">t</a> <a id="3115" href="ScopesFrames.ScopesFrames.html#3092" class="Bound">Σ</a> <a id="3117" class="Symbol">→</a> <a id="3119" href="ScopesFrames.ScopesFrames.html#3031" class="Bound">Val</a> <a id="3123" href="ScopesFrames.ScopesFrames.html#3090" class="Bound">t</a> <a id="3125" href="ScopesFrames.ScopesFrames.html#3094" class="Bound">Σ&#39;</a><a id="3127" class="Symbol">)</a> <a id="3129" class="Keyword">where</a>

    <a id="3140" class="Comment">-- Slots are given by a list of values that are in one-to-one</a>
    <a id="3206" class="Comment">-- correspondence with a list of declarations (types):</a>

    <a id="UsesGraph.UsesVal.Slots" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="3272" class="Symbol">:</a> <a id="3274" class="Symbol">(</a><a id="3275" href="ScopesFrames.ScopesFrames.html#3275" class="Bound">ds</a> <a id="3278" class="Symbol">:</a> <a id="3280" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="3285" href="ScopesFrames.ScopesFrames.html#1247" class="Bound">Ty</a><a id="3287" class="Symbol">)</a> <a id="3289" class="Symbol">→</a> <a id="3291" class="Symbol">(</a><a id="3292" href="ScopesFrames.ScopesFrames.html#3292" class="Bound">Σ</a> <a id="3294" class="Symbol">:</a> <a id="3296" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="3302" class="Symbol">)</a> <a id="3304" class="Symbol">→</a> <a id="3306" class="PrimitiveType">Set</a>
    <a id="3314" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="3320" href="ScopesFrames.ScopesFrames.html#3320" class="Bound">ds</a> <a id="3323" href="ScopesFrames.ScopesFrames.html#3323" class="Bound">Σ</a> <a id="3325" class="Symbol">=</a> <a id="3327" href="Data.List.All.html#All" class="Datatype">All</a> <a id="3331" class="Symbol">(λ</a> <a id="3334" href="ScopesFrames.ScopesFrames.html#3334" class="Bound">t</a> <a id="3336" class="Symbol">→</a> <a id="3338" href="ScopesFrames.ScopesFrames.html#3031" class="Bound">Val</a> <a id="3342" href="ScopesFrames.ScopesFrames.html#3334" class="Bound">t</a> <a id="3344" href="ScopesFrames.ScopesFrames.html#3323" class="Bound">Σ</a><a id="3345" class="Symbol">)</a> <a id="3347" href="ScopesFrames.ScopesFrames.html#3320" class="Bound">ds</a>

    <a id="3355" class="Comment">-- Links are given by a list of frame pointers (links) that are in</a>
    <a id="3426" class="Comment">-- one-to-one correspondence with a list of edges (scopes):</a>

    <a id="UsesGraph.UsesVal.Links" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="3497" class="Symbol">:</a> <a id="3499" class="Symbol">(</a><a id="3500" href="ScopesFrames.ScopesFrames.html#3500" class="Bound">es</a> <a id="3503" class="Symbol">:</a> <a id="3505" href="Agda.Builtin.List.html#List" class="Datatype">List</a> <a id="3510" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a><a id="3515" class="Symbol">)</a> <a id="3517" class="Symbol">→</a> <a id="3519" class="Symbol">(</a><a id="3520" href="ScopesFrames.ScopesFrames.html#3520" class="Bound">Σ</a> <a id="3522" class="Symbol">:</a> <a id="3524" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="3530" class="Symbol">)</a> <a id="3532" class="Symbol">→</a> <a id="3534" class="PrimitiveType">Set</a>
    <a id="3542" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="3548" href="ScopesFrames.ScopesFrames.html#3548" class="Bound">es</a> <a id="3551" href="ScopesFrames.ScopesFrames.html#3551" class="Bound">Σ</a> <a id="3553" class="Symbol">=</a> <a id="3555" href="Data.List.All.html#All" class="Datatype">All</a> <a id="3559" class="Symbol">(λ</a> <a id="3562" href="ScopesFrames.ScopesFrames.html#3562" class="Bound">s</a> <a id="3564" class="Symbol">→</a> <a id="3566" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="3572" href="ScopesFrames.ScopesFrames.html#3562" class="Bound">s</a> <a id="3574" href="ScopesFrames.ScopesFrames.html#3551" class="Bound">Σ</a><a id="3575" class="Symbol">)</a> <a id="3577" href="ScopesFrames.ScopesFrames.html#3548" class="Bound">es</a>

    <a id="3585" class="Comment">-- A heap frame for a scope `s` is given by a set of slots and</a>
    <a id="3652" class="Comment">-- links that are in one-to-one correspondence with the</a>
    <a id="3712" class="Comment">-- declarations and edges of the scope:</a>

    <a id="UsesGraph.UsesVal.HeapFrame" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="3767" class="Symbol">:</a> <a id="3769" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a> <a id="3775" class="Symbol">→</a> <a id="3777" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a> <a id="3784" class="Symbol">→</a> <a id="3786" class="PrimitiveType">Set</a>
    <a id="3794" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="3804" href="ScopesFrames.ScopesFrames.html#3804" class="Bound">s</a> <a id="3806" href="ScopesFrames.ScopesFrames.html#3806" class="Bound">Σ</a> <a id="3808" class="Symbol">=</a> <a id="3810" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="3816" class="Symbol">(</a><a id="3817" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="3825" href="ScopesFrames.ScopesFrames.html#3804" class="Bound">s</a><a id="3826" class="Symbol">)</a> <a id="3828" href="ScopesFrames.ScopesFrames.html#3806" class="Bound">Σ</a> <a id="3830" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="3832" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="3838" class="Symbol">(</a><a id="3839" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="3847" href="ScopesFrames.ScopesFrames.html#3804" class="Bound">s</a><a id="3848" class="Symbol">)</a> <a id="3850" href="ScopesFrames.ScopesFrames.html#3806" class="Bound">Σ</a>

    <a id="3857" class="Comment">-- A heap typed by `Σ` is given by a list of heap frames such that</a>
    <a id="3928" class="Comment">-- each frame location is in the heap is typed by the</a>
    <a id="3986" class="Comment">-- corresponding location in `Σ`.</a>

    <a id="UsesGraph.UsesVal.Heap" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="4030" class="Symbol">:</a> <a id="4032" class="Symbol">(</a><a id="4033" href="ScopesFrames.ScopesFrames.html#4033" class="Bound">Σ</a> <a id="4035" class="Symbol">:</a> <a id="4037" href="ScopesFrames.ScopesFrames.html#UsesGraph.HeapTy" class="Function">HeapTy</a><a id="4043" class="Symbol">)</a> <a id="4045" class="Symbol">→</a> <a id="4047" class="PrimitiveType">Set</a>
    <a id="4055" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="4060" href="ScopesFrames.ScopesFrames.html#4060" class="Bound">Σ</a> <a id="4062" class="Symbol">=</a> <a id="4064" href="Data.List.All.html#All" class="Datatype">All</a> <a id="4068" class="Symbol">(λ</a> <a id="4071" href="ScopesFrames.ScopesFrames.html#4071" class="Bound">s</a> <a id="4073" class="Symbol">→</a> <a id="4075" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="4085" href="ScopesFrames.ScopesFrames.html#4071" class="Bound">s</a> <a id="4087" href="ScopesFrames.ScopesFrames.html#4060" class="Bound">Σ</a><a id="4088" class="Symbol">)</a> <a id="4090" href="ScopesFrames.ScopesFrames.html#4060" class="Bound">Σ</a>


    <a id="4098" class="Comment">----------------------</a>
    <a id="4125" class="Comment">-- FRAME OPERATIONS --</a>
    <a id="4152" class="Comment">----------------------</a>

    <a id="4180" class="Comment">-- Frame initialization extends the heap, requiring heap type</a>
    <a id="4246" class="Comment">-- weakening.  The `Common.Weakening` module defines a generic</a>
    <a id="4313" class="Comment">-- `Weakenable` record, which we instantiate for each entity that</a>
    <a id="4383" class="Comment">-- is required to be weakenable.  We use Agda&#39;s instance arguments</a>
    <a id="4454" class="Comment">-- to automatically resolve the right notion of weakening where</a>
    <a id="4522" class="Comment">-- possible.</a>

    <a id="4540" class="Comment">-- We add some instances of the Weakenable typeclass</a>
    <a id="4597" class="Comment">-- to the instance argument scope:</a>

    <a id="4637" class="Keyword">instance</a>
      <a id="UsesGraph.UsesVal.weaken-val&#39;" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-val%27" class="Function">weaken-val&#39;</a> <a id="4664" class="Symbol">:</a> <a id="4666" class="Symbol">∀</a> <a id="4668" class="Symbol">{</a><a id="4669" href="ScopesFrames.ScopesFrames.html#4669" class="Bound">t</a><a id="4670" class="Symbol">}</a> <a id="4672" class="Symbol">→</a> <a id="4674" href="Common.Weakening.html#Weakenable" class="Record">Weakenable</a> <a id="4685" class="Symbol">(λ</a> <a id="4688" href="ScopesFrames.ScopesFrames.html#4688" class="Bound">Σ</a> <a id="4690" class="Symbol">→</a> <a id="4692" href="ScopesFrames.ScopesFrames.html#3031" class="Bound">Val</a> <a id="4696" href="ScopesFrames.ScopesFrames.html#4669" class="Bound">t</a> <a id="4698" href="ScopesFrames.ScopesFrames.html#4688" class="Bound">Σ</a><a id="4699" class="Symbol">)</a>
      <a id="4707" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-val%27" class="Function">weaken-val&#39;</a> <a id="4719" class="Symbol">=</a> <a id="4721" class="Keyword">record</a> <a id="4728" class="Symbol">{</a> <a id="4730" class="Field">wk</a> <a id="4733" class="Symbol">=</a> <a id="4735" href="ScopesFrames.ScopesFrames.html#3074" class="Bound">weaken-val</a> <a id="4746" class="Symbol">}</a>

      <a id="UsesGraph.UsesVal.weaken-heapframe" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-heapframe" class="Function">weaken-heapframe</a> <a id="4772" class="Symbol">:</a> <a id="4774" class="Symbol">∀</a> <a id="4776" class="Symbol">{</a><a id="4777" href="ScopesFrames.ScopesFrames.html#4777" class="Bound">s</a><a id="4778" class="Symbol">}</a> <a id="4780" class="Symbol">→</a> <a id="4782" href="Common.Weakening.html#Weakenable" class="Record">Weakenable</a> <a id="4793" class="Symbol">(</a><a id="4794" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.HeapFrame" class="Function">HeapFrame</a> <a id="4804" href="ScopesFrames.ScopesFrames.html#4777" class="Bound">s</a><a id="4805" class="Symbol">)</a>
      <a id="4813" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-heapframe" class="Function">weaken-heapframe</a> <a id="4830" class="Symbol">=</a> <a id="4832" class="Keyword">record</a> <a id="4839" class="Symbol">{</a> <a id="4841" class="Field">wk</a> <a id="4844" class="Symbol">=</a> <a id="4846" class="Symbol">λ{</a> <a id="4849" href="ScopesFrames.ScopesFrames.html#4849" class="Bound">ext</a> <a id="4853" class="Symbol">(</a><a id="4854" href="ScopesFrames.ScopesFrames.html#4854" class="Bound">slots</a> <a id="4860" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="4862" href="ScopesFrames.ScopesFrames.html#4862" class="Bound">links</a><a id="4867" class="Symbol">)</a> <a id="4869" class="Symbol">→</a> <a id="4871" class="Symbol">(</a><a id="4872" href="Common.Weakening.html#721" class="Field">wk</a> <a id="4875" href="ScopesFrames.ScopesFrames.html#4849" class="Bound">ext</a> <a id="4879" href="ScopesFrames.ScopesFrames.html#4854" class="Bound">slots</a> <a id="4885" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="4887" href="Common.Weakening.html#721" class="Field">wk</a> <a id="4890" href="ScopesFrames.ScopesFrames.html#4849" class="Bound">ext</a> <a id="4894" href="ScopesFrames.ScopesFrames.html#4862" class="Bound">links</a><a id="4899" class="Symbol">)</a> <a id="4901" class="Symbol">}</a> <a id="4903" class="Symbol">}</a>

      <a id="UsesGraph.UsesVal.weaken-frame" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-frame" class="Function">weaken-frame</a> <a id="4925" class="Symbol">:</a> <a id="4927" class="Symbol">∀</a> <a id="4929" class="Symbol">{</a><a id="4930" href="ScopesFrames.ScopesFrames.html#4930" class="Bound">s</a><a id="4931" class="Symbol">}</a> <a id="4933" class="Symbol">→</a> <a id="4935" href="Common.Weakening.html#Weakenable" class="Record">Weakenable</a> <a id="4946" class="Symbol">(</a><a id="4947" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="4953" href="ScopesFrames.ScopesFrames.html#4930" class="Bound">s</a><a id="4954" class="Symbol">)</a>
      <a id="4962" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.weaken-frame" class="Function">weaken-frame</a> <a id="4975" class="Symbol">=</a> <a id="4977" class="Keyword">record</a> <a id="4984" class="Symbol">{</a> <a id="4986" class="Field">wk</a> <a id="4989" class="Symbol">=</a> <a id="4991" href="Common.Weakening.html#Weakenable.wk" class="Field">Weakenable.wk</a> <a id="5005" href="Common.Weakening.html#any-weakenable" class="Function">any-weakenable</a> <a id="5020" class="Symbol">}</a>

    <a id="5027" class="Comment">-- Frame initialization takes as argument:</a>
    <a id="5074" class="Comment">--</a>
    <a id="5081" class="Comment">-- * a scope `s`;</a>
    <a id="5103" class="Comment">--</a>
    <a id="5110" class="Comment">-- * a scope shape witness which asserts that looking up `s` in</a>
    <a id="5178" class="Comment">--   the current scope graph `g` yields a scope shape where the</a>
    <a id="5246" class="Comment">--   declarations are given by a list of types `ds`, and scope</a>
    <a id="5313" class="Comment">--   edges are given by a list of scopes `es`;</a>
    <a id="5364" class="Comment">--</a>
    <a id="5371" class="Comment">-- * a set of slots typed by `ds`;</a>
    <a id="5410" class="Comment">--</a>
    <a id="5417" class="Comment">-- * a set of links typed by `es`; and</a>
    <a id="5460" class="Comment">--</a>
    <a id="5467" class="Comment">-- * a heap typed by the heap type `Σ` which also types the slots</a>
    <a id="5537" class="Comment">--   and links.</a>
    <a id="5557" class="Comment">--</a>
    <a id="5564" class="Comment">-- The operation returns an extended heap (`∷ʳ` appends a single</a>
    <a id="5633" class="Comment">-- element to a list, and is defined in `Data.List.Base` in the</a>
    <a id="5701" class="Comment">-- Agda Standard Library) and a frame pointer into the extended</a>
    <a id="5769" class="Comment">-- heap, i.e., the newly allocated and initialized frame.</a>

    <a id="UsesGraph.UsesVal.initFrame" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.initFrame" class="Function">initFrame</a>   <a id="5844" class="Symbol">:</a>  <a id="5847" class="Symbol">(</a><a id="5848" href="ScopesFrames.ScopesFrames.html#5848" class="Bound">s</a> <a id="5850" class="Symbol">:</a> <a id="5852" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a><a id="5857" class="Symbol">)</a> <a id="5859" class="Symbol">→</a> <a id="5861" class="Symbol">∀</a> <a id="5863" class="Symbol">{</a><a id="5864" href="ScopesFrames.ScopesFrames.html#5864" class="Bound">Σ</a> <a id="5866" href="ScopesFrames.ScopesFrames.html#5866" class="Bound">ds</a> <a id="5869" href="ScopesFrames.ScopesFrames.html#5869" class="Bound">es</a><a id="5871" class="Symbol">}⦃</a> <a id="5874" href="ScopesFrames.ScopesFrames.html#5874" class="Bound">shape</a> <a id="5880" class="Symbol">:</a> <a id="5882" href="ScopesFrames.ScopesFrames.html#1746" class="Bound">g</a> <a id="5884" href="ScopesFrames.ScopesFrames.html#5848" class="Bound">s</a> <a id="5886" href="Agda.Builtin.Equality.html#_%E2%89%A1_" class="Datatype Operator">≡</a> <a id="5888" class="Symbol">(</a><a id="5889" href="ScopesFrames.ScopesFrames.html#5866" class="Bound">ds</a> <a id="5892" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="5894" href="ScopesFrames.ScopesFrames.html#5869" class="Bound">es</a><a id="5896" class="Symbol">)</a> <a id="5898" class="Symbol">⦄</a> <a id="5900" class="Symbol">→</a>
                   <a id="5921" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="5927" href="ScopesFrames.ScopesFrames.html#5866" class="Bound">ds</a> <a id="5930" href="ScopesFrames.ScopesFrames.html#5864" class="Bound">Σ</a> <a id="5932" class="Symbol">→</a> <a id="5934" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="5940" href="ScopesFrames.ScopesFrames.html#5869" class="Bound">es</a> <a id="5943" href="ScopesFrames.ScopesFrames.html#5864" class="Bound">Σ</a> <a id="5945" class="Symbol">→</a> <a id="5947" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="5952" href="ScopesFrames.ScopesFrames.html#5864" class="Bound">Σ</a> <a id="5954" class="Symbol">→</a> <a id="5956" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="5962" href="ScopesFrames.ScopesFrames.html#5848" class="Bound">s</a> <a id="5964" class="Symbol">(</a><a id="5965" href="ScopesFrames.ScopesFrames.html#5864" class="Bound">Σ</a> <a id="5967" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="5970" href="ScopesFrames.ScopesFrames.html#5848" class="Bound">s</a><a id="5971" class="Symbol">)</a> <a id="5973" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="5975" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="5980" class="Symbol">(</a><a id="5981" href="ScopesFrames.ScopesFrames.html#5864" class="Bound">Σ</a> <a id="5983" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="5986" href="ScopesFrames.ScopesFrames.html#5848" class="Bound">s</a><a id="5987" class="Symbol">)</a>
    <a id="5993" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.initFrame" class="Function">initFrame</a> <a id="6003" href="ScopesFrames.ScopesFrames.html#6003" class="Bound">s</a> <a id="6005" class="Symbol">{</a><a id="6006" href="ScopesFrames.ScopesFrames.html#6006" class="Bound">Σ</a><a id="6007" class="Symbol">}</a> <a id="6009" class="Symbol">⦃</a> <a id="6011" href="Agda.Builtin.Equality.html#_%E2%89%A1_.refl" class="InductiveConstructor">refl</a> <a id="6016" class="Symbol">⦄</a> <a id="6018" href="ScopesFrames.ScopesFrames.html#6018" class="Bound">slots</a> <a id="6024" href="ScopesFrames.ScopesFrames.html#6024" class="Bound">links</a> <a id="6030" href="ScopesFrames.ScopesFrames.html#6030" class="Bound">h</a> <a id="6032" class="Symbol">=</a>
      <a id="6040" class="Keyword">let</a> <a id="6044" href="ScopesFrames.ScopesFrames.html#6044" class="Bound">ext</a> <a id="6048" class="Symbol">=</a> <a id="6050" href="Data.List.Prefix.html#%E2%88%B7%CA%B3-%E2%8A%92" class="Function">∷ʳ-⊒</a> <a id="6055" href="ScopesFrames.ScopesFrames.html#6003" class="Bound">s</a> <a id="6057" href="ScopesFrames.ScopesFrames.html#6006" class="Bound">Σ</a> <a id="6059" class="Comment">-- heap extension fact</a>
          <a id="6092" href="ScopesFrames.ScopesFrames.html#6092" class="Bound">f&#39;</a>  <a id="6096" class="Symbol">=</a> <a id="6098" href="Data.List.Properties.Extra.html#%E2%88%88-%E2%88%B7%CA%B3" class="Function">∈-∷ʳ</a> <a id="6103" href="ScopesFrames.ScopesFrames.html#6006" class="Bound">Σ</a> <a id="6105" href="ScopesFrames.ScopesFrames.html#6003" class="Bound">s</a> <a id="6107" class="Comment">-- updated frame pointer witness</a>
          <a id="6150" href="ScopesFrames.ScopesFrames.html#6150" class="Bound">h&#39;</a>  <a id="6154" class="Symbol">=</a> <a id="6156" class="Symbol">(</a><a id="6157" href="Common.Weakening.html#721" class="Field">wk</a> <a id="6160" href="ScopesFrames.ScopesFrames.html#6044" class="Bound">ext</a> <a id="6164" href="ScopesFrames.ScopesFrames.html#6030" class="Bound">h</a><a id="6165" class="Symbol">)</a> <a id="6167" href="Data.List.All.Properties.Extra.html#_all-%E2%88%B7%CA%B3_" class="Function Operator">all-∷ʳ</a> <a id="6174" class="Symbol">(</a><a id="6175" href="Common.Weakening.html#721" class="Field">wk</a> <a id="6178" href="ScopesFrames.ScopesFrames.html#6044" class="Bound">ext</a> <a id="6182" href="ScopesFrames.ScopesFrames.html#6018" class="Bound">slots</a> <a id="6188" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="6190" href="Common.Weakening.html#721" class="Field">wk</a> <a id="6193" href="ScopesFrames.ScopesFrames.html#6044" class="Bound">ext</a> <a id="6197" href="ScopesFrames.ScopesFrames.html#6024" class="Bound">links</a><a id="6202" class="Symbol">)</a> <a id="6204" class="Comment">-- extended heap</a>
      <a id="6227" class="Keyword">in</a> <a id="6230" class="Symbol">(</a><a id="6231" href="ScopesFrames.ScopesFrames.html#6092" class="Bound">f&#39;</a> <a id="6234" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="6236" href="ScopesFrames.ScopesFrames.html#6150" class="Bound">h&#39;</a><a id="6238" class="Symbol">)</a>

    <a id="6245" class="Comment">-- Frames may be self-referential.  For example, the values stored</a>
    <a id="6316" class="Comment">-- in the slots of a frame may contain pointers to the frame</a>
    <a id="6381" class="Comment">-- itself.  The `initFrame` function above does not support</a>
    <a id="6445" class="Comment">-- initializing such self-referential slots, since the slots are</a>
    <a id="6514" class="Comment">-- assumed to be typed under the unextended heap.</a>
    <a id="6568" class="Comment">--</a>
    <a id="6575" class="Comment">-- The `initFrameι` function we now define takes as argument a</a>
    <a id="6642" class="Comment">-- function to be used to initialize possibly-self-referential</a>
    <a id="6709" class="Comment">-- frame slots.  The function takes as argument a frame pointer</a>
    <a id="6777" class="Comment">-- into a heap extended by the scope that we are currently</a>
    <a id="6840" class="Comment">-- initializing, and slots are typed under this extended heap;</a>
    <a id="6907" class="Comment">-- hence the slots can have self-references to the frame currently</a>
    <a id="6978" class="Comment">-- being initialized.</a>

    <a id="UsesGraph.UsesVal.initFrameι" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.initFrame%CE%B9" class="Function">initFrameι</a> <a id="7016" class="Symbol">:</a> <a id="7018" class="Symbol">(</a><a id="7019" href="ScopesFrames.ScopesFrames.html#7019" class="Bound">s</a> <a id="7021" class="Symbol">:</a> <a id="7023" href="ScopesFrames.ScopesFrames.html#Scope" class="Function">Scope</a><a id="7028" class="Symbol">)</a> <a id="7030" class="Symbol">→</a> <a id="7032" class="Symbol">∀</a> <a id="7034" class="Symbol">{</a><a id="7035" href="ScopesFrames.ScopesFrames.html#7035" class="Bound">Σ</a> <a id="7037" href="ScopesFrames.ScopesFrames.html#7037" class="Bound">ds</a> <a id="7040" href="ScopesFrames.ScopesFrames.html#7040" class="Bound">es</a><a id="7042" class="Symbol">}⦃</a> <a id="7045" href="ScopesFrames.ScopesFrames.html#7045" class="Bound">shape</a> <a id="7051" class="Symbol">:</a> <a id="7053" href="ScopesFrames.ScopesFrames.html#1746" class="Bound">g</a> <a id="7055" href="ScopesFrames.ScopesFrames.html#7019" class="Bound">s</a> <a id="7057" href="Agda.Builtin.Equality.html#_%E2%89%A1_" class="Datatype Operator">≡</a> <a id="7059" class="Symbol">(</a><a id="7060" href="ScopesFrames.ScopesFrames.html#7037" class="Bound">ds</a> <a id="7063" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="7065" href="ScopesFrames.ScopesFrames.html#7040" class="Bound">es</a><a id="7067" class="Symbol">)</a> <a id="7069" class="Symbol">⦄</a> <a id="7071" class="Symbol">→</a>
                 <a id="7090" class="Symbol">(</a><a id="7091" href="ScopesFrames.ScopesFrames.html#7091" class="Bound">slotsf</a> <a id="7098" class="Symbol">:</a> <a id="7100" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="7106" href="ScopesFrames.ScopesFrames.html#7019" class="Bound">s</a> <a id="7108" class="Symbol">(</a><a id="7109" href="ScopesFrames.ScopesFrames.html#7035" class="Bound">Σ</a> <a id="7111" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7114" href="ScopesFrames.ScopesFrames.html#7019" class="Bound">s</a><a id="7115" class="Symbol">)</a> <a id="7117" class="Symbol">→</a> <a id="7119" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Slots" class="Function">Slots</a> <a id="7125" href="ScopesFrames.ScopesFrames.html#7037" class="Bound">ds</a> <a id="7128" class="Symbol">(</a><a id="7129" href="ScopesFrames.ScopesFrames.html#7035" class="Bound">Σ</a> <a id="7131" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7134" href="ScopesFrames.ScopesFrames.html#7019" class="Bound">s</a><a id="7135" class="Symbol">))</a> <a id="7138" class="Symbol">→</a> <a id="7140" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Links" class="Function">Links</a> <a id="7146" href="ScopesFrames.ScopesFrames.html#7040" class="Bound">es</a> <a id="7149" href="ScopesFrames.ScopesFrames.html#7035" class="Bound">Σ</a> <a id="7151" class="Symbol">→</a> <a id="7153" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="7158" href="ScopesFrames.ScopesFrames.html#7035" class="Bound">Σ</a> <a id="7160" class="Symbol">→</a>
                 <a id="7179" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="7185" href="ScopesFrames.ScopesFrames.html#7019" class="Bound">s</a> <a id="7187" class="Symbol">(</a><a id="7188" href="ScopesFrames.ScopesFrames.html#7035" class="Bound">Σ</a> <a id="7190" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7193" href="ScopesFrames.ScopesFrames.html#7019" class="Bound">s</a><a id="7194" class="Symbol">)</a> <a id="7196" href="Data.Product.html#_%C3%97_" class="Function Operator">×</a> <a id="7198" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="7203" class="Symbol">(</a><a id="7204" href="ScopesFrames.ScopesFrames.html#7035" class="Bound">Σ</a> <a id="7206" href="Data.List.Base.html#_%E2%88%B7%CA%B3_" class="Function Operator">∷ʳ</a> <a id="7209" href="ScopesFrames.ScopesFrames.html#7019" class="Bound">s</a><a id="7210" class="Symbol">)</a>
    <a id="7216" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.initFrame%CE%B9" class="Function">initFrameι</a> <a id="7227" href="ScopesFrames.ScopesFrames.html#7227" class="Bound">s</a> <a id="7229" class="Symbol">{</a><a id="7230" href="ScopesFrames.ScopesFrames.html#7230" class="Bound">Σ</a><a id="7231" class="Symbol">}</a> <a id="7233" class="Symbol">⦃</a> <a id="7235" href="Agda.Builtin.Equality.html#_%E2%89%A1_.refl" class="InductiveConstructor">refl</a> <a id="7240" class="Symbol">⦄</a> <a id="7242" href="ScopesFrames.ScopesFrames.html#7242" class="Bound">slotsf</a> <a id="7249" href="ScopesFrames.ScopesFrames.html#7249" class="Bound">links</a> <a id="7255" href="ScopesFrames.ScopesFrames.html#7255" class="Bound">h</a> <a id="7257" class="Symbol">=</a>
      <a id="7265" class="Keyword">let</a> <a id="7269" href="ScopesFrames.ScopesFrames.html#7269" class="Bound">ext</a> <a id="7273" class="Symbol">=</a> <a id="7275" href="Data.List.Prefix.html#%E2%88%B7%CA%B3-%E2%8A%92" class="Function">∷ʳ-⊒</a> <a id="7280" href="ScopesFrames.ScopesFrames.html#7227" class="Bound">s</a> <a id="7282" href="ScopesFrames.ScopesFrames.html#7230" class="Bound">Σ</a> <a id="7284" class="Comment">-- heap extension fact</a>
          <a id="7317" href="ScopesFrames.ScopesFrames.html#7317" class="Bound">f&#39;</a>  <a id="7321" class="Symbol">=</a> <a id="7323" href="Data.List.Properties.Extra.html#%E2%88%88-%E2%88%B7%CA%B3" class="Function">∈-∷ʳ</a> <a id="7328" href="ScopesFrames.ScopesFrames.html#7230" class="Bound">Σ</a> <a id="7330" href="ScopesFrames.ScopesFrames.html#7227" class="Bound">s</a> <a id="7332" class="Comment">-- updated frame pointer witness</a>
          <a id="7375" href="ScopesFrames.ScopesFrames.html#7375" class="Bound">h&#39;</a>  <a id="7379" class="Symbol">=</a> <a id="7381" class="Symbol">(</a><a id="7382" href="Common.Weakening.html#721" class="Field">wk</a> <a id="7385" href="ScopesFrames.ScopesFrames.html#7269" class="Bound">ext</a> <a id="7389" href="ScopesFrames.ScopesFrames.html#7255" class="Bound">h</a><a id="7390" class="Symbol">)</a> <a id="7392" href="Data.List.All.Properties.Extra.html#_all-%E2%88%B7%CA%B3_" class="Function Operator">all-∷ʳ</a> <a id="7399" class="Symbol">(</a><a id="7400" href="ScopesFrames.ScopesFrames.html#7242" class="Bound">slotsf</a> <a id="7407" href="ScopesFrames.ScopesFrames.html#7317" class="Bound">f&#39;</a> <a id="7410" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="7412" href="Common.Weakening.html#721" class="Field">wk</a> <a id="7415" href="ScopesFrames.ScopesFrames.html#7269" class="Bound">ext</a> <a id="7419" href="ScopesFrames.ScopesFrames.html#7249" class="Bound">links</a><a id="7424" class="Symbol">)</a> <a id="7426" class="Comment">-- extended heap</a>
      <a id="7449" class="Keyword">in</a> <a id="7452" class="Symbol">(</a><a id="7453" href="ScopesFrames.ScopesFrames.html#7317" class="Bound">f&#39;</a> <a id="7456" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="7458" href="ScopesFrames.ScopesFrames.html#7375" class="Bound">h&#39;</a><a id="7460" class="Symbol">)</a>


    <a id="7468" class="Comment">-- Given a witness that a declaration typed by `t` is in a scope,</a>
    <a id="7538" class="Comment">-- and a frame pointer, we can fetch the well-typed value stored</a>
    <a id="7607" class="Comment">-- in the corresponding frame slot:</a>

    <a id="UsesGraph.UsesVal.getSlot" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getSlot" class="Function">getSlot</a> <a id="7656" class="Symbol">:</a> <a id="7658" class="Symbol">∀</a> <a id="7660" class="Symbol">{</a><a id="7661" href="ScopesFrames.ScopesFrames.html#7661" class="Bound">s</a> <a id="7663" href="ScopesFrames.ScopesFrames.html#7663" class="Bound">t</a> <a id="7665" href="ScopesFrames.ScopesFrames.html#7665" class="Bound">Σ</a><a id="7666" class="Symbol">}</a> <a id="7668" class="Symbol">→</a> <a id="7670" href="ScopesFrames.ScopesFrames.html#7663" class="Bound">t</a> <a id="7672" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="7674" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="7682" href="ScopesFrames.ScopesFrames.html#7661" class="Bound">s</a> <a id="7684" class="Symbol">→</a> <a id="7686" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="7692" href="ScopesFrames.ScopesFrames.html#7661" class="Bound">s</a> <a id="7694" href="ScopesFrames.ScopesFrames.html#7665" class="Bound">Σ</a> <a id="7696" class="Symbol">→</a> <a id="7698" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="7703" href="ScopesFrames.ScopesFrames.html#7665" class="Bound">Σ</a> <a id="7705" class="Symbol">→</a> <a id="7707" href="ScopesFrames.ScopesFrames.html#3031" class="Bound">Val</a> <a id="7711" href="ScopesFrames.ScopesFrames.html#7663" class="Bound">t</a> <a id="7713" href="ScopesFrames.ScopesFrames.html#7665" class="Bound">Σ</a>
    <a id="7719" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getSlot" class="Function">getSlot</a> <a id="7727" href="ScopesFrames.ScopesFrames.html#7727" class="Bound">d</a> <a id="7729" href="ScopesFrames.ScopesFrames.html#7729" class="Bound">f</a> <a id="7731" href="ScopesFrames.ScopesFrames.html#7731" class="Bound">h</a>
      <a id="7739" class="Keyword">with</a> <a id="7744" class="Symbol">(</a><a id="7745" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="7758" href="ScopesFrames.ScopesFrames.html#7731" class="Bound">h</a> <a id="7760" href="ScopesFrames.ScopesFrames.html#7729" class="Bound">f</a><a id="7761" class="Symbol">)</a>
    <a id="7767" class="Symbol">...</a>  <a id="7772" class="Symbol">|</a> <a id="7774" class="Symbol">(</a><a id="7775" href="ScopesFrames.ScopesFrames.html#7775" class="Bound">slots</a> <a id="7781" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="7783" href="ScopesFrames.ScopesFrames.html#7783" class="Bound">links</a><a id="7788" class="Symbol">)</a> <a id="7790" class="Symbol">=</a> <a id="7792" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="7805" href="ScopesFrames.ScopesFrames.html#7775" class="Bound">slots</a> <a id="7811" class="Bound">d</a>

    <a id="7818" class="Comment">-- Given a witness that a declaration typed by `t` is in a scope,</a>
    <a id="7888" class="Comment">-- and a frame pointer, we can mutate the corresponding slot in a</a>
    <a id="7958" class="Comment">-- type preserving manner:</a>

    <a id="UsesGraph.UsesVal.setSlot" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setSlot" class="Function">setSlot</a> <a id="7998" class="Symbol">:</a> <a id="8000" class="Symbol">∀</a> <a id="8002" class="Symbol">{</a><a id="8003" href="ScopesFrames.ScopesFrames.html#8003" class="Bound">s</a> <a id="8005" href="ScopesFrames.ScopesFrames.html#8005" class="Bound">t</a> <a id="8007" href="ScopesFrames.ScopesFrames.html#8007" class="Bound">Σ</a><a id="8008" class="Symbol">}</a> <a id="8010" class="Symbol">→</a> <a id="8012" href="ScopesFrames.ScopesFrames.html#8005" class="Bound">t</a> <a id="8014" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="8016" href="ScopesFrames.ScopesFrames.html#UsesGraph.declsOf" class="Function">declsOf</a> <a id="8024" href="ScopesFrames.ScopesFrames.html#8003" class="Bound">s</a> <a id="8026" class="Symbol">→</a> <a id="8028" href="ScopesFrames.ScopesFrames.html#3031" class="Bound">Val</a> <a id="8032" href="ScopesFrames.ScopesFrames.html#8005" class="Bound">t</a> <a id="8034" href="ScopesFrames.ScopesFrames.html#8007" class="Bound">Σ</a> <a id="8036" class="Symbol">→</a> <a id="8038" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8044" href="ScopesFrames.ScopesFrames.html#8003" class="Bound">s</a> <a id="8046" href="ScopesFrames.ScopesFrames.html#8007" class="Bound">Σ</a> <a id="8048" class="Symbol">→</a> <a id="8050" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8055" href="ScopesFrames.ScopesFrames.html#8007" class="Bound">Σ</a> <a id="8057" class="Symbol">→</a> <a id="8059" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8064" href="ScopesFrames.ScopesFrames.html#8007" class="Bound">Σ</a>
    <a id="8070" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setSlot" class="Function">setSlot</a> <a id="8078" href="ScopesFrames.ScopesFrames.html#8078" class="Bound">d</a> <a id="8080" href="ScopesFrames.ScopesFrames.html#8080" class="Bound">v</a> <a id="8082" href="ScopesFrames.ScopesFrames.html#8082" class="Bound">f</a> <a id="8084" href="ScopesFrames.ScopesFrames.html#8084" class="Bound">h</a>
      <a id="8092" class="Keyword">with</a> <a id="8097" class="Symbol">(</a><a id="8098" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8111" href="ScopesFrames.ScopesFrames.html#8084" class="Bound">h</a> <a id="8113" href="ScopesFrames.ScopesFrames.html#8082" class="Bound">f</a><a id="8114" class="Symbol">)</a>
    <a id="8120" class="Symbol">...</a>  <a id="8125" class="Symbol">|</a> <a id="8127" class="Symbol">(</a><a id="8128" href="ScopesFrames.ScopesFrames.html#8128" class="Bound">slots</a> <a id="8134" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8136" href="ScopesFrames.ScopesFrames.html#8136" class="Bound">links</a><a id="8141" class="Symbol">)</a> <a id="8143" class="Symbol">=</a> <a id="8145" class="Bound">h</a> <a id="8147" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8152" class="Bound">f</a> <a id="8154" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8158" class="Symbol">(</a><a id="8159" href="ScopesFrames.ScopesFrames.html#8128" class="Bound">slots</a> <a id="8165" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8170" class="Bound">d</a> <a id="8172" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8176" class="Bound">v</a> <a id="8178" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8180" href="ScopesFrames.ScopesFrames.html#8136" class="Bound">links</a><a id="8185" class="Symbol">)</a>

    <a id="8192" class="Comment">-- ... and similarly for edges:</a>

    <a id="UsesGraph.UsesVal.getLink" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getLink" class="Function">getLink</a> <a id="8237" class="Symbol">:</a> <a id="8239" class="Symbol">∀</a> <a id="8241" class="Symbol">{</a><a id="8242" href="ScopesFrames.ScopesFrames.html#8242" class="Bound">s</a> <a id="8244" href="ScopesFrames.ScopesFrames.html#8244" class="Bound">s&#39;</a> <a id="8247" href="ScopesFrames.ScopesFrames.html#8247" class="Bound">Σ</a><a id="8248" class="Symbol">}</a> <a id="8250" class="Symbol">→</a> <a id="8252" href="ScopesFrames.ScopesFrames.html#8244" class="Bound">s&#39;</a> <a id="8255" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="8257" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="8265" href="ScopesFrames.ScopesFrames.html#8242" class="Bound">s</a> <a id="8267" class="Symbol">→</a> <a id="8269" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8275" href="ScopesFrames.ScopesFrames.html#8242" class="Bound">s</a> <a id="8277" href="ScopesFrames.ScopesFrames.html#8247" class="Bound">Σ</a> <a id="8279" class="Symbol">→</a> <a id="8281" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8286" href="ScopesFrames.ScopesFrames.html#8247" class="Bound">Σ</a> <a id="8288" class="Symbol">→</a> <a id="8290" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8296" href="ScopesFrames.ScopesFrames.html#8244" class="Bound">s&#39;</a> <a id="8299" href="ScopesFrames.ScopesFrames.html#8247" class="Bound">Σ</a>
    <a id="8305" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getLink" class="Function">getLink</a> <a id="8313" href="ScopesFrames.ScopesFrames.html#8313" class="Bound">e</a> <a id="8315" href="ScopesFrames.ScopesFrames.html#8315" class="Bound">f</a> <a id="8317" href="ScopesFrames.ScopesFrames.html#8317" class="Bound">h</a>
      <a id="8325" class="Keyword">with</a> <a id="8330" class="Symbol">(</a><a id="8331" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8344" href="ScopesFrames.ScopesFrames.html#8317" class="Bound">h</a> <a id="8346" href="ScopesFrames.ScopesFrames.html#8315" class="Bound">f</a><a id="8347" class="Symbol">)</a>
    <a id="8353" class="Symbol">...</a>  <a id="8358" class="Symbol">|</a> <a id="8360" class="Symbol">(</a><a id="8361" href="ScopesFrames.ScopesFrames.html#8361" class="Bound">slots</a> <a id="8367" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8369" href="ScopesFrames.ScopesFrames.html#8369" class="Bound">links</a><a id="8374" class="Symbol">)</a> <a id="8376" class="Symbol">=</a> <a id="8378" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8391" href="ScopesFrames.ScopesFrames.html#8369" class="Bound">links</a> <a id="8397" class="Bound">e</a>

    <a id="UsesGraph.UsesVal.setLink" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setLink" class="Function">setLink</a> <a id="8412" class="Symbol">:</a> <a id="8414" class="Symbol">∀</a> <a id="8416" class="Symbol">{</a><a id="8417" href="ScopesFrames.ScopesFrames.html#8417" class="Bound">s</a> <a id="8419" href="ScopesFrames.ScopesFrames.html#8419" class="Bound">s&#39;</a> <a id="8422" href="ScopesFrames.ScopesFrames.html#8422" class="Bound">Σ</a><a id="8423" class="Symbol">}</a> <a id="8425" class="Symbol">→</a> <a id="8427" href="ScopesFrames.ScopesFrames.html#8419" class="Bound">s&#39;</a> <a id="8430" href="Data.List.Any.Membership.html#Propositional.M._%E2%88%88_" class="Function Operator">∈</a> <a id="8432" href="ScopesFrames.ScopesFrames.html#UsesGraph.edgesOf" class="Function">edgesOf</a> <a id="8440" href="ScopesFrames.ScopesFrames.html#8417" class="Bound">s</a> <a id="8442" class="Symbol">→</a> <a id="8444" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8450" href="ScopesFrames.ScopesFrames.html#8419" class="Bound">s&#39;</a> <a id="8453" href="ScopesFrames.ScopesFrames.html#8422" class="Bound">Σ</a> <a id="8455" class="Symbol">→</a> <a id="8457" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8463" href="ScopesFrames.ScopesFrames.html#8417" class="Bound">s</a> <a id="8465" href="ScopesFrames.ScopesFrames.html#8422" class="Bound">Σ</a> <a id="8467" class="Symbol">→</a> <a id="8469" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8474" href="ScopesFrames.ScopesFrames.html#8422" class="Bound">Σ</a> <a id="8476" class="Symbol">→</a> <a id="8478" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8483" href="ScopesFrames.ScopesFrames.html#8422" class="Bound">Σ</a>
    <a id="8489" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setLink" class="Function">setLink</a> <a id="8497" href="ScopesFrames.ScopesFrames.html#8497" class="Bound">e</a> <a id="8499" href="ScopesFrames.ScopesFrames.html#8499" class="Bound">f&#39;</a> <a id="8502" href="ScopesFrames.ScopesFrames.html#8502" class="Bound">f</a> <a id="8504" href="ScopesFrames.ScopesFrames.html#8504" class="Bound">h</a>
      <a id="8512" class="Keyword">with</a> <a id="8517" class="Symbol">(</a><a id="8518" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="8531" href="ScopesFrames.ScopesFrames.html#8504" class="Bound">h</a> <a id="8533" href="ScopesFrames.ScopesFrames.html#8502" class="Bound">f</a><a id="8534" class="Symbol">)</a>
    <a id="8540" class="Symbol">...</a>  <a id="8545" class="Symbol">|</a> <a id="8547" class="Symbol">(</a><a id="8548" href="ScopesFrames.ScopesFrames.html#8548" class="Bound">slots</a> <a id="8554" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8556" href="ScopesFrames.ScopesFrames.html#8556" class="Bound">links</a><a id="8561" class="Symbol">)</a> <a id="8563" class="Symbol">=</a> <a id="8565" class="Bound">h</a> <a id="8567" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8572" class="Bound">f</a> <a id="8574" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8578" class="Symbol">(</a><a id="8579" href="ScopesFrames.ScopesFrames.html#8548" class="Bound">slots</a> <a id="8585" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="8587" href="ScopesFrames.ScopesFrames.html#8556" class="Bound">links</a> <a id="8593" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">All[</a> <a id="8598" class="Bound">e</a> <a id="8600" href="Data.List.All.Properties.Extra.html#_All%5B_%5D%E2%89%94%27_" class="Function Operator">]≔&#39;</a> <a id="8604" class="Bound">f&#39;</a><a id="8606" class="Symbol">)</a>

    <a id="8613" class="Comment">-- Given a witness that there is a path through the scope graph</a>
    <a id="8681" class="Comment">-- from scope `s` to scope `s&#39;`, a frame typed by `s`, and a</a>
    <a id="8746" class="Comment">-- well-typed heap, we can traverse the path by following the</a>
    <a id="8812" class="Comment">-- corresponding frame links in the heap to arrive at a frame</a>
    <a id="8878" class="Comment">-- scoped by `s&#39;`:</a>

    <a id="UsesGraph.UsesVal.getFrame" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="8911" class="Symbol">:</a> <a id="8913" class="Symbol">∀</a> <a id="8915" class="Symbol">{</a><a id="8916" href="ScopesFrames.ScopesFrames.html#8916" class="Bound">s</a> <a id="8918" href="ScopesFrames.ScopesFrames.html#8918" class="Bound">s&#39;</a> <a id="8921" href="ScopesFrames.ScopesFrames.html#8921" class="Bound">Σ</a><a id="8922" class="Symbol">}</a> <a id="8924" class="Symbol">→</a> <a id="8926" class="Symbol">(</a><a id="8927" href="ScopesFrames.ScopesFrames.html#8916" class="Bound">s</a> <a id="8929" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_" class="Datatype Operator">⟶</a> <a id="8931" href="ScopesFrames.ScopesFrames.html#8918" class="Bound">s&#39;</a><a id="8933" class="Symbol">)</a> <a id="8935" class="Symbol">→</a> <a id="8937" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8943" href="ScopesFrames.ScopesFrames.html#8916" class="Bound">s</a> <a id="8945" href="ScopesFrames.ScopesFrames.html#8921" class="Bound">Σ</a> <a id="8947" class="Symbol">→</a> <a id="8949" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="8954" href="ScopesFrames.ScopesFrames.html#8921" class="Bound">Σ</a> <a id="8956" class="Symbol">→</a> <a id="8958" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="8964" href="ScopesFrames.ScopesFrames.html#8918" class="Bound">s&#39;</a> <a id="8967" href="ScopesFrames.ScopesFrames.html#8921" class="Bound">Σ</a>
    <a id="8973" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="8982" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_.%5B%5D" class="InductiveConstructor">[]</a>      <a id="8990" href="ScopesFrames.ScopesFrames.html#8990" class="Bound">f</a> <a id="8992" href="ScopesFrames.ScopesFrames.html#8992" class="Bound">h</a> <a id="8994" class="Symbol">=</a> <a id="8996" href="ScopesFrames.ScopesFrames.html#8990" class="Bound">f</a>
    <a id="9002" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9011" class="Symbol">(</a><a id="9012" href="ScopesFrames.ScopesFrames.html#9012" class="Bound">e</a> <a id="9014" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%9F%B6_._%E2%88%B7_" class="InductiveConstructor Operator">∷</a> <a id="9016" href="ScopesFrames.ScopesFrames.html#9016" class="Bound">p</a><a id="9017" class="Symbol">)</a> <a id="9019" href="ScopesFrames.ScopesFrames.html#9019" class="Bound">f</a> <a id="9021" href="ScopesFrames.ScopesFrames.html#9021" class="Bound">h</a>
      <a id="9029" class="Keyword">with</a> <a id="9034" class="Symbol">(</a><a id="9035" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="9048" href="ScopesFrames.ScopesFrames.html#9021" class="Bound">h</a> <a id="9050" href="ScopesFrames.ScopesFrames.html#9019" class="Bound">f</a><a id="9051" class="Symbol">)</a>
    <a id="9057" class="Symbol">...</a>  <a id="9062" class="Symbol">|</a> <a id="9064" class="Symbol">(</a><a id="9065" href="ScopesFrames.ScopesFrames.html#9065" class="Bound">slots</a> <a id="9071" href="Data.Product.html#%CE%A3._%2C_" class="InductiveConstructor Operator">,</a> <a id="9073" href="ScopesFrames.ScopesFrames.html#9073" class="Bound">links</a><a id="9078" class="Symbol">)</a> <a id="9080" class="Symbol">=</a> <a id="9082" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9091" class="Bound">p</a> <a id="9093" class="Symbol">(</a><a id="9094" href="Data.List.All.html#lookup" class="Function">List∀.lookup</a> <a id="9107" href="ScopesFrames.ScopesFrames.html#9073" class="Bound">links</a> <a id="9113" class="Bound">e</a><a id="9114" class="Symbol">)</a> <a id="9116" class="Bound">h</a>

    <a id="9123" class="Comment">-- Given the definitions above, we can define some shorthand</a>
    <a id="9188" class="Comment">-- functions for getting and setting values:</a>

    <a id="UsesGraph.UsesVal.getVal" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getVal" class="Function">getVal</a>  <a id="9246" class="Symbol">:</a>  <a id="9249" class="Symbol">∀</a> <a id="9251" class="Symbol">{</a><a id="9252" href="ScopesFrames.ScopesFrames.html#9252" class="Bound">s</a> <a id="9254" href="ScopesFrames.ScopesFrames.html#9254" class="Bound">t</a><a id="9255" class="Symbol">}</a> <a id="9257" class="Symbol">→</a> <a id="9259" class="Symbol">(</a><a id="9260" href="ScopesFrames.ScopesFrames.html#9252" class="Bound">s</a> <a id="9262" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">↦</a> <a id="9264" href="ScopesFrames.ScopesFrames.html#9254" class="Bound">t</a><a id="9265" class="Symbol">)</a> <a id="9267" class="Symbol">→</a> <a id="9269" class="Symbol">∀</a> <a id="9271" class="Symbol">{</a><a id="9272" href="ScopesFrames.ScopesFrames.html#9272" class="Bound">Σ</a><a id="9273" class="Symbol">}</a> <a id="9275" class="Symbol">→</a> <a id="9277" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="9283" href="ScopesFrames.ScopesFrames.html#9252" class="Bound">s</a> <a id="9285" href="ScopesFrames.ScopesFrames.html#9272" class="Bound">Σ</a> <a id="9287" class="Symbol">→</a> <a id="9289" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="9294" href="ScopesFrames.ScopesFrames.html#9272" class="Bound">Σ</a> <a id="9296" class="Symbol">→</a> <a id="9298" href="ScopesFrames.ScopesFrames.html#3031" class="Bound">Val</a> <a id="9302" href="ScopesFrames.ScopesFrames.html#9254" class="Bound">t</a> <a id="9304" href="ScopesFrames.ScopesFrames.html#9272" class="Bound">Σ</a>
    <a id="9310" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getVal" class="Function">getVal</a> <a id="9317" class="Symbol">(</a><a id="9318" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_.path" class="InductiveConstructor">path</a> <a id="9323" href="ScopesFrames.ScopesFrames.html#9323" class="Bound">p</a> <a id="9325" href="ScopesFrames.ScopesFrames.html#9325" class="Bound">d</a><a id="9326" class="Symbol">)</a> <a id="9328" href="ScopesFrames.ScopesFrames.html#9328" class="Bound">f</a> <a id="9330" href="ScopesFrames.ScopesFrames.html#9330" class="Bound">h</a> <a id="9332" class="Symbol">=</a> <a id="9334" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getSlot" class="Function">getSlot</a> <a id="9342" href="ScopesFrames.ScopesFrames.html#9325" class="Bound">d</a> <a id="9344" class="Symbol">(</a><a id="9345" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9354" href="ScopesFrames.ScopesFrames.html#9323" class="Bound">p</a> <a id="9356" href="ScopesFrames.ScopesFrames.html#9328" class="Bound">f</a> <a id="9358" href="ScopesFrames.ScopesFrames.html#9330" class="Bound">h</a><a id="9359" class="Symbol">)</a> <a id="9361" href="ScopesFrames.ScopesFrames.html#9330" class="Bound">h</a>

    <a id="UsesGraph.UsesVal.setVal" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setVal" class="Function">setVal</a>  <a id="9376" class="Symbol">:</a>  <a id="9379" class="Symbol">∀</a> <a id="9381" class="Symbol">{</a><a id="9382" href="ScopesFrames.ScopesFrames.html#9382" class="Bound">s</a> <a id="9384" href="ScopesFrames.ScopesFrames.html#9384" class="Bound">t</a> <a id="9386" href="ScopesFrames.ScopesFrames.html#9386" class="Bound">Σ</a><a id="9387" class="Symbol">}</a> <a id="9389" class="Symbol">→</a> <a id="9391" class="Symbol">(</a><a id="9392" href="ScopesFrames.ScopesFrames.html#9382" class="Bound">s</a> <a id="9394" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_" class="Datatype Operator">↦</a> <a id="9396" href="ScopesFrames.ScopesFrames.html#9384" class="Bound">t</a><a id="9397" class="Symbol">)</a> <a id="9399" class="Symbol">→</a> <a id="9401" href="ScopesFrames.ScopesFrames.html#3031" class="Bound">Val</a> <a id="9405" href="ScopesFrames.ScopesFrames.html#9384" class="Bound">t</a> <a id="9407" href="ScopesFrames.ScopesFrames.html#9386" class="Bound">Σ</a> <a id="9409" class="Symbol">→</a> <a id="9411" href="ScopesFrames.ScopesFrames.html#UsesGraph.Frame" class="Function">Frame</a> <a id="9417" href="ScopesFrames.ScopesFrames.html#9382" class="Bound">s</a> <a id="9419" href="ScopesFrames.ScopesFrames.html#9386" class="Bound">Σ</a> <a id="9421" class="Symbol">→</a> <a id="9423" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="9428" href="ScopesFrames.ScopesFrames.html#9386" class="Bound">Σ</a> <a id="9430" class="Symbol">→</a> <a id="9432" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.Heap" class="Function">Heap</a> <a id="9437" href="ScopesFrames.ScopesFrames.html#9386" class="Bound">Σ</a>
    <a id="9443" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setVal" class="Function">setVal</a> <a id="9450" class="Symbol">(</a><a id="9451" href="ScopesFrames.ScopesFrames.html#UsesGraph._%E2%86%A6_.path" class="InductiveConstructor">path</a> <a id="9456" href="ScopesFrames.ScopesFrames.html#9456" class="Bound">p</a> <a id="9458" href="ScopesFrames.ScopesFrames.html#9458" class="Bound">d</a><a id="9459" class="Symbol">)</a> <a id="9461" href="ScopesFrames.ScopesFrames.html#9461" class="Bound">v</a> <a id="9463" href="ScopesFrames.ScopesFrames.html#9463" class="Bound">f</a> <a id="9465" href="ScopesFrames.ScopesFrames.html#9465" class="Bound">h</a> <a id="9467" class="Symbol">=</a> <a id="9469" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.setSlot" class="Function">setSlot</a> <a id="9477" href="ScopesFrames.ScopesFrames.html#9458" class="Bound">d</a> <a id="9479" href="ScopesFrames.ScopesFrames.html#9461" class="Bound">v</a> <a id="9481" class="Symbol">(</a><a id="9482" href="ScopesFrames.ScopesFrames.html#UsesGraph.UsesVal.getFrame" class="Function">getFrame</a> <a id="9491" href="ScopesFrames.ScopesFrames.html#9456" class="Bound">p</a> <a id="9493" href="ScopesFrames.ScopesFrames.html#9463" class="Bound">f</a> <a id="9495" href="ScopesFrames.ScopesFrames.html#9465" class="Bound">h</a><a id="9496" class="Symbol">)</a> <a id="9498" href="ScopesFrames.ScopesFrames.html#9465" class="Bound">h</a>
</pre></body></html>